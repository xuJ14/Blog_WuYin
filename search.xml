<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Citadel Central Regional Datathon 2021</title>
    <url>/Citadel-Central-Datathon-2021/</url>
    <content><![CDATA[<h1 id="whos-still-smoking">Who's still smoking?</h1>
<p>The goal is to use tobacco related data in order to discover and
analyze patterns associated with tobacco usage.</p>
<h2 id="prize">Prize</h2>
<p><a href="https://www.credential.net/4c9232c5-10b9-4f7e-a5ab-0d04a2f7a317">2nd
Place Winner of Central Regional Datathon 2021</a></p>
<h2 id="result">Result</h2>
<p><a href="https://github.com/mtanghu/Citadel-Central-Datathon-Fall21">code</a></p>
<div class="pdf-container" data-target="../pdf/Team_2_report.pdf" data-height="1000px"></div>
]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>Caculus Review</title>
    <url>/Caculus-Review/</url>
    <content><![CDATA[<h1 id="calculus-微积分复习">Calculus 微积分复习：</h1>
<p>Text Book: 《高等微积分教程》上下册.清华大学出版社</p>
<h2 id="基础知识">基础知识</h2>
<h3 id="第一章-实数列">第一章 实数列</h3>
<blockquote>
<p><strong>Definition 1 </strong>
数集A的上界、下界；有界的、无界的；上确界sup、下确界inf</p>
</blockquote>
<blockquote>
<p><strong>Definition 2</strong> 数列<span class="math inline">\(\{a_n\}\)</span>，如果 <span class="math inline">\(\forall\epsilon&gt;0\)</span>,<span class="math inline">\(\exists N\in \mathbb{N}\)</span>,使得当<span class="math inline">\(n&gt;N\)</span>时，就有<span class="math inline">\(|a_n-A|&lt;\epsilon\)</span>,则称数列<span class="math inline">\(\{a_n\}\)</span>有极限A,也称<span class="math inline">\(\{a_n\}\)</span>收敛于A，记为$_{n }{a_n}=A $</p>
</blockquote>
<ol type="1">
<li><p>收敛数列的性质：</p>
<blockquote>
<p>若数列收敛，则极限唯一</p>
</blockquote>
<blockquote>
<p>在一个收敛数列中任意添加或删去有限项，或者改变有限项的值，不会改变该数列的收敛性与极限值。</p>
</blockquote>
<blockquote>
<p>若数列收敛于A，则它的任何子列都收敛于A</p>
</blockquote>
<blockquote>
<p>收敛数列一定有界</p>
</blockquote>
<blockquote>
<p><strong>极限的保序性：</strong>若a数列收敛于A，b数列收敛于B，若A&gt;B，则存在N，使得当n&gt;N时，就有<span class="math inline">\(a_n&gt;b_n\)</span>。</p>
</blockquote>
<blockquote>
<p>极限的四则运算：</p>
</blockquote>
<blockquote>
<p><strong>夹逼原理</strong>（求极限）</p>
</blockquote></li>
<li><p>单调数列</p>
<blockquote>
<p><strong>单调收敛定理：</strong>(1)单调递增且有上界的数列必收敛。(2)单调递减且有下界的数列必收敛。`</p>
</blockquote>
<blockquote>
<p><strong>Stolz定理：</strong>(1)设数列{<span class="math inline">\(b_n\)</span>}严格单调递增且<span class="math inline">\(b_n\rightarrow +\infty\)</span>。如果<span class="math inline">\(\lim_{n\rightarrow \infty} \frac
{a_n-a_{n-1}}{b_n-b{n-1}}=A\)</span>，则<span class="math inline">\(\lim_{n\rightarrow\infty}\frac{a_n}{b_n}=A\)</span>；(2)设数列{<span class="math inline">\(b_n\)</span>}严格单调递减且<span class="math inline">\(\lim_{n\rightarrow\infty}b_n=\lim_{n\rightarrow\infty}a_n=0\)</span>。如果<span class="math inline">\(\lim_{n\rightarrow \infty} \frac
{a_n-a_{n-1}}{b_n-b{n-1}}=A\)</span>，则<span class="math inline">\(\lim_{n\rightarrow\infty}\frac{a_n}{b_n}=A\)</span>；</p>
</blockquote>
<blockquote>
<p><strong>欧拉常数：</strong><span class="math inline">\(\lim_{n\rightarrow\infty}(1+\frac{1}{2}+...+\frac{1}{n}-lnn)=\gamma\)</span>，γ=0.577...为欧拉常数</p>
</blockquote>
<blockquote>
<p><strong>柯西收敛原理：</strong>数列<span class="math inline">\(\{a_n\}\)</span>，如果 <span class="math inline">\(\forall\epsilon&gt;0\)</span>,<span class="math inline">\(\exists N\in \mathbb{N}\)</span>,使得对所有的<span class="math inline">\(n,m&gt;N\)</span>，都有<span class="math inline">\(|a_n-a_m|&lt;\epsilon\)</span>，称该数列为柯西列。数列收敛的充分必要条件是其为柯西列。</p>
</blockquote></li>
</ol>
<h3 id="第二章-函数">第二章 函数</h3>
<blockquote>
<p><strong>Definition：</strong>对于每个x，都有唯一的y与之对应，记为y=f(x)，把这个对应规则称为一个从X到Y的映射，记为<span class="math inline">\(f:X\rightarrow
Y\)</span>。X称之为定义域，Y称为值域</p>
</blockquote>
<blockquote>
<p><strong>邻域；空心邻域</strong></p>
</blockquote>
<blockquote>
<p><strong>函数极限的保序性</strong></p>
</blockquote>
<blockquote>
<p><strong>夹逼原理</strong>：若<span class="math inline">\(f(x)\le
g(x)\le h(x),x\in U(x_0,\rho)\)</span>，如果<span class="math inline">\(\lim_{x\rightarrow x_0}f(x)=\lim_{x\rightarrow
x_0}h(x)=A\)</span>，则<span class="math inline">\(\lim_{x\rightarrow
x_0}g(x)=A\)</span>。如果</p>
</blockquote>
<blockquote>
<p><strong>复合函数极限</strong></p>
</blockquote>
<blockquote>
<p><strong>函数极限的柯西收敛原理</strong></p>
</blockquote>
<blockquote>
<p>(1)f(x)是g(x)的<strong>高阶无穷小量</strong>：<span class="math inline">\(\lim_{x\rightarrow
x_0}\frac{f(x)}{g(x)}=0\)</span>，记作 <span class="math inline">\(f(x)=o(g(x))\ (x\rightarrow x_0)\)</span></p>
<p>(2)f(x)是g(x)的<strong>同阶无穷小量</strong>：<span class="math inline">\(\lim_{x\rightarrow x_0}\frac{f(x)}{g(x)}=c,\ c\ne
0\)</span></p>
<p>(3)f(x)是g(x)的<strong>等价无穷小量</strong>：<span class="math inline">\(\lim_{x\rightarrow
x_0}\frac{f(x)}{g(x)}=1\)</span>，记作 <span class="math inline">\(f(x)\sim o(g(x))\ (x\rightarrow x_0)\)</span></p>
<p>(4)f(x)是<strong>k阶无穷小量</strong>：<span class="math inline">\(\lim_{x\rightarrow
x_0}\frac{f(x)}{(x-x_0)^k}=c\)</span></p>
<p>Note: 无穷大量的定义同前三条。</p>
</blockquote>
<blockquote>
<p><strong>无穷小量间的等价关系：</strong></p>
<p>(1)<span class="math inline">\(sinx\sim x\)</span>，<span class="math inline">\(tanx\sim x\)</span></p>
<p>(2)<span class="math inline">\(1-cosx\sim \frac{1}{2}x^2\)</span></p>
<p>(3)<span class="math inline">\(ln(1+x)\sim x\)</span></p>
<p>(4)<span class="math inline">\(e^x-1\sim x, a^x-1\sim
xlna(a&gt;0)\)</span></p>
<p>(5)<span class="math inline">\((1+x)^n-1\sim ax\)</span></p>
</blockquote>
<blockquote>
<p>若 <span class="math inline">\(\lim_{x\rightarrow
x_0}f(x)=f(x_0)\)</span>，则称f在点 <span class="math inline">\(x_0\)</span>处连续。</p>
</blockquote>
<blockquote>
<p>若<span class="math inline">\(\lim_{x\rightarrow
x_0^+}f(x)=f(x_0)\)</span>，则称f在点 <span class="math inline">\(x_0\)</span>处右连续。</p>
</blockquote>
<blockquote>
<p>若<span class="math inline">\(\lim_{x\rightarrow
x_0^-}f(x)=f(x_0)\)</span>，则称f在点 <span class="math inline">\(x_0\)</span>处右连续。</p>
</blockquote>
<blockquote>
<p>f在点 <span class="math inline">\(x_0\)</span>处连续的充分必要条件是f在点 <span class="math inline">\(x_0\)</span>处既右连续又左连续。</p>
</blockquote>
<blockquote>
<p>f在点 <span class="math inline">\(x_0\)</span>处不连续，则称间断。三种情形：</p>
<p>1）可去间断点：极限存在，但在该点处没有定义或者<span class="math inline">\(\lim_{x\rightarrow x_0}f(x)\ne
f(x_0)\)</span>，即可以令该点的值等于极限，变为一个连续点</p>
<p>2）第一类间断点：左右极限都存在，但二者不相等。也包括可去间断点。</p>
<p>3）第二类间断点：至少有一个单侧极限不存在。</p>
</blockquote>
<blockquote>
<p>介值定理：设 <span class="math inline">\(f\in
C[a,b]\)</span>（f在闭区间上连续），<span class="math inline">\(f(a)\ne
f(b)\)</span>，则对介于f(a)与f(b)之间的每个数c，都存在 <span class="math inline">\(\xi\in (a,b)\)</span>，使 <span class="math inline">\(f(\xi)=c\)</span></p>
</blockquote>
<blockquote>
<p>闭区间上连续函数的有界性定理与最大最小值定理</p>
</blockquote>
<h3 id="第三章-函数的导数">第三章 函数的导数</h3>
<blockquote>
<p>导数的定义：设函数 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点的某个领域内定义，如果 <span class="math inline">\(\lim_{\Delta x\to 0}\frac{f(x_0)+\Delta
x)-f(x_0)}{\Delta x}\)</span>存在，则称 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点可导，称这个极限值为 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点的导数，记作 <span class="math inline">\(f'(x_0)\)</span>。</p>
</blockquote>
<blockquote>
<p>可导则连续</p>
</blockquote>
<blockquote>
<p>右导数</p>
<p>左导数</p>
<p>导数存在的充分必要条件是左导数和右导数存在且相等</p>
</blockquote>
<blockquote>
<p>微分的定义：设函数 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点的某个领域内定义，如果当自变量的增量
<span class="math inline">\(\Delta
x\)</span>充分小时，相应的函数值的增量 <span class="math inline">\(\Delta f(x_0)=f(x_0+\Delta
x)-f(x_0)\)</span>可以表示为：<span class="math inline">\(\Delta
f(x_0)=a\Delta x+o(\Delta x)(\Delta x \to \ 0)\)</span>，其中 <span class="math inline">\(a\)</span>为常数，则称 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点可微，并称 <span class="math inline">\(df(x_0)=a\cdot\Delta x\)</span>为<span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span>点处的微分。</p>
</blockquote>
<blockquote>
<p>可微的充要条件是可导</p>
</blockquote>
<blockquote>
<p>求导法则：</p>
<ul>
<li>导数的四则运算</li>
<li>复合函数求导数的链式法则：<span class="math inline">\(h'(x_0)=f'(\varphi(x_0))\varphi'(x_0)\)</span></li>
<li>反函数求导法则：设 <span class="math inline">\(f\)</span>在 <span class="math inline">\((a,b)\)</span>内严格单调且连续，<span class="math inline">\(x_0\in (a,b)\)</span>，<span class="math inline">\(f'(x_0)\ne 0\)</span>，则反函数 <span class="math inline">\(x=f^{-1}(y)\)</span>在 <span class="math inline">\(y_0=f(x_0)\)</span>处可导，并且 <span class="math inline">\((f^{-1})'(y_0)=\frac{1}{f'(x_0)}\)</span>。</li>
</ul>
</blockquote>
<blockquote>
<p>常见函数的导数</p>
</blockquote>
<figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20210531112117849.png" alt="常见函数的导数">
<figcaption aria-hidden="true">常见函数的导数</figcaption>
</figure>
<blockquote>
<p>隐函数求导：对于 <span class="math inline">\(F(x,y)=0\)</span>方程两边同时对x求导，解出 <span class="math inline">\(y'\)</span>即可。</p>
</blockquote>
<blockquote>
<p>由参数方程形成的函数的求导方法：<span class="math inline">\(\frac{dy}{dx}=\frac{dy}{dt}\frac{dt}{dx}=\frac{dy}{dt}\frac{1}{\frac{dx}{dt}}=\frac{\psi'(t)}{\varphi'(t)}=\frac{y'(t)}{x'(t)}\)</span></p>
</blockquote>
<blockquote>
<p>高阶导数：若 <span class="math inline">\(f\)</span>在 <span class="math inline">\((a,b)\)</span>上n阶可导，则称 <span class="math inline">\(f\)</span>在 <span class="math inline">\((a,b)\)</span>上n阶可导；而当 <span class="math inline">\(f^{(n)}(x)在（a,b）\)</span>上连续时，称 <span class="math inline">\(f\)</span>在 <span class="math inline">\((a,b)\)</span>上为n阶连续可导（连续可微）。</p>
<ul>
<li><span class="math inline">\((f\cdot
g)^{(n)}(x)=\sum^{n}_{k=0}C_{n}^{k}f^{(k)}(x)g^{(n-k)}(x)\)</span>，莱布尼茨公式</li>
</ul>
</blockquote>
<h3 id="第四章-导数应用">第四章 导数应用</h3>
<blockquote>
<p>局部极值的定义：设函数<span class="math inline">\(f\)</span>在点
<span class="math inline">\(x_0\)</span>的某个邻域中有定义，如果$&gt;0
$使得当 <span class="math inline">\(|x-x_0|&lt;\rho\)</span>时，有 <span class="math inline">\(f(x)\ge f(x_0)\  (f(x)\le
f(x_0))\)</span>，则称<span class="math inline">\(f\)</span>在点 <span class="math inline">\(x_0\)</span>处取得（局部）极小值（极大值）</p>
</blockquote>
<blockquote>
<p>费马定理：设 <span class="math inline">\(x_0\)</span>是函数 <span class="math inline">\(f\)</span>的一个极值点，如果 <span class="math inline">\(f'(x_0)\)</span>存在，则 <span class="math inline">\(f'(x_0)=0\)</span></p>
</blockquote>
<blockquote>
<p>罗尔定理：设函数<span class="math inline">\(f\)</span>在闭区间<span class="math inline">\([a,b]\)</span>上连续，在开区间<span class="math inline">\((a,b)\)</span>内可导。如果<span class="math inline">\(f(a)=f(b)\)</span>，则存在<span class="math inline">\(\epsilon \in (a,b)\)</span>使得<span class="math inline">\(f'(\epsilon)=0\)</span>。</p>
</blockquote>
<blockquote>
<p>柯西中值定理：设函数f,
g都在闭区间[a,b]上连续，在开区间(a,b)内可导，并且在(a,b)中 <span class="math inline">\(g'(x)\ne 0\)</span>，则存在 <span class="math inline">\(\epsilon\in (a,b)\)</span>，使得：<span class="math inline">\(\frac{f'(\epsilon)}{g'(\epsilon)}=\frac{f(b)-f(a)}{g(b)-g(a)}\)</span></p>
</blockquote>
<blockquote>
<p>拉格朗日中值定理：是柯西中值定理中 <span class="math inline">\(g(x)=x\)</span>的一种特殊形式。</p>
<p>几何意义：必存在一点使得曲线在该点处的切线与函数两端点的连线平行</p>
<p>拉格朗日中值公式： <span class="math inline">\(f(x)-f(x_0)=f'(\epsilon)(x-x_0)，\epsilon\in
(x_0,x)\)</span>，(可用于证明不等式)</p>
</blockquote>
<blockquote>
<p>洛必达法则： 分子分母同时求导</p>
</blockquote>
<blockquote>
<p>泰勒公式：设函数 <span class="math inline">\(f\)</span>在点 <span class="math inline">\(x_0\)</span>处有n阶导数，则当 <span class="math inline">\(x\rightarrow x_0\)</span>时，<span class="math inline">\(f(x)=\sum_{k=0}^{n}\frac{f^{(k)}(x_0)}{k!}(x-x_0)^k+o((x-x_0)^n)\)</span></p>
<p>其中，<span class="math inline">\(R_n(x)=o((x-x_0)^n)\)</span>，称为皮亚诺余项形式</p>
</blockquote>
<blockquote>
<p>设函数 <span class="math inline">\(f\)</span>在区间 <span class="math inline">\([a,b]\)</span>上n+1阶可导，<span class="math inline">\(x_0\)</span>与<span class="math inline">\(x\)</span>为<span class="math inline">\([a,b]\)</span>中任意两点，<span class="math inline">\(P_n\)</span>为 <span class="math inline">\(f\)</span>在 <span class="math inline">\(x_0\)</span> 处的 n 阶泰勒多项式，则存在 <span class="math inline">\(\epsilon\)</span> 介于 <span class="math inline">\(x_0\)</span> 与 <span class="math inline">\(x\)</span> 之间，使得： <span class="math display">\[
R_n(x)=f(x)-P_n(x)=\frac{f^{(n+1)}(\epsilon)}{(n+1)!}(x-x_0)^{n+1}
\]</span></p>
</blockquote>
<blockquote>
<p>设设函数 <span class="math inline">\(f\)</span>在点 <span class="math inline">\(x_0\)</span>处有n阶导数，并且存在 n 阶多项式 <span class="math inline">\(Q_n(x)\)</span>，使得： <span class="math display">\[
f(x)= Q_n(x)+O((x-x_0)^N)(x\rightarrow x_0)
\]</span> 则<span class="math inline">\(Q_n(x)\)</span>即为 <span class="math inline">\(f\)</span>在点 <span class="math inline">\(x_0\)</span>处有n阶泰勒多项式<span class="math inline">\(P_n(x)\)</span></p>
</blockquote>
<ul>
<li><p>难以求导的可以化为几个简单函数的复合，分别泰勒展开，然后带入，忽略高阶项</p></li>
<li><p>泰勒公式可以用于求近似值、无穷小量阶的确定与求不定型极限以及有关函数机器导数的等式与不等式证明等问题中的应用。</p></li>
</ul>
]]></content>
      <categories>
        <category>Mathematics</category>
      </categories>
      <tags>
        <tag>Mathematics</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Read Papers</title>
    <url>/How-to-Read-Papers/</url>
    <content><![CDATA[<h1 id="how-to-read-papers">How to Read Papers?</h1>
<h2 id="resources">Resources</h2>
<ul>
<li>Arxiv</li>
<li>Blog Posts</li>
<li>Text Books</li>
</ul>
<h2 id="prepare">Prepare</h2>
<ul>
<li>列出待读论文，每一篇列一行，表示从0-100的阅读进度</li>
<li>如果有论文不是想要的，就删掉</li>
<li>如果有新的论文就加进来</li>
</ul>
<h2 id="methods">Methods</h2>
<ul>
<li>第一遍：只看标题，摘要，图表</li>
<li>第二遍：前言，结语，图表</li>
<li>第三遍：论文主体</li>
</ul>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Learning Tips</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Win a Data Science Competition</title>
    <url>/How-to-Win-a-Data-Science-Competition-Learn-from-Top-Kagglers/</url>
    <content><![CDATA[<h1 id="how-to-win-a-data-science-competition-learn-from-top-kagglers">How
to Win a Data Science Competition: Learn from Top Kagglers</h1>
<p>linear model：适合高维稀疏线性可分空间</p>
<p>decision tree: 难以捕捉线性相关性，分成boxes</p>
<p>k-NN：</p>
<p>NN：非线性边界</p>
<h2 id="tips">Tips</h2>
<h3 id="feature-preprocessing">1. feature preprocessing</h3>
<ul>
<li><p>类别数据：</p>
<ul>
<li>one hot encoding</li>
<li>随机森林不用transform类别数据</li>
</ul></li>
<li><p>numeric features：</p></li>
<li><p>scale</p>
<ul>
<li>tree model不用变形数据</li>
<li>其他可能要变
<ul>
<li>scale可能影响梯度下降有效性</li>
<li>minmaxscaling</li>
<li>standardscaler</li>
<li>有时可以适当放缩feature，来看模型有没有变好，这样使得那个feature更重要</li>
</ul></li>
</ul></li>
<li><p>outlier：</p>
<ul>
<li>可以选择上下界（按照百分比）
<ul>
<li>winsorization：对financial data</li>
<li>可以看直方图</li>
</ul></li>
</ul></li>
<li><p>rank</p>
<ul>
<li>线性模型、knn、nn对于这个处理方式有效</li>
<li>scipy.stats.rankdata</li>
</ul></li>
<li><p>对于non-tree based models：</p>
<ul>
<li>log transform</li>
<li>开根号：np.sqrt(x+2/3)</li>
<li>减少异常值，增大0附近差异</li>
<li>可以混合不同模型（基于不同的处理方法）</li>
</ul></li>
<li><p>feature generation：</p>
<ul>
<li>加减乘除</li>
<li>取小数部分</li>
<li>要理解数据</li>
</ul></li>
<li><p>categorical features/ ordinal features</p>
<ul>
<li><p>label encoding</p>
<ul>
<li><p>对tree友好</p></li>
<li><p>要转化为数字</p>
<ul>
<li><p>按字母排序：sklearn.preprocessing.LabelEncode</p></li>
<li><p>按出现顺序：pandas.factorize</p></li>
<li><p>转化为出现频率作为特征（常用于tree）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">encoding = titanic.groupby('Embarked').size()</span><br><span class="line">encoding = encoding/len(titanic)</span><br><span class="line">titanic['enc'] = titanic.Embarked.map(encoding)</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>rank</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">from scipy.stats import rankdata</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>one hot encoding:常用于non-tree</p>
<ul>
<li>pandas.get_dummies</li>
<li>sklearn.preprocessing.OneHotEncoder</li>
<li>可能对tree不友好</li>
<li>需要稀疏矩阵（word）</li>
<li>组合各种类别，形成多种类：如等级加性别</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Datetime</p>
<ul>
<li>周期</li>
<li>时间点</li>
<li>时间跨度（距离过去，距离未来）</li>
</ul></li>
<li><p>坐标coordination</p>
<ul>
<li>单坐标
<ul>
<li>区域中心</li>
<li>特殊位置</li>
</ul></li>
<li>统计值
<ul>
<li>区域统计值</li>
<li>距离</li>
</ul></li>
<li>旋转坐标可能有奇效</li>
</ul></li>
<li><p>missing values</p>
<ul>
<li>fillna
<ul>
<li>-999，-1
<ul>
<li>注意在后面均一化时会有重大影响</li>
<li>feature generation前 fillna可能有问题</li>
</ul></li>
<li>中位数、均值</li>
<li>reconstruct value
<ul>
<li>时间序列：estimation</li>
<li>其他的很难估计</li>
</ul></li>
</ul></li>
<li>添加一个isNull的feature，神经网络和tree</li>
<li>可以把outlier as missing values</li>
<li>xgboost可以处理nan</li>
</ul></li>
<li><p>text</p>
<ul>
<li><p>bag of words</p></li>
<li><p>sklearn.feature_extraction.text.CountVectorizer</p></li>
<li><p>TF-iDF</p>
<ul>
<li><p>term frequency</p></li>
<li><p>inverse document frequency</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tf = <span class="number">1</span>/x.<span class="built_in">sum</span>(axis=<span class="number">1</span>)[:,<span class="literal">None</span>]</span><br><span class="line">x = x*tf</span><br><span class="line">idf = np.log(x.shape[<span class="number">0</span>]/(x&gt;<span class="number">0</span>).<span class="built_in">sum</span>(<span class="number">0</span>))</span><br><span class="line">x = x*idf</span><br><span class="line"><span class="comment"># sklearn.feature_extraction.text.TfidfVectorizer</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以降低高频词比重</p></li>
</ul></li>
<li><p>N-grams</p>
<ul>
<li>n个字符组合</li>
<li>sklearn.feature_extraction.text.CountVectorizer: Ngram_range,
analyzer</li>
</ul></li>
<li><p>lowercase</p></li>
<li><p>lemmatization: car = cars转换为基本形式</p></li>
<li><p>stemming: 取词干</p></li>
<li><p>stopwords：</p>
<ul>
<li>NLTK: natural language toolkit library</li>
<li>sklearn.feature_extraction.text.CountVectorizer:
max_df(按频率删除)</li>
</ul></li>
<li><p>embedding(word2vec)</p>
<ul>
<li>邻近的词向量相近：向量相加减, 几百个维度</li>
<li>Word2vec, Glove, FastText</li>
<li>Doc2vec</li>
<li>pretrained model</li>
</ul></li>
</ul></li>
<li><p>image</p>
<ul>
<li>CNN</li>
<li>预先训练好的模型微调fine-tuning再训练对小数据集有时候很有效
<ul>
<li>keras等库有</li>
</ul></li>
<li>image augmentation：
<ul>
<li>旋转图像，增加样本</li>
<li>加噪音</li>
</ul></li>
</ul></li>
</ul>
<h3 id="eda">2. EDA</h3>
<ul>
<li>查看数据逻辑，检查是否有error，探究error原因</li>
<li>了解数据如何被采集，可以有效设置validation scheme</li>
<li>plt.hist(x)</li>
<li>plt.plot(x)</li>
<li>plt.scatter(len(x), x, c=y)</li>
<li>x.describe</li>
<li>look at pairs/groups</li>
<li>检查train test是否分布相同</li>
<li>根据eda结果生成新feature</li>
<li>pd.scatter_matrix(df)</li>
<li>plt.matshow()</li>
<li>sort_values</li>
<li>检查重复的特征或常数特征（drop_duplicate）</li>
<li>traintest[f] = traintest[f].factorize()</li>
<li>.select_dtypes(include=['object'])可以选择不同类型columns</li>
</ul>
<h3 id="validation-and-overfitting">3. Validation and overfitting</h3>
<ul>
<li><p>validation：</p>
<ul>
<li><p>holdout: sklearn.model_selection.ShuffleSplit</p></li>
<li><p>k fold: sklearn.model_selection.Kfold</p></li>
<li><p>leave one out: sklearn.model_selection.LeaveOneOut</p></li>
</ul></li>
<li><p>Stratification: 分层，保留相同分布</p></li>
<li><p>Data splitting：</p>
<ul>
<li>random: row independent</li>
<li>time-based splits
<ul>
<li>moving window validation:
sklearn.model_selection.TimeSeriesSplit</li>
</ul></li>
<li>by id</li>
<li>combined
<ul>
<li>https://medium.com/<span class="citation" data-cites="soumyachess1496/cross-validation-in-time-series-566ae4981ce4">@soumyachess1496/cross-validation-in-time-series-566ae4981ce4</span></li>
</ul></li>
<li>有时需要看test set和train的分布差异</li>
</ul></li>
<li><p>data leak:</p>
<ul>
<li>time series</li>
</ul></li>
</ul>
<h3 id="metrics-evaluation">4. metrics evaluation</h3>
<ul>
<li><p>regression metrics：</p>
<ul>
<li><p>可以改loss function：</p></li>
<li><figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220623215750485.png" alt="image-20220623215750485">
<figcaption aria-hidden="true">image-20220623215750485</figcaption>
</figure></li>
<li><p>MSE： 常数的最优估计是均值</p></li>
<li><p>RMSE：root mean square error</p></li>
<li><p>R-squared</p></li>
<li><p>MAE: mean average error: not sensetive than mse to outlier</p>
<ul>
<li>常数的最优估计是median
<ul>
<li>对outlier友好</li>
</ul></li>
<li>XGBoost不能用，因为二阶导为0</li>
<li>LightGBM可以用</li>
<li>类似huber loss：特别是当error比较大</li>
</ul></li>
<li><p>MSPE：</p>
<ul>
<li>常数的最优估计是weighted target mean</li>
</ul></li>
<li><p>MAPE:</p>
<ul>
<li>常数最优估计：weighted target median</li>
<li>outlier会有很高权重，很少用</li>
</ul></li>
<li><p>RMSLE：log space</p></li>
</ul></li>
<li><p>classification metric：</p>
<ul>
<li>accuracy</li>
<li>log loss
<ul>
<li>binary</li>
<li>multi loss</li>
</ul></li>
<li>AUC：area under curve，包括order</li>
<li>ROC</li>
<li>cohen‘s Kappa</li>
<li>confusion matrix</li>
<li>weighted error</li>
<li>quadratic and linear weighted kappa：多用于医学</li>
</ul></li>
<li><p>optimization</p>
<ul>
<li><p>有的模型不能用一些loss function来优化：</p>
<ul>
<li><p>XGBoost不能用MSPE</p></li>
<li><p>custom loss for XGBoost:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">logregobj</span>(<span class="params">preds,dtrains</span>):</span><br><span class="line">    labels = dtrain.get_label()</span><br><span class="line">    preds = <span class="number">1.0</span>/(<span class="number">1.0</span>+np.exp(-preds))<span class="comment"># 有时要处理pred</span></span><br><span class="line">    grad = preds - labels</span><br><span class="line">    hess = preds * (<span class="number">1.0</span>-preds)</span><br></pre></td></tr></tbody></table></figure></li>
</ul></li>
<li><p>early stopping: 防止overfitting</p></li>
<li><p>变换target：比如指数、log等</p></li>
<li><p>calibrate prediction</p>
<ul>
<li>plat scaling: fit logistic regression to predictions(stacking)</li>
<li>isotonic regression: fit isotonic regression to predictions</li>
<li>stacking: fit XGBoost or neural net to predictions</li>
</ul></li>
<li><p>AUC(ROC) optimization:</p>
<ul>
<li><p>pointwise loss: <span class="math inline">\(\min \Sigma
L_{point}(\hat y_i;y_i)\)</span></p></li>
<li><p>pairwise loss:</p>
<ul>
<li><p><span class="math inline">\(\min \Sigma L_{pair}(\hat y_i,\hat
y_j:y_i,y_j)\)</span></p></li>
<li></li>
<li><p><span class="math display">\[
\operatorname{Loss}=-\frac{1}{N_{0} N_{2}} \sum_{j: y_{j}=1}^{N_{1}}
\sum_{i: y_{i}=0}^{N_{0}} \log
\left(\operatorname{prob}\left(\hat{y}_{j}-\hat{y}_{i}\right)\right)
\]</span></p></li>
</ul></li>
<li><p>xgboost, lightboom可行</p></li>
</ul></li>
<li><p>quadratic weighted Kappa:</p>
<ul>
<li><p>optimize MSE</p></li>
<li><p><span class="math display">\[
\begin{aligned}
\operatorname{Kappa}(y, \hat{y}) &amp; \approx 1-\frac{\frac{1}{N}
\sum_{i=1}^{N}\left(\hat{y}_{i}-y_{i}\right)^{2}}{\text { hard to deal
with part }} \\
&amp;=1-\frac{\operatorname{MSE}(y, \hat{y})}{\text { hard to deal with
part }}
\end{aligned}
\]</span></p></li>
</ul></li>
<li><p>optimize thresholds</p></li>
</ul></li>
<li><p>mean encoding: 有很多分类特征</p>
<ul>
<li><img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624111932610.png" title="fig:" alt="image-20220624111932610"></li>
</ul></li>
<li><p>StratifiedKFold</p></li>
<li><p>分析树可能有新发现</p></li>
</ul>
<h3 id="hyper-parameter-tuning">5. hyper parameter tuning</h3>
<ul>
<li>libraries:
<ul>
<li>hyperopt</li>
<li>scikit-optimize</li>
<li>spearmint</li>
<li>gpyopt</li>
<li>robo</li>
<li>smac3</li>
</ul></li>
<li>GBDT
<ul>
<li><p>绿色提升fit，红色降低fit</p></li>
<li><p>min_child_weight很重要，increase
model变保守（0，5，15，300……）</p></li>
<li><figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624114638662.png" alt="image-20220624114638662">
<figcaption aria-hidden="true">image-20220624114638662</figcaption>
</figure></li>
<li><p>sklearn.randomforest/ExtraTrees</p>
<ul>
<li>N_estimators(higher the better)</li>
<li><img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624115132530.png" title="fig:" alt="image-20220624115132530"></li>
</ul></li>
</ul></li>
<li>neural networks
<ul>
<li><img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624120041719.png" title="fig:" alt="image-20220624120041719"></li>
</ul></li>
<li>可以将数据存储为HDF5或MPI格式，或cpickle</li>
</ul>
<h3 id="pipeline">6. pipeline</h3>
<ul>
<li>EDA:
<ul>
<li>histgram</li>
<li>feature vs target</li>
<li>univariate predictability metrics（IV，R，auc）</li>
<li>bining numerical features and correlation matrices</li>
</ul></li>
<li>Decide the CV strategy</li>
<li>feature engineering:</li>
<li>Modeling
<ul>
<li><figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624160045769.png" alt="image-20220624160045769">
<figcaption aria-hidden="true">image-20220624160045769</figcaption>
</figure></li>
<li><p>看文献</p></li>
</ul></li>
<li>Ensemble</li>
</ul>
<h3 id="feaure">7. feaure</h3>
<ul>
<li>bray-curtis metric</li>
<li>KNN features</li>
<li>matrix factorization: 利用矩阵分解、加减乘除来增加、减少feature</li>
<li>feature interactions:
<ul>
<li>f1 and f2: 组合形成one hot矩阵：先各自one hot，再pairwise相乘</li>
<li>积分、微分</li>
<li>可以用random forest来选择feature importance</li>
<li>分析树的结构创造新特征：
<ul>
<li>xgboost：predict（pred_leaf=True）</li>
<li>sklearn: apply()</li>
</ul></li>
</ul></li>
<li>tSNE
<ul>
<li>常用于EDA</li>
<li>great tool for visualization</li>
<li>但是要调参</li>
<li>dstill.pub 学习网站</li>
<li>library: tsne, sklearn(慢)</li>
<li>结果可能不容易理解</li>
</ul></li>
</ul>
<h3 id="ensemble">8. Ensemble</h3>
<ul>
<li>bagging：
<ul>
<li>sklearn: baggingClassifier, BaggingRegressor</li>
</ul></li>
<li>boosting:
<ul>
<li>weight based boosting: 关注错的更厉害的
<ul>
<li>adaboost</li>
</ul></li>
<li>residual based boosting
<ul>
<li>learning rate</li>
<li>num of estimator</li>
<li>models：
<ul>
<li>dart：只用之前一部分模型的预测结果</li>
<li>fully gradient based</li>
<li>xgboost</li>
<li>lightgbm</li>
<li>catboost</li>
<li>sklearn GBM</li>
</ul></li>
</ul></li>
</ul></li>
<li>stacking：
<ul>
<li><p>用所有模型的predict输入到新模型<br>
</p></li>
<li><p>注意time</p></li>
<li><p>stacknet</p>
<ul>
<li>可以用Kfold形式训练各个模型</li>
<li>可以把原始feature加入stacking</li>
</ul></li>
<li><figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624193839550.png" alt="image-20220624193839550">
<figcaption aria-hidden="true">image-20220624193839550</figcaption>
</figure></li>
<li><figure>
<img src="https://raw.githubusercontent.com/xuJ14/ImageHost/main/image-20220624194034207.png" alt="image-20220624194034207">
<figcaption aria-hidden="true">image-20220624194034207</figcaption>
</figure></li>
<li><p>小心data leakage</p></li>
<li><p>stacknet：可用从说明文档中学习到各个模型哪些参数重要</p></li>
<li><p>xcessiv</p></li>
<li><p>stacked ensembles from h2o</p></li>
</ul></li>
<li>catboost
<ul>
<li>快，预制了很多函数</li>
<li>overfiting detector</li>
<li></li>
</ul></li>
</ul>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week01</title>
    <url>/Machine-Learning-Week01/</url>
    <content><![CDATA[<h2 id="week-1">Week 1</h2>
<ol type="1">
<li><p><strong>Supervised Learning 监督学习</strong></p>
<ul>
<li>分类问题 classification problem
<ul>
<li>discrete output（0，1）</li>
<li>features</li>
<li>特征无限多的时候可以用SVM支持向量机</li>
</ul></li>
<li>回归问题 regression problem
<ul>
<li>continuous output</li>
</ul></li>
</ul></li>
<li><p><strong>Unsupervised Learning 无监督学习</strong></p>
<ul>
<li><p><strong>clustering algorithm 聚类算法</strong></p>
<ul>
<li><p>dataset（no label） find structure;根据数据内部关系分类</p></li>
<li><p>E.g. 网站分类；基因分类；social network analysis；market
segmentation；Astronomical data analysis</p></li>
<li><p><strong>Cocktail party
problem</strong>：混杂的声音中分离出两种声音</p>
<figure class="highlight matlab"><table><tbody><tr><td class="code"><pre><span class="line">[W,s,v] = svd((<span class="built_in">repmat</span>(sum(x.*x,<span class="number">1</span>),<span class="built_in">size</span>(x,<span class="number">1</span>),<span class="number">1</span>).*x)*x')</span><br></pre></td></tr></tbody></table></figure>
<p>*SVD: singular value decomposition 奇异值分解，求解线性方程</p>
<p>octave做原型，然后迁移到C或JAVA</p></li>
</ul></li>
</ul></li>
<li><p><strong>Model and Cost Function 模型和成本函数</strong></p>
<ul>
<li><p><strong>线性回归算法 linear regression</strong></p>
<ul>
<li><p>training set 训练集</p></li>
<li><p>m - 训练样本数</p>
<p>x - 输入变量</p>
<p>y - 输出变量</p>
<p><span class="math inline">\((x^{i},y^{i})\)</span> - i training
example</p>
<p><span class="math inline">\(\theta\)</span> - Parameters</p>
<p>h - hypothesis，x映射到y的函数 ：<span class="math inline">\(h_{\theta}(x)=\theta_0+\theta_1x\)</span>；缩写即<span class="math inline">\(h(x)\)</span></p>
<p>不一定都是线性方程</p></li>
</ul></li>
<li><p><strong>Cost Function 成本函数</strong></p>
<ul>
<li><p>度量函数拟合的程度</p></li>
<li><p>平方误差成本函数：适用于线性回归</p>
<p>Hypothesis: <span class="math display">\[\min
\limits_{\theta_0\theta_1}\frac {1}{2m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2\]</span></p>
<p>Cost function: <span class="math display">\[J(\theta_0,\theta_1)=\frac {1}{2m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2\]</span> ----- (Squared
Error Function)</p>
<p>contour plot: 轮廓图；等高线图</p></li>
</ul></li>
</ul></li>
<li><p><strong>Parameter Learning</strong></p>
<ul>
<li><p>Gradient descent 梯度下降算法</p>
<p>不断改变<span class="math inline">\(\theta\)</span>使得J函数变小，得到局部最优点local
optimum，convergence收敛</p>
<p><span class="math display">\[\theta_j:=\theta_j-\alpha\frac
{\partial} {\partial \theta_j}J(\theta_0,\theta_j)\quad(for\ j=0\ and\
j=1)\]</span></p>
<p><span class="math inline">\(\alpha\)</span>是学习速率 learning
rate</p>
<ul>
<li><p>注意编程中的赋值后会覆盖，所以要桥接一下</p></li>
<li><p>partial derivatives 偏导数；derivatives 导数</p></li>
<li><p>不需要调整α因为导数值越来越小</p></li>
<li><p>Batch Gradient Descent
批量梯度下降：每step都用到全部的训练样本</p></li>
<li><p>高等线性代数：normal equations
method正规方程，大数据时梯度下降更好用</p></li>
</ul></li>
</ul></li>
</ol>
<h1 id="matrices-and-vectors">Matrices and Vectors</h1>
<ol type="1">
<li>Matrix: rows*columns
<ul>
<li><span class="math inline">\(\mathbb{R} ^{2\times3}\)</span> , <span class="math inline">\(A_{ij}\)</span>,</li>
</ul></li>
<li>Vector: n*1 matrix
<ul>
<li><span class="math inline">\(\mathbb{R}^4\)</span></li>
</ul></li>
<li><span class="math inline">\(A\times B\ne B\times A\)</span></li>
<li>Associative交换律</li>
<li>Identity Matrix： <span class="math inline">\(I\)</span>, <span class="math inline">\(n\times n\)</span>
<ul>
<li><span class="math inline">\(\begin{bmatrix}1&amp;\cdots&amp;0\\\vdots&amp;\ddots&amp;\vdots\\0&amp;\cdots&amp;1\end{bmatrix}\)</span></li>
<li><span class="math inline">\(A\cdot I=I\cdot A\)</span></li>
<li>I = eye(2)</li>
</ul></li>
<li>Inverse 矩阵的逆：<span class="math inline">\(A(A^{-1})=A^{-1}A=I\)</span>
<ul>
<li>pinv（A）</li>
<li><span class="math inline">\(A_{m\times m}\)</span></li>
<li>0矩阵=奇异矩阵，没有逆矩阵的矩阵是奇异矩阵</li>
<li>高斯消元法求逆：
<ul>
<li>“某行乘以一个数后加到另一行”、“某两行互换位置”、“某行乘以某一个数”，这三种以行做运算的方法</li>
<li>行变换或列变换都可以</li>
<li>增广矩阵<span class="math inline">\(B=[A|I]=\begin{vmatrix} A_{11}
&amp; A_{12} &amp; A_{13}&amp;1&amp;0&amp;0 \\ A_{21} &amp;
A_{22}&amp;A_{23}&amp;0&amp;1&amp;0\\A_{31} &amp; A_{32} &amp;
A_{33}&amp;0&amp;0&amp;1 \end{vmatrix} \Rightarrow \begin{vmatrix}
1&amp;0&amp;0&amp;A_{11}^{'} &amp; A_{12}^{'} &amp;
A_{13}^{'} \\0&amp;1&amp;0&amp;A_{21}^{'} &amp; A_{22}^{'}
&amp; A_{23}^{'}\\0&amp;0&amp;1&amp;A_{31}^{'} &amp;
A_{32}^{'} &amp; A_{33}^{'} \end{vmatrix}\)</span></li>
</ul></li>
<li>待定系数法</li>
<li>伴随矩阵法$A^* <span class="math inline">\(，\)</span>A^{-1}=$
<ul>
<li>将矩阵A元素<span class="math inline">\(a_{ij}\)</span>所在的第i行j列元素划去后剩余元素按照原来顺序组成n-1阶矩阵所确定的行列式成为元素<span class="math inline">\(a_{ij}\)</span>的余子式，记为<span class="math inline">\(M_{ij}\)</span>，称<span class="math inline">\(A_{ij}=(-1)^{i+j}M_{ij}\)</span>为元素<span class="math inline">\(a_{ij}\)</span>的代数余子式</li>
<li><span class="math inline">\(A^*\)</span>的第i行j列元素为上面的<span class="math inline">\(A_{ij}\)</span></li>
</ul></li>
<li>LU分解法A=LU，<span class="math inline">\(A^{-1}=U^{-1}L^{-1}\)</span></li>
<li>SVD分解法</li>
<li>QR分解法</li>
</ul></li>
<li>Transpose 矩阵的转置：<span class="math inline">\(A^T\)</span></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Issues of Icarus</title>
    <url>/Issues-of-Icarus/</url>
    <content><![CDATA[<h1 id="upload">Upload</h1>
<ul>
<li><p>每次上传都需要密码 _config.yml中将仓库地址改为:</p>
<p>git@github.com: yourname/yourname.github.io.git</p></li>
</ul>
<h1 id="widgets">Widgets</h1>
<h1 id="posts">Posts</h1>
<h2 id="content">Content</h2>
<ul>
<li><p><strong>Image not showing up</strong></p>
<p>Image should be under source/gallery/. Use Hexo's tag:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">{% img /gallery/image.jpg "image title" %\}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Excerpt / Read more</p>
<p>Put a &lt;! -- more --&gt;tag in the post.</p>
<p>Or in the front-matter, "excerpt: the content of the
excerpt"</p></li>
<li><p><a href="https://www.icode9.com/content-4-828659.html">Image host
via github</a></p></li>
</ul>
<h2 id="formula">Formula</h2>
<ul>
<li><p>无法正确渲染</p>
<p><a href="https://blog.csdn.net/yexiaohhjk/article/details/82526604?utm_medium=distribute.pc_relevant_bbs_down.none-task-blog-baidujs-1.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_bbs_down.none-task-blog-baidujs-1.nonecase">完美解决方案</a></p>
<p>上述方案无法解决类似*$这样的问题，如何解决？？</p></li>
<li><p>hexo公式换行的问题？？</p></li>
<li><p>公式内的“\#”无法解析，或其他公式渲染问题，报"Template render
error"错误 尽量不要用#符号</p></li>
</ul>
]]></content>
      <tags>
        <tag>Issues</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week03</title>
    <url>/Machine-Learning-Week03/</url>
    <content><![CDATA[<h1 id="machine-learning">Machine Learning</h1>
<h2 id="week-03-classification-and-representation-overfitting">Week 03
Classification and Representation | Overfitting</h2>
<h3 id="classification-and-representation-分类和表征">1. Classification
and Representation 分类和表征</h3>
<ol type="1">
<li><p><strong>Logistic Regression算法应用于Classification</strong></p>
<ul>
<li><p><strong>binary classification problem </strong>二元分类问题</p>
<ul>
<li>函数值是离散的discrete</li>
</ul></li>
<li><p><strong>Hypothesis Representation</strong> 假设陈述</p>
<ul>
<li><p>因为需要<span class="math inline">\(y∈\{0,1\}\)</span>，所以要使得<span class="math inline">\(0\le h_\theta(x)\le1\)</span>，令<span class="math display">\[h_\theta(x)=g(\theta^Tx),\
z=\theta^Tx,\  g(x)=\frac {1}{1+e^{-z}}\]</span></p></li>
<li><p><span class="math inline">\(h_\theta(x)\)</span>表示输出为1的概率: <span class="math display">\[
h_\theta(x)=P(y=1|x;\theta)=1-P(y=0|x;\theta)
\]</span></p></li>
</ul></li>
</ul></li>
<li><p><strong>Decision Boundary</strong> 决策边界：分类的边界 <span class="math display">\[
h_\theta(x)=g(\theta_0+\theta_1x_1+\theta_2x_2)
\]</span></p>
<ul>
<li><p>非线性(non-linear)决策边界</p>
<p>多项式是决策边界的属性，不是训练集的属性，训练集决定参数θ的值</p></li>
</ul></li>
</ol>
<h3 id="logistic-regression-model-逻辑回归模型">2. Logistic Regression
Model 逻辑回归模型</h3>
<ol type="1">
<li><p><strong>Cost Function</strong></p>
<ul>
<li><p>convex 凸函数，可以收敛到全局最小</p></li>
<li><p>不能使用linear regression的Cost function，因为这会使得logistic
function的成本函数变成波浪形，形成许多局部最优，就无法形成凸函数</p></li>
<li><p>因此替换成本函数为： <span class="math display">\[
J(\theta)=\frac {1}{m}\sum
\limits_{i=1}^mCost(h_\theta(x^{(i)}),y^{(i)}) \\
Cost(h_\theta(x),y)=
\begin{cases}-log(h_\theta(x)) &amp; \quad if\ y=1 \\
-log(1-h_\theta(x)) &amp; \quad if\ y=0
\end{cases}
\]</span></p>
<blockquote>
<p><strong>The cost function in this way guarantees that J(θ) is convex
for logistic regression.</strong></p>
</blockquote></li>
<li><p>这里的Cost function等价于： <span class="math display">\[
Cost(h_\theta(x),y)=-ylog(h_\theta(x))-(1-y)log(1-h_\theta(x))
\]</span></p></li>
<li><p>带入到代价函数 J(θ) 中</p></li>
<li><p>使用<strong>==最大似然估计法==</strong>可以得出这个代价函数，最大似然估计可以有效地为不同模型找到参数数据。</p></li>
<li><p>凸性是这个函数优秀地属性之一</p></li>
<li><p>接下来：为了拟合θ，就要最小化 J(θ)</p></li>
</ul></li>
<li><p><strong>Gradient Descent 梯度下降法</strong> <span class="math display">\[
\theta_j:=\theta_j-\alpha\frac {\partial} {\partial
\theta_j}J(\theta)=\theta_j-\alpha\frac {1}{m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)}\quad(for\ j=0...n)
\]</span></p>
<ul>
<li><p>选择学习速率：绘制 J(θ)
关于迭代次数的函数，使得每一次迭代函数值都在下降</p></li>
<li><p>可以使用向量化实现算法 <span class="math display">\[
\begin{array}{lc}
h=g(\theta^TX)\\
J(\theta)=\frac{1}{m}\cdot(-y^Tlog(h)-(1-y)^Tlog(1-h))\\
\text{注：这里X是$（n+1）\times1$维列向量}
\end{array}
\]</span> 最终得到： <span class="math display">\[
\theta:=\theta-\frac{\alpha}{m}X(g(\theta^TX)-\vec{y})
\]</span></p></li>
</ul></li>
</ol>
<ul>
<li>特征值缩放也同样适用该模型</li>
</ul>
<blockquote>
<p><strong>关于代价函数的最大似然估计法相关数学推导参见<a href="https://www.cnblogs.com/ranjiewen/p/5967496.html">这里</a></strong></p>
<p><strong>==统计学是机器学习的数学基础==</strong></p>
</blockquote>
<ol start="3" type="1">
<li><p>Optimization algorithm 优化算法</p>
<ul>
<li><p>例如：</p>
<ul>
<li><p>Conjugate gradient 共轭梯度法</p></li>
<li><p>BFGS变尺度法</p></li>
<li><p>L-BFGS限制变尺度法</p>
<p>优点：无需手动选择α（线性搜索法每一步都在改变α）；比梯度下降法收敛更快</p>
<p>缺点：算法更复杂、难理解</p></li>
</ul></li>
<li><p>octave中的优化算法表达：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">function [jVal, gradient] = costFunction(theta)</span><br><span class="line">  jVal = [...code to compute J(theta)...];</span><br><span class="line">  gradient = [...code to compute derivative of J(theta)...];</span><br><span class="line">end</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">options = optimset('GradObj', 'on', 'MaxIter', 100);</span><br><span class="line">initialTheta = zeros(2,1);</span><br><span class="line">   [optTheta, functionVal, exitFlag] = fminunc(@costFunction, initialTheta, options);</span><br></pre></td></tr></tbody></table></figure></li>
</ul></li>
</ol>
<h3 id="multiclass-classification-多类别分类问题">3. Multiclass
Classification 多类别分类问题</h3>
<ol type="1">
<li><p><strong>one-vs-all 一对多分类算法</strong></p>
<p>划分为多个二分类问题，求多个h(x)。应用于预测集时，将x分类到h最大的那个集里。</p>
<p><span class="math inline">\(h^{(i)}_\theta(x)=P(y=i|x;\theta),\quad
prediction=\max\limits_{i}(h^{(i)}_\theta(x))\)</span></p></li>
</ol>
<h3 id="overfitting-过拟合">4. Overfitting 过拟合</h3>
<ol type="1">
<li><p>underfitting ——
高bias偏差（Bias反映的是模型在样本上的输出与真实值之间的误差，即模型本身的精准度，即算法本身的拟合能力）</p>
<p>Overfitting ——
高variance方差（variance反映的是模型每一次输出结果与模型输出期望之间的误差，即模型的稳定性。反应预测的波动情况。）</p>
<blockquote>
<p>关于方差与偏差的意义参见<a href="https://blog.csdn.net/u012197749/article/details/79766317">这里</a></p>
</blockquote>
<ol start="2" type="1">
<li>解决过拟合：</li>
</ol>
<ul>
<li>减少特征的数量
<ul>
<li>手动选择保留的特征</li>
<li>模型选择算法model selection
algorithm，可以自动决定要保留的变量和要剔除的变量</li>
<li>缺点：剔除了一部分信息</li>
</ul></li>
<li>regularization 正则化
<ul>
<li>保留所有变量，减少变量θ的magnitude</li>
<li>在有很多变量时很有用</li>
</ul></li>
</ul>
<ol start="3" type="1">
<li>正则化</li>
</ol>
<ul>
<li>在代价函数加一个正则化项，使得参数θ尽可能小，排除bias偏差项</li>
</ul>
<p><span class="math display">\[
\min\limits_\theta\frac{1}{2m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)}+\lambda\sum\limits_{j=1}^n\theta_j^2
\]</span></p>
<ul>
<li><p>λ是正则化参数regularization parameter</p></li>
<li><p>应用于梯度下降法：（注：<span class="math inline">\(\theta_0\)</span>一定不要正则化！） <span class="math display">\[
\theta_j:=\theta_j-\alpha\frac {\partial} {\partial
\theta_j}J(\theta)=\theta_j-\alpha[\frac {1}{m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)}+\frac{\lambda}{m}\theta_j]\quad(for\
j=1...n)
\]</span></p></li>
<li><p>应用于正规方程normal equation： <span class="math display">\[
\theta=(X^TX+\lambda\cdot L)^{-1}X^Ty\\
where \quad L=\begin{bmatrix}0\\\
&amp;1\\\  &amp;\  &amp;1\\\  &amp;\  &amp;\  &amp;\ddots\\\  &amp;\  &amp;\  &amp;\  &amp;1\\\end{bmatrix}
\]</span></p>
<ul>
<li>Non-invertibility 不可逆性 suppose <span class="math inline">\(m\le
n\)</span>, 特征多于例子时，<span class="math inline">\(\theta=(X^TX)^{-1}X^Ty\)</span> 中，<span class="math inline">\(X^TX\)</span>是不可逆的（或奇异的），即为退化矩阵（degenerate）
但是加入λL
后，解决了上述问题，公式（9）括号内的矩阵是可逆的（前提是λ&gt;0）</li>
</ul></li>
</ul></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week04</title>
    <url>/Machine-Learning-Week04/</url>
    <content><![CDATA[<h2 id="neural-networks-representation">Neural Networks：
Representation</h2>
<h3 id="non-linear-hypotheses">1. Non-linear Hypotheses</h3>
<p>特征多，有高次项</p>
<h3 id="neural-networks">2. Neural Networks</h3>
<ol type="1">
<li><p>Model representation</p>
<ul>
<li><p>bias unit偏置项（=1）</p></li>
<li><p>sigmoid activation function S型激励函数</p></li>
<li><p>input layer —— hidden layer —— output layer</p></li>
<li><p><span class="math display">\[ a_i^{(j)}= "activation"\
of\ unit\ i\ in\ layer\  j \]</span></p>
<p><span class="math inline">\(\Theta^{(j)}=\)</span> matrix of weights
controlling function mapping from layer j to layer j+1
，即参数矩阵（波矩阵、权重矩阵）</p>
<p>如果一个网络在 j 层有<span class="math inline">\(s_j\)</span>个单元，j+1层有<span class="math inline">\(s_{j+1}\)</span>个单元，那么<span class="math inline">\(\Theta^{(j)}\)</span>的矩阵维度是<span class="math inline">\(s_{j+1}\times(s_j+1)\)</span>，因为要加上bias
unit</p>
<p><img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/屏幕截图 2020-11-09 112621.png" alt="神经网络" style="zoom:50%;">
<span class="math display">\[
\begin{array}{r}
a_{1}^{(2)}=g\left(\Theta_{10}^{(1)} x_{0}+\Theta_{11}^{(1)}
x_{1}+\Theta_{12}^{(1)} x_{2}+\Theta_{13}^{(1)}
x_{3}\right)=g(z_1^{(2)}) \\
a_{2}^{(2)}=g\left(\Theta_{20}^{(1)} x_{0}+\Theta_{21}^{(1)}
x_{1}+\Theta_{22}^{(1)} x_{2}+\Theta_{23}^{(1)}
x_{3}\right)=g(z_2^{(2)})  \\
a_{3}^{(2)}=g\left(\Theta_{30}^{(1)} x_{0}+\Theta_{31}^{(1)}
x_{1}+\Theta_{32}^{(1)} x_{2}+\Theta_{33}^{(1)} x_{3}\right)
=g(z_3^{(2)}) \\
h_{\Theta}(x)=a_{1}^{(3)}=g\left(\Theta_{10}^{(2)}
a_{0}^{(2)}+\Theta_{11}^{(2)} a_{1}^{(2)}+\Theta_{12}^{(2)}
a_{2}^{(2)}+\Theta_{13}^{(2)} a_{3}^{(2)}\right)
\end{array}
\]</span></p></li>
<li><p>即前向传播（forward propagation）</p></li>
</ul></li>
</ol>
<h3 id="applications">3. Applications</h3>
<ol type="1">
<li>与运算（-30，20，20）</li>
<li>或运算（-10，20，20）</li>
<li>非运算（10，-20）</li>
<li>XNOR运算，同或运算（相同为1，否则为0）：两层神经网络</li>
<li>Multiclass Classification，如果4个分类器结果则例如[0,0,1,0]</li>
</ol>
<p>​</p>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week02</title>
    <url>/Machine-Learning-Week02/</url>
    <content><![CDATA[<h1 id="multiple-feature">Multiple Feature</h1>
<h2 id="multivariate-linear-regression">Multivariate Linear
Regression</h2>
<ol type="1">
<li><p><span class="math inline">\(h_{\theta}(x)=\theta^{T}X\)</span></p>
<p><span class="math inline">\(h_θ(x)=\begin{bmatrix}θ_0&amp;θ_1&amp;...&amp;θ_n\end{bmatrix}\begin{bmatrix}x_0\\x_1\\⋮\\x_n\end{bmatrix}=θ^Tx\)</span></p></li>
<li><p>Gradient Descent for Multiple Variables</p>
<p>Cost function: <span class="math display">\[J(\theta_0,\theta_1...\theta_n)=\frac {1}{2m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2\]</span></p>
<p><span class="math display">\[\theta_j:=\theta_j-\alpha\frac
{\partial} {\partial \theta_j}J(\theta)=\theta_j-\alpha\frac {1}{m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})x_j^{(i)}\quad(for\
j=0...n)\]</span></p></li>
<li><p>Feature Scaling</p>
<p>Make sure features are on a similar scale</p>
<p>避免梯度下降一个维度值过大导致下降速率很慢</p>
<ul>
<li>Get every feature into approximately a <span class="math inline">\(-1\le x_i\le 1\)</span> range</li>
<li>大约在这个范围附近就行，例如: <span class="math inline">\(-2\le
x_i\le 2\)</span>也可以</li>
<li>方法一：都除以最大值<span class="math inline">\(x_{max}\)</span></li>
<li>均值归一化 Mean normalization：
<ul>
<li><span class="math display">\[\frac{x_i-\mu_i}{s_{i}}\]</span></li>
<li>使得均值为0</li>
<li><span class="math inline">\(\mu\)</span>是训练集x某特征的均值，s可以是标准差，一般<span class="math inline">\(s=max-min\)</span>即可</li>
<li>特征缩放不用太精确，只是为了让梯度下降更快而已</li>
</ul></li>
</ul></li>
<li><p>确定α</p>
<ul>
<li>如果α过大，则可能出现 J 值增大或者不收敛</li>
<li>让α尽量小，使得每次迭代 J 值都在减小</li>
<li>自动收敛测试：可以设定一个值比如0.001，如果每一步J变化小于这个值即可认为收敛，但是选择合适的值很困难</li>
<li>所以可以采用：代价函数 J
随迭代步数变化曲线，可以帮助判断梯度下降算法是否收敛</li>
</ul></li>
<li><p>多项式回归 Polynomial Regression</p>
<ul>
<li>拟合复杂函数</li>
<li>将x进行平方、开根等处理。例如：<span class="math inline">\(x_3=x_1^3\)</span></li>
<li>注意新特征要进行均值归一化使得各个特征之间差距不至于过大</li>
</ul></li>
<li><p>Normal equation 正规方程</p>
<ul>
<li>solve for θ analytically，θ的解析解法</li>
<li><span class="math display">\[J(\theta_0,\theta_1...\theta_n)=\frac
{1}{2m}\sum \limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2\]</span>
，令<span class="math inline">\(\frac {\partial} {\partial
\theta_j}J(\theta)=0\)</span>(偏微分)
<ul>
<li><span class="math inline">\(X=\begin{bmatrix}x_0&amp;x_1&amp;...&amp;x_n\end{bmatrix}\)</span>，x代表特征的列向量集合</li>
<li>则可以推出：<span class="math inline">\(\theta=(X^TX)^{-1}X^Ty\)</span>，即正规方程</li>
</ul></li>
<li>matlab：pinv(X‘*X)*X'*y</li>
<li>用正规方程就不用变量归一化</li>
<li>优点：不用选择α；不用迭代</li>
<li>缺点：n较大时，算逆矩阵会比较慢，n&gt;10000，复杂度大约在<span class="math inline">\(O(n^3)\)</span></li>
<li>正规方程的不可逆性 Normal Equation Non-invertibility
<ul>
<li>pinv可以求伪逆，inv求逆</li>
<li>如果<span class="math inline">\(X^TX\)</span>是不可逆的：
<ul>
<li>特征之间是相关的</li>
<li>特征多于样本数</li>
<li>解决方法：删除多余特征或正则化</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week05</title>
    <url>/Machine-Learning-Week05/</url>
    <content><![CDATA[<h2 id="neural-networks-learning">Neural Networks Learning</h2>
<h3 id="cost-function-and-propagation">Cost Function and
Propagation</h3>
<ol type="1">
<li><p>Cost Function</p>
<ul>
<li><p>L 神经网络的层数</p></li>
<li><p><span class="math inline">\(s_l\)</span>第l层的神经元个数，不包括bias
unit</p></li>
<li><p>K输出层的神经元个数（即种类）</p></li>
<li><p>binary classification二元分类</p></li>
<li><p>Logistic regression的代价函数： <span class="math display">\[
J(\theta)=-\frac {1}{m}\sum \limits_{i=1}^m\bigg
[y^{(i)}log(h_\theta(x^{(i)}))-(1-y^{(i)})log(1-h_\theta(x^{(i)}))\bigg
]+\frac{\lambda}{2m}\sum \limits_{j=1}^n\theta_j^2
\]</span></p></li>
<li><p>神经网络的代价函数： <span class="math display">\[
J(\Theta)=-\frac{1}{m} \sum_{i=1}^{m} \sum_{k=1}^{K}\left[y_{k}^{(i)}
\log \left((h_{\Theta}(x^{(i)}))_{k}\right)+\left(1-y_{k}^{(i)}\right)
\log \left(1-(h_{\Theta}(x^{(i)}))_{k}\right)\right]+\frac{\lambda}{2 m}
\sum_{l=1}^{L-1} \sum_{i=1}^{s_l}
\sum_{j=1}^{s_{l+1}}(\theta_{j,i}^{(l)})^2
\]</span></p>
<ul>
<li>两个求和符号部分只是将输出层中每个单元的逻辑回归代价函数相加</li>
<li>三个求和符号部分只是将整个网络中所有单个θ的平方相加，其中i并不指代训练实例i</li>
</ul></li>
</ul></li>
<li><p>反向传播算法Backpropagation Algorithm</p>
<ul>
<li><p>梯度下降计算</p>
<ul>
<li><p>min J（θ）就需要计算：J（θ）；J（θ）关于各个θ的偏导</p></li>
<li><p>计算过程：先forward propagation；再反向</p></li>
<li><p><span class="math inline">\(\delta_j^{l}="error"\ of\
node\ j\ in\ layer\ l\)</span>用于改变activation激励值, Formally, <span class="math inline">\(\delta_j^{(l)}=\frac \partial {\partial
z_{j}^{(l)}} cost(j)\)</span>, 其中<span class="math inline">\(cost(i)=y^{(i)}log(h_\Theta(x^{(i)}))-(1-y^{(i)})log(1-h_\Theta(x^{(i)}))\)</span>,
求导后易得<span class="math inline">\(\delta_j^{(l)}=y_j^{(l)}-a_j^{(l)}\)</span>(为什么符号是相反的？答：这里cost错误，和前文代价函数符号相反，应该要变号)</p></li>
<li><p>计算过程：</p>
<ul>
<li><p>令<span class="math inline">\(\Delta_{i,j}^{l}:=0\)</span></p></li>
<li><p>For training example t =1 to m:</p>
<ol type="1">
<li><p>Set <span class="math inline">\(a^{(1)} :=
x^{(t)}\)</span></p></li>
<li><p>Perform forward propagation to compute <span class="math inline">\(a^{(l)}\ for\ l=2,3,…,L\)</span></p>
<p>(此处失效图片链接)img
(https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/bYLgwteoEeaX9Qr89uJd1A_73f280ff78695f84ae512f19acfa29a3_Screenshot-2017-01-10-18.16.50.png?expiry=1606176000000&amp;hmac=9aVGT1io0l-sybFSrc1stejo_L0d7hzlNXbQIt47h2Y)</p></li>
<li><p>Using <span class="math inline">\(y^{(t)}\)</span>, compute$
^{(L)} = a^{(L)} - y^{(t)}$</p>
<p>Where L is our total number of layers and
a^{(L)}<em>a</em>(<em>L</em>) is the vector of outputs of the activation
units for the last layer. So our "error values" for the last layer are
simply the differences of our actual results in the last layer and the
correct outputs in y. To get the delta values of the layers before the
last layer, we can use an equation that steps us back from right to
left:</p></li>
<li><p>Compute$ ^{(L-1)}, <sup>{(L-2)},,</sup>{(2)}<span class="math inline">\(using\)</span>$ ^{(l)} = ((<sup>{(l)})</sup>T
^{(l+1)})&nbsp;.<em>&nbsp;a^{(l)}&nbsp;.</em>&nbsp;(1 - a^{(l)}) $$</p>
<p>The delta values of layer l are calculated by multiplying the delta
values in the next layer with the theta matrix of layer l. We then
element-wise multiply that with a function called g', or g-prime, which
is the derivative of the activation function g evaluated with the input
values given by <span class="math inline">\(z^{(l)}\)</span>.</p>
<p>The g-prime derivative terms can also be written out as:</p>
<p><span class="math inline">\(g′(z^{(l)})=a^{(l)} .∗
(1−a^{(l)})\)</span></p></li>
<li><p><span class="math inline">\(Δ_{i,j}^{(l)}:=Δ_{i,j}^{(l)}+a_j^{(l)}δ_i^{(l+1)}\)</span>,
or with vectorization, <span class="math inline">\(Δ^{(l)}:=Δ^{(l)}+δ^{(l+1)}(a^{(l)})^T\)</span></p>
<p>Hence we update our new <span class="math inline">\(\Delta\)</span>
matrix.</p>
<ul>
<li><p><span class="math inline">\(D_{i,
j}^{(l)}:=\frac{1}{m}\left(\Delta_{i, j}^{(l)}+\lambda \Theta_{i,
j}^{(l)}\right), \text { if } j \neq 0\)</span></p></li>
<li><p><span class="math inline">\(D_{i, j}^{(l)}:=\frac{1}{m}\Delta_{i,
j}^{(l)}, \text { if } j = 0\)</span></p>
<p>The capital-delta matrix D is used as an "accumulator" to add up our
values as we go along and eventually compute our partial derivative.
Thus we get$ J()= D_{ij}^{(l)}$</p></li>
</ul></li>
</ol></li>
</ul></li>
<li><p><a href="https://zhuanlan.zhihu.com/p/26765585">上述计算过程的中文推导</a></p></li>
</ul></li>
</ul></li>
</ol>
<h3 id="backpropagation-in-practice">Backpropagation in practice</h3>
<ol type="1">
<li><p>系数展开到向量：</p>
<ul>
<li><p>M(a,b)，既取a，也取b，从1开始</p></li>
<li><p>优化算法（如：fminunc）默认将参数整合到一个向量中</p>


   - 
   <figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">%代码过程</span><br><span class="line">thetaVector = [ Theta1(:); Theta2(:); Theta3(:); ]</span><br><span class="line">deltaVector = [ D1(:); D2(:); D3(:) ]</span><br><span class="line"></span><br><span class="line">Theta1 = reshape(thetaVector(1:110),10,11)</span><br><span class="line">Theta2 = reshape(thetaVector(111:220),10,11)</span><br><span class="line">Theta3 = reshape(thetaVector(221:231),1,11)</span><br></pre></td></tr></tbody></table></figure>

     </li>
<li><p>过程：(此处失效图片链接)img(https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/kdK7ubT2EeajLxLfjQiSjg_d35545b8d6b6940e8577b5a8d75c8657_Screenshot-2016-11-27-15.09.24.png?expiry=1606348800000&amp;hmac=bH794vb16zxSOiqZRj2Pe0PyuaYNbZ8tDQZlnGSoM18)</p></li>
</ul></li>
<li><p>梯度检验gradient checking</p>
<ul>
<li><p><span class="math inline">\(\frac{d}{d\Theta}J(\Theta)\approx
\frac{J(\Theta+\epsilon)+J(\Theta-\epsilon)}{2\epsilon}\)</span>，ε =
<span class="math inline">\(10^{-4}\)</span></p></li>
<li><p><span class="math display">\[
\dfrac{\partial}{\partial\Theta_j}J(\Theta) \approx \dfrac{J(\Theta_1,
\dots, \Theta_j + \epsilon, \dots, \Theta_n) - J(\Theta_1, \dots,
\Theta_j - \epsilon, \dots, \Theta_n)}{2\epsilon}
\]</span></p></li>
<li><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">epsilon = 1e-4;</span><br><span class="line">for i = 1:n,</span><br><span class="line">  thetaPlus = theta;</span><br><span class="line">  thetaPlus(i) += epsilon;</span><br><span class="line">  thetaMinus = theta;</span><br><span class="line">  thetaMinus(i) -= epsilon;</span><br><span class="line">  gradApprox(i) = (J(thetaPlus) - J(thetaMinus))/(2*epsilon)</span><br><span class="line">end;</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>Check: gradApprox ≈
deltaVector，只需要验证一次即可，否则这种方法会非常慢</p></li>
</ul></li>
<li><p>Random Initialization随机初始化</p>
<ul>
<li><p>Symmetry
breaking，因为如果设为一样的会使得梯度下降后参数也一样</p></li>
<li><p>将每一个<span class="math inline">\(\Theta_{ij}^{(l)}\)</span>设为在[-ε，ε]之间的随机数，但要同时设置，以防出现相同，例：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Theta1 = rand(10,11)*2*init_epsilon-init_epsilon;</span><br></pre></td></tr></tbody></table></figure>
<p>(Note: the epsilon used above is unrelated to the epsilon from
Gradient Checking)</p></li>
</ul></li>
<li><p>总体回顾</p>
<ul>
<li>一般默认隐藏层每层神经元数量一致</li>
<li>构建一个模型的过程：
<ol type="1">
<li>初始化模型
<ul>
<li>Number of input units = dimension of features
x^{(i)}<em>x</em>(<em>i</em>)</li>
<li>Number of output units = number of classes</li>
<li>Number of hidden units per layer = usually more the better (must
balance with cost of computation as it increases with more hidden
units)</li>
<li>Defaults: 1 hidden layer. If you have more than 1 hidden layer, then
it is recommended that you have the same number of units in every hidden
layer.</li>
</ul></li>
<li><strong>Training a Neural Network</strong>
<ol type="1">
<li>Randomly initialize the weights</li>
<li>Implement forward propagation to get <span class="math inline">\(h_\Theta(x^{(i)})\)</span> for any <span class="math inline">\(x^{(i)}\)</span></li>
<li>Implement the cost function</li>
<li>Implement backpropagation to compute partial derivatives</li>
<li>Use gradient checking to confirm that your backpropagation works.
Then disable gradient checking.</li>
<li>Use gradient descent or a built-in optimization function to minimize
the cost function with the weights in theta.</li>
<li>对每一个训练样例循环上述步骤（有可能得到局部最优，因为J（θ）是非凸函数）</li>
</ol></li>
</ol></li>
</ul></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week06</title>
    <url>/Machine-Learning-Week06/</url>
    <content><![CDATA[<h2 id="deciding-what-to-try-next">Deciding What to Try Next</h2>
<h3 id="evaluating-a-learning-algorithm">Evaluating a Learning
Algorithm</h3>
<ol type="1">
<li><p>误差大的改进方法：</p>
<ul>
<li>更多数据</li>
<li>更少特征集避免过拟合</li>
<li>更多特征</li>
<li>增加多项式特征</li>
<li>减少或增大正则化参数值</li>
</ul></li>
<li><p>评估假设函数Evaluating a Hypothesis</p>
<ul>
<li><p>如何判断过拟合？</p>
<ul>
<li><p>随机将数据分为两部分，一部分是训练集，一部分是预测集（30%）</p></li>
<li><p>学习训练集的参数θ（即最小化训练误差J ）</p></li>
<li><p>计算测试集误差</p>
<ul>
<li><p>线性回归中计算测试集的 J(θ)</p></li>
<li><p>逻辑回归中可以用误分类率来计算error：</p>
<p><span class="math inline">\(err(h_\theta(x),y)=\begin{cases}1,&amp;if\
h_\theta(x)\ge 0.5,y=0\  or\ if\ h_\theta(x)&lt;0.5, y=1\\0,
&amp;otherwise\end{cases}\)</span></p>
<p><span class="math inline">\(Test\
error=\frac{1}{m_{test}}\sum\limits_{i=1}^{m_{test}}err(h_\theta(x_{test}^{(i)},y^{(i)}))\)</span></p></li>
</ul></li>
</ul></li>
</ul></li>
<li><p>模型选择问题：确定对于某组数据最合适的多项式是几次，怎样选用正确的特征来构造学习算法，或者需要正确选择算法中的正则化参数λ</p>
<ul>
<li>将数据分为三段：训练集（60%），交叉验证集（cross
validation）（20%），测试集（20%）</li>
<li>用不同的多项式模型得到θ，然后计算交叉验证集的误差，看看哪个模型中CV集的误差最小，进而选择那个多项式模型</li>
<li>最后计算测试集误差评价模型表现</li>
</ul></li>
</ol>
<h3 id="bias-vs.-variance">Bias vs. Variance</h3>
<ol type="1">
<li><p>分析bias和variance</p>
<ul>
<li>高偏差：欠拟合；高方差：过拟合</li>
<li>高偏差：
<ul>
<li><span class="math inline">\(J_{train}(\theta)\)</span>will be high,
the same as <span class="math inline">\(J_{CV}(\theta)\approx
J_{train}(\theta)\)</span></li>
</ul></li>
<li>高方差：
<ul>
<li><span class="math inline">\(J_{train}(\theta)\)</span>will be low,
<span class="math inline">\(J_{CV}(\theta)\gg
J_{train}(\theta)\)</span></li>
</ul></li>
<li><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/I4dRkz_pEeeHpAqQsW8qwg_bed7efdd48c13e8f75624c817fb39684_fixed.png?expiry=1606262400000&amp;hmac=zQgQniOf2GNzDd--YwZNZhUDjMOAn1JxYg1s_gG_d_I" title="fig:" alt="img"></li>
</ul></li>
<li><p>正则化与方差、偏差的关系</p>
<ul>
<li><p>正则化可以有效防止过拟合</p></li>
<li><p>选择λ的过程：</p>
<ul>
<li>Create a list of lambdas (i.e.
λ∈{0,0.01,0.02,0.04,0.08,0.16,0.32,0.64,1.28,2.56,5.12,10.24});</li>
<li>Create a set of models with different degrees or any other
variants.</li>
<li>Iterate through the λs and for each λ go through all the models to
learn some Θ.</li>
<li>Compute the cross validation error using the learned Θ (computed
with λ) on the$ J_{CV}()$ <strong>without</strong> regularization or λ =
0.</li>
<li>Select the best combo that produces the lowest error on the cross
validation set.</li>
<li>Using the best combo Θ and λ, apply it on$ J_{test}()$ to see if it
has a good generalization of the problem.</li>
</ul></li>
<li><p>注：训练时带λ，计算各个集的误差时不需要λ，即<span class="math inline">\(J_{train}(\theta)\)</span>、<span class="math inline">\(J_{CV}(\theta)\)</span>、<span class="math inline">\(J_{test}(\theta)\)</span>都不包含正则项 <span class="math display">\[
J_{train}(\theta)=\frac {1}{2m}\sum
\limits_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2
\]</span></p></li>
</ul></li>
<li><p>学习曲线（error-训练集的大小）</p>
<ul>
<li>高偏差
<ul>
<li><strong>Low training set size</strong>: causes <span class="math inline">\(J_{train}(\Theta)\)</span> to be low and <span class="math inline">\(J_{CV}(\Theta)\)</span> to be high.</li>
<li><strong>Large training set size</strong>: causes both <span class="math inline">\(J_{train}(\Theta)\)</span> and <span class="math inline">\(J_{CV}(\Theta)\)</span> to be high with <span class="math inline">\(J_{train}(\Theta)≈J_{CV}(\Theta)\)</span>.</li>
<li>高偏差，更多训练数据不会有很大帮助</li>
<li><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/bpAOvt9uEeaQlg5FcsXQDA_ecad653e01ee824b231ff8b5df7208d9_2-am.png?expiry=1606262400000&amp;hmac=-xKhLZnoeJ_Ht3_X7XaX3Jae2F94vNrpbyPcMCExkPg" title="fig:" alt="img"></li>
</ul></li>
<li>高方差
<ul>
<li><strong>Low training set size</strong>: causes <span class="math inline">\(J_{train}(\Theta)\)</span> to be low and <span class="math inline">\(J_{CV}(\Theta)\)</span> to be high.</li>
<li><strong>Large training set size</strong>: <span class="math inline">\(J_{train}(\Theta)\)</span> increases with training
set size and <span class="math inline">\(J_{CV}(\Theta)\)</span>
continues to decrease without leveling off. Also, <span class="math inline">\(J_{train}(\Theta) &lt; J_{CV}(\Theta)\)</span> but
the difference between them remains significant.</li>
<li>高方差，更多训练数据可能有帮助</li>
<li><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/vqlG7t9uEeaizBK307J26A_3e3e9f42b5e3ce9e3466a0416c4368ee_ITu3antfEeam4BLcQYZr8Q_37fe6be97e7b0740d1871ba99d4c2ed9_300px-Learning1.png?expiry=1606262400000&amp;hmac=6kgO1n2qmCGikLwAE15RXslkLQYjwcHJ2utP_e9INDk" title="fig:" alt="img"></li>
</ul></li>
</ul></li>
<li><p>诊断法则如何判断</p>
<ul>
<li>更多训练数据——高方差，画学习曲线</li>
<li>更少特征集避免过拟合——高方差</li>
<li>更多特征——高偏差</li>
<li>增加多项式特征——高偏差</li>
<li>减少（高偏差）或增大正则化参数值（高方差）
<ul>
<li>正则化会保留所有的特征变量，但是会减小特征变量的数量级。正则化就是使用惩罚项，通过惩罚项，我们可以将一些参数的值变小。通常参数值越小，对应的函数也就越光滑，也就是更加简单的函数，因此不容易发生过拟合问题。</li>
</ul></li>
<li>神经网络很容易过拟合，正则化项非常有用
<ul>
<li>如何选择几层隐藏层：
<ul>
<li>通过交叉验证集，测试1，2，…，l个隐藏层的误差，选择表现最好的一个</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<h3 id="build-a-spam-classifier">Build a Spam Classifier</h3>
<ol type="1">
<li>做法：
<ul>
<li>遍历整个训练集，然后在中间选出出现次数最多的n个单词，n一般介于10000和50000之间，作为特征</li>
<li>列出可能的做法，讨论可行性，然后选择一个方向</li>
</ul></li>
<li>误差分析
<ul>
<li>推荐做法：
<ul>
<li>用简单算法快速实现，然后测试CV集（避免过早优化）</li>
<li>画学习曲线，决定是否需要更多数据、更多特征或其他</li>
<li>误差分析：手动检验CV集中的错误分类样本，发现系统性的错误分类特征，构造更好的特征
<ul>
<li>手动对错误的部分分类</li>
<li>发现特征</li>
<li>用数字来量化表现误差（在CV集上，不能在test集上）</li>
</ul></li>
</ul></li>
</ul></li>
<li>stem词干提取（porter stemmer）</li>
<li>skewed classes 偏斜类问题
<ul>
<li>癌症的比例非常非常低</li>
<li>查准率（precision）：预测为1的病人里，多少是真正得癌症的
<ul>
<li><span class="math inline">\(=\frac{True\ positives}{predicted\
positives}=\frac{True\ positives}{True\ pos+False\ pos}\)</span></li>
</ul></li>
<li>召回率Recall：实际得癌症的病人里，多少是真正预测得癌症的
<ul>
<li><span class="math inline">\(=\frac{True\ positives}{actual\
positives}=\frac{True\ positives}{True\ pos+False\ neg}\)</span></li>
</ul></li>
<li><img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/113quiz1q1.png"></li>
<li>假设现在想要预测y=1，当非常自信的情况下（修改<span class="math inline">\(h_\theta(x)\)</span>分类临界值threshold0.5为0.9）：高查准，低召回</li>
<li>假设想要避免错过癌症案例，（修改<span class="math inline">\(h_\theta(x)\)</span>分类临界值0.5为0.3）：高召回，低查准</li>
<li>绘制查准率-召回率曲线</li>
<li><span class="math inline">\(F_1\)</span>Score <span class="math inline">\(=\frac{2PR}{P+R}\)</span>:
<ul>
<li>评估选择算法或者不同临界值的量化标准</li>
</ul></li>
</ul></li>
<li>Data For Machine Learning
<ul>
<li>有大量训练数据可以显著提升算法表现，可能得到低方差、低偏差的结果，test误差和train误差也相近</li>
<li>多项式参数对大训练集没有帮助</li>
</ul></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week07</title>
    <url>/Machine-Learning-Week07/</url>
    <content><![CDATA[<h2 id="support-vector-machines-支持向量机">Support Vector Machines
支持向量机</h2>
<h3 id="large-margin-classification">Large Margin Classification</h3>
<ol type="1">
<li><p>Optimization Objective 优化目标</p>
<ul>
<li><p>在复杂非线性方程的学习上有优势。</p></li>
<li><figure>
<img src="C:\Users\Jun\AppData\Roaming\Typora\typora-user-images\image-20201206123628670.png" alt="image-20201206123628670">
<figcaption aria-hidden="true">image-20201206123628670</figcaption>
</figure></li>
<li><figure>
<img src="C:\Users\Jun\AppData\Roaming\Typora\typora-user-images\image-20201206124245802.png" alt="image-20201206124245802">
<figcaption aria-hidden="true">image-20201206124245802</figcaption>
</figure>
<p>注：实际上在训练代价函数时，分界线为-1，1</p></li>
</ul></li>
<li><p>Large Margin Intuition</p>
<ul>
<li><p>代价函数： <span class="math display">\[
\min _{\theta} C \sum_{i=1}^{m}\left[y^{(i)}
{\operatorname{cost}_{1}\left(\theta^{T}
x^{(i)}\right)}+\left(1-y^{(i)}\right)
\operatorname{cost}_{0}\left(\theta^{T}
x^{(i)}\right)\right]+\frac{1}{2} \sum_{i=1}^{n} \theta_{j}^{2}\\
if\ y=1, we\ want\ \theta^{T} x \geq 1\ (not\ just \left.\geq 0\right)\\
if\ y=0, we\ want\ \theta^{T} x \leq-1\ (not\ just&lt;0 )
\]</span></p></li>
<li><p>SVM也被叫做大间距分类器，因为它尽量用最大间距分类样本，使得SVM更具有鲁棒性</p></li>
<li><p>其中正则化参数C不适合设置得过大，因为这会使得一些异常值（outliner)
会使得分类向异常值产生比较大得偏差，这就类似与逻辑回归里过小的λ
。</p></li>
</ul></li>
<li><p>Mathematics Behind Large Margin Classification</p>
<ul>
<li><p>向量内积：<span class="math inline">\(\lVert u
\rVert\)</span>表明u的范数，即u向量的长度。<span class="math inline">\(u^Tv=p\cdot\lVert u \rVert\)</span>, p
是v在u上的投影长度</p></li>
<li><p>本图演示了为什么这种方式可以最小化θ<img src="C:\Users\Jun\AppData\Roaming\Typora\typora-user-images\image-20201206171424283.png" alt="image-20201206171424283"></p>
<p>注：这里决策边界和θ是具有垂直关系的</p></li>
<li><p>这里最小化θ范数等价于最大化所有的p，即最大化所有点到决策边界的margin。</p></li>
<li><p>即使<span class="math inline">\(\theta_0\ne0\)</span>推理过程也和上述类似</p></li>
</ul></li>
</ol>
<h3 id="kernels">Kernels</h3>
<ol type="1">
<li><p>非线性决策边界</p>
<ul>
<li><p>用相似度函数similarity
function代替高阶项，度量样本x和第一个标记的相似度，即核函数，例如：高斯核函数：<span class="math inline">\(f_1=similarity(x,l^{(1)})=exp(-\frac{\lVert
x-l^{(1)}
\rVert^2}{2\sigma^2})=exp(-\frac{\Sigma_{j=1}^{n}(x_j-l_j^{(i)})^2}{2\sigma^2})\)</span></p>
<p>==问：这里σ是什么，如何计算？==</p></li>
<li><p>通过用f替代特征，可以训练出复杂的非线性边界：例如：预测y=1，当<span class="math inline">\(\theta_0+\theta_1f_1+\theta_2f_2+\theta_3f_3\ge0\)</span></p></li>
</ul></li>
<li><p>选择landmark标记点 l :</p>
<ul>
<li>Given一系列x，令<span class="math inline">\(l^1=x^1\)</span>, <span class="math inline">\(f_{m}^{(i)}=similarity(x^{(i)},l^{(m)})\)</span></li>
<li>将<span class="math inline">\(x^{(i)}\in
\mathbb{R}^{n+1}\)</span>，转变为<span class="math inline">\(f^{(i)}=\begin{bmatrix}f_0^{(i)}\\f_0^{(i)}\\
\vdots \\ f_m^{(i)} \end{bmatrix}\)</span>，<span class="math inline">\(f_0^{(i)}=1\)</span>。<span class="math inline">\(f\in \mathbb{R}^{m+1}\)</span></li>
</ul></li>
<li><p>Hypothesis：Given x ， compute features f</p>
<p>Predict "y=1" if <span class="math inline">\(\theta^Tf\ge0\)</span></p></li>
<li><p>代价函数： <span class="math display">\[
\min _{\theta} C \sum_{i=1}^{m} y^{(i)}
\operatorname{cost}_{1}\left(\theta^{T}
f^{(i)}\right)+\left(1-y^{(i)}\right)
\operatorname{cost}_{0}\left(\theta^{T} f^{(i)}\right)+\frac{1}{2}
\sum_{j=1}^{m } \theta_{j}^{2}
\]</span> 在SVM的实际应用中，最后一项通常会用<span class="math inline">\(\theta^TM\theta\)</span>，其中M和核函数有关，是为了提高计算效率</p></li>
<li><p>参数的选择：</p>
<ul>
<li><p>C(=<span class="math inline">\(\frac{1}{\lambda}\)</span>)</p>
<ul>
<li>Large C：Lower bias；High variance</li>
<li>Small C：Higher bias；Low variance</li>
</ul></li>
<li><p><span class="math inline">\(\sigma^2\)</span></p>
<ul>
<li><p>Large <span class="math inline">\(\sigma^2\)</span>: Fearures fi
vary more smoothly.</p>
<p>​ Higher bias; Lower variance</p></li>
<li><p>Small <span class="math inline">\(\sigma^2\)</span>: Features fi
vary less smoothly.</p>
<p>​ Lower bias, Higher variance.</p></li>
</ul></li>
<li><p><strong>方差（variance）：</strong>方差描述的是训练数据在不同迭代阶段的训练模型中，预测值的变化波动情况（或称之为离散情况）。</p></li>
<li><p><strong>偏差（bias）：</strong>偏差衡量了模型的预测值与实际值之间的偏离关系。</p></li>
<li><p>低偏差高方差：过拟合；</p></li>
<li><p>You want to train C and the parameters for the kernel function
using the training and cross-validation datasets.</p></li>
</ul></li>
</ol>
<h3 id="svms-in-practice">SVMs in Practice</h3>
<ol type="1">
<li><p>应用SVM</p>
<ul>
<li><p>选择C和σ</p>
<figure class="highlight matlab"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">[C, sigma]</span> = <span class="title">dataset3Params</span><span class="params">(X, y, Xval, yval)</span></span></span><br><span class="line"><span class="comment">% 这里x是训练集，xval是验证集</span></span><br><span class="line">value = [<span class="number">0.01</span>, <span class="number">0.03</span>, <span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">30</span>];</span><br><span class="line"></span><br><span class="line">minC = <span class="number">0</span>;</span><br><span class="line">minSigma = <span class="number">0</span>;</span><br><span class="line"><span class="comment">% 最小值设为交叉验证集的用例数</span></span><br><span class="line">minError = <span class="built_in">size</span>(Xval,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="number">8</span>,</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">j</span> = <span class="number">1</span>:<span class="number">8</span>,</span><br><span class="line">        model= svmTrain(X, y, value(<span class="built_in">i</span>), @(x1, x2) gaussianKernel(x1, x2, value(<span class="built_in">j</span>)));</span><br><span class="line">        predictions = svmPredict(model,Xval);</span><br><span class="line">        error = <span class="built_in">mean</span>(double(predictions ~= yval));</span><br><span class="line">        <span class="keyword">if</span> minError &gt; error</span><br><span class="line">            minError = error;</span><br><span class="line">            minC = value(<span class="built_in">i</span>);</span><br><span class="line">            minSigma = value(<span class="built_in">j</span>);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">C = minC;</span><br><span class="line">sigma = minSigma;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><p>选择核函数（相似度函数）</p>
<ul>
<li>线性核函数（=没有核函数）</li>
</ul></li>
<li><p><strong>需要对特征向量归一化</strong>，否则一个特征会占据主要位置</p></li>
<li><p>不是所有函数都能作为核函数，需要满足Mercer‘s
Theorem莫塞尔定理，来确保SVM优化包能够正确运行</p></li>
<li><p>其他核函数：</p>
<ul>
<li>多项式核函数</li>
<li>字符串核函数string kernel；</li>
<li>卡方核函数chi-square kernel</li>
<li>直方图交叉核函数histogram intersection kernel</li>
</ul></li>
<li><p>多类别分类</p>
<ul>
<li>svm包多数内置了</li>
<li>否则用one-vs-all
：训练得到K组θ的值，然后选择θx最大的那一组作为分类结果</li>
</ul></li>
<li><p>逻辑回归和SVM，什么时候用？</p>
<ul>
<li>n为特征数，m为训练集样本数。如果n相对于m来说比较大，使用逻辑回归或者没有核函数的SVM（linear
kernel）</li>
<li>n小，m中等大。使用高斯核函数</li>
<li>n小，m很大。运行很慢，逻辑回归或没有核函数的SVM</li>
<li>神经网络上面都适用，但有时可能会比SVM慢很多</li>
</ul></li>
<li><p>SVM属于凸优化问题，大多数包都会找到全局最优，无需担心局部最优。神经网络的局部最优问题不是非常大但也不小。</p></li>
</ul></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week08</title>
    <url>/Machine-Learning-Week08/</url>
    <content><![CDATA[<h1 id="unsupervised-learning-无监督学习">Unsupervised learning
无监督学习</h1>
<h2 id="clustering-聚类">Clustering 聚类</h2>
<p>无监督学习是不给分类标签y</p>
<h3 id="应用">1. 应用：</h3>
<ul>
<li>对消费者市场划分</li>
<li>社交网络分析</li>
<li>管理计算机</li>
<li>获取星系信息</li>
</ul>
<h3 id="k-means-algorithm-k均值算法">2. K-means algorithm K均值算法</h3>
<ul>
<li><p>随机选择两个点作为聚类中心(分两类)，然后进行下面两步</p>
<ul>
<li>簇分配，遍历每个点，和哪个cluster centroid更近</li>
<li>移动聚类中心到上面分配的簇的均值</li>
</ul></li>
<li><p>Input:</p>
<ul>
<li>K - number of clusters</li>
<li>training set</li>
</ul></li>
<li><p>algorithm</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"> repeat{</span><br><span class="line">	for i=1 to m</span><br><span class="line">		c_i := index (from 1 to K) of cluster centroid closest to x_i</span><br><span class="line">    for k=1 to K</span><br><span class="line">    	u_k := average (mean) of points assigned to cluster k</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>如果有中心没有被分配到任何点，可以删去这个分类，也可以reinitialize
the cluster centroid</p></li>
</ul>
<h3 id="k-means-for-non-sperated-clusters">3. K-means for non-sperated
clusters</h3>
<ul>
<li>根据身高体重分类T恤大小</li>
</ul>
<h3 id="optimization-objective">4. Optimization Objective</h3>
<ul>
<li><p><span class="math display">\[
\begin{array}{l}
J\left(c^{(1)}, \ldots, c^{(m)}, \mu_{1}, \ldots,
\mu_{K}\right)=\frac{1}{m}
\sum_{i=1}\left\|x^{(i)}-\mu_{c^{(i)}}\right\|^{2} \\
\min _{c^{(1)}, \ldots, c^{(m)},\mu_{1}, \ldots, \mu_{K}}
J\left(c^{(1)}, \ldots, c^{(m)}, \mu_{1}, \ldots, \mu_{K}\right)
\end{array}
\]</span></p></li>
<li><p>also called distortion of K-means algorithm</p></li>
<li><p>cost function 关于iteration的曲线</p></li>
</ul>
<h3 id="random-initialization">5. Random Initialization</h3>
<p>随机初始化聚类中心</p>
<p>随机选k个个例本身，作为中心，但是容易陷入Local
optima。解决方案：多次随机，选择cost function最小的</p>
<h3 id="choosing-the-number-of-clusters">6. Choosing the Number of
Clusters</h3>
<p>Elbow Method:</p>
<p>绘制J关于K的曲线，找到“Elbow”的节点，作为分类个数</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210331185002558.png" alt="image-20210331185002558">
<figcaption aria-hidden="true">image-20210331185002558</figcaption>
</figure>
<p>用途之一：later/downstream purpose</p>
<h2 id="motivation">Motivation</h2>
<h3 id="data-compression------dimensionality-reduction降维">1. Data
Compression ---- Dimensionality Reduction降维</h3>
<p>压缩数据，减少内存占用加快运算</p>
<h3 id="data-visualization">2. Data Visualization</h3>
<p>降维可以便于数据可视化</p>
<h2 id="principal-component-analysis主成分分析">Principal Component
Analysis主成分分析</h2>
<h3 id="problem-formulation">1. Problem formulation</h3>
<p>PCA：To find a surface onto which to project the data so as to
minimize the the projection error
(线性拟合中就是使得离某条直线的距离最小).</p>
<ul>
<li>先mean normalization（feature scaling）</li>
<li>Reduce from 2-dimension to 1-dimension: Find a direction (a vector
<span class="math inline">\(u_i\in \R^n\)</span>) onto which to project
the data so as to minimize the projection error.
该向量的正负没有关系。</li>
<li>Reduce from n-dimension to k-dimension: Find k vectors <span class="math inline">\(u^{(1)}\)</span>,<span class="math inline">\(u^{(2)}\)</span>, ... , <span class="math inline">\(u^{(k)}\)</span> onto which to project the data so
as to minimize the projection error.</li>
<li>注：PCA is not linear
regression。注意看下图区别，线性回归是和预期值的差最小，PCA是到直线距离最小</li>
</ul>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210331214953585.png" alt="image-20210331214953585">
<figcaption aria-hidden="true">image-20210331214953585</figcaption>
</figure>
<h3 id="pca-algorithm">2. PCA Algorithm</h3>
<p>PCA的目标：</p>
<ul>
<li>maximize variance perspective 最大投影方差</li>
<li>minimize error perspective 最小重构代价</li>
</ul>
<p>Step1: mean normalization.
根据数据(有不同的scales)，可能还需要feature
scaling。均值归一化是特征缩放的一种方法。（除以标准差）</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210331224012613.png" alt="image-20210331224012613">
<figcaption aria-hidden="true">image-20210331224012613</figcaption>
</figure>
<p>Step2: Reduce data from n-dimensions to k-dimensions：</p>
<ul>
<li><p>Compute "covariance matrix": <span class="math inline">\(\Sigma =
\frac{1}{m}\sum_{i=1}^{n}{(x^{(i)})(x^{(i)})^T}\)</span>，xi是n*1的列向量，symmetric
positive definite</p></li>
<li><p>Compute "eigenvectors" of matrix <span class="math inline">\(\Sigma\)</span>: [U, S, V] = svd(Sigma) ;或者
eig(Sigma)</p>
<p>svd: Singular value decomposition <a href="https://zhuanlan.zhihu.com/p/29846048">奇异值分解</a></p>
<p>其中U是我们需要的，
列向量为各个特征向量，压缩到k个向量只需要取前k个列向量（对称矩阵的特征向量是正交的）</p></li>
</ul>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210401221235384.png" alt="image-20210401221235384">
<figcaption aria-hidden="true">image-20210401221235384</figcaption>
</figure>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210401222501123.png" alt="image-20210401222501123">
<figcaption aria-hidden="true">image-20210401222501123</figcaption>
</figure>
<p>注：PCA算法中，没有x0=1这一项<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/v2-a00e6519ce24ea2b151c8bece4226d95_720w.jpg" alt="img"><img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/v2-ddbf215dce156564852941f7294c7431_720w.jpg" alt="img"></p>
<p><strong>疑问：</strong></p>
<ol type="1">
<li><p><strong>为什么不直接用X进行SVD，而要算协方差的SVD？</strong></p>
<p><strong>Answer：</strong><a href="https://www.coursera.org/learn/machine-learning/discussions/weeks/8/threads/kk41Fe5OEeqnzBL0ZMnGMw">协方差的U和X的V是相等的，其实都可以</a></p>
<p>理解：<span class="math inline">\(X=U'S'V'^T\)</span>,
<span class="math inline">\(X^TX=USV^T\)</span>，现要说明 <span class="math inline">\(V'=U\)</span>, 只需要 <span class="math inline">\(X^TX=V'S'^2V'^T=USV^T\)</span>，所以
<span class="math inline">\(V'=U\)</span>。</p></li>
<li><p><strong>为什么要取协方差矩阵SVD后的左奇异矩阵来压缩特征维度？</strong></p>
<p>首先易证一个SPD矩阵通过SVD得到的U和V是相等的。</p>
<p>其次，通常我们用XV=YU来表示坐标变换。</p>
<p><span class="math inline">\(\Sigma = X^TX\)</span>，又有 <span class="math inline">\(\Sigma = USV^T\)</span>，可以得到 <span class="math inline">\(\Sigma V =
US\)</span>，这里实际上是将covariance矩阵变化为对角线矩阵，即互不相关（其中U=V，即U为协方差矩阵的特征向量，S为其特征值）。那么这时，我们令XI=UZ，I是X坐标系下的正交基，即
<span class="math inline">\(Z=U^TX\)</span>。此时Z的协方差 <span class="math inline">\(Z^TZ=\Sigma\)</span>。</p></li>
</ol>
<h2 id="applying-pca">Applying PCA</h2>
<h3 id="reconstruction-from-compressed-representation">Reconstruction
from compressed representation</h3>
<p><span class="math display">\[
z=U_{reduce}^Tx
\]</span></p>
<p>可以得到： <span class="math display">\[
x_{approx}=U_{reduce}z
\]</span></p>
<h3 id="choosing-the-number-k-of-principal-component">Choosing the
number k of principal component</h3>
<ul>
<li>Average squared projection error：</li>
</ul>
<p><span class="math display">\[
\frac{1}{m}\Sigma_{i=1}^m\parallel x^{(i)}-x_{approx}^{(i)}\parallel ^2
\]</span></p>
<ul>
<li><p>Tptal variation in the data: <span class="math display">\[
\frac{1}{m}\Sigma_{i=1}^m\parallel x^{(i)}\parallel ^2
\]</span></p></li>
<li><p>Choose k to be smallest value so that <span class="math display">\[
\frac{\frac{1}{m}\Sigma_{i=1}^m\parallel
x^{(i)}-x_{approx}^{(i)}\parallel ^2}{\frac{1}{m}\Sigma_{i=1}^m\parallel
x^{(i)}\parallel ^2}\le0.01
\]</span> "99% of variance is
retained"。这个数值可以根据需求不同更换。</p></li>
<li><p>算法：</p>
<p>SVD函数返回的S矩阵为diagonal matrix。</p>
<p>For given k: k 递增，使得 <span class="math display">\[
1-\frac{\Sigma_{i=1}^{k}S_{ii}}{\Sigma_{i=1}^{n}S_{ii}}\le0.01
\]</span></p>
<p>选择最小的K满足上式。</p>
<p>根据性质：矩阵特征值之和等于主对角线元素之和，易证(6)式等价于(7)式。</p></li>
</ul>
<h3 id="advice-for-applying-pca">Advice for applying PCA</h3>
<ol type="1">
<li><p>Supervised learning speedup</p>
<p>压缩原始训练集数据的维度</p>
<p>Mapping <span class="math inline">\(x^{(i)}\rightarrow
z^{(i)}\)</span>should be defined by running PCA only on the trainning
set. This mapping can be applied as well to the examples <span class="math inline">\(x_{CV}^{(i)}\)</span> and <span class="math inline">\(x_{test}^{(i)}\)</span> in the cross validation
and test sets.</p></li>
<li><p>Compression</p>
<ul>
<li>Reduce memory/disk needed to store data</li>
<li>speed up learning algorithm</li>
</ul></li>
<li><p>Visualization</p></li>
<li><p>Bad use of PCA: To prevent overfitting</p>
<p>可能确实可以避免过拟合，但是不是解决过拟合的好方法。正确方法式加正则项(Use
regularization instead!)</p>
<p>For example: <img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210403175514854.png" alt="image-20210403175514854"></p></li>
<li><p>正确做法是先不用PCA，在原始数据跑一遍，如果不符合期望，再用PCA</p></li>
</ol>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week09</title>
    <url>/Machine-Learning-Week09/</url>
    <content><![CDATA[<h1 id="anomaly-detection-异常检测">Anomaly Detection 异常检测</h1>
<h2 id="density-estimation">Density Estimation</h2>
<h3 id="problem-motivation">Problem Motivation</h3>
<p>异常检测主要用于unsupervised learning</p>
<p>Model：<span class="math inline">\(P(x_{test}&lt;\epsilon)\rightarrow
anomaly\)</span></p>
<p>​ <span class="math inline">\(P(x_{test}\ge \epsilon)\rightarrow
OK\)</span></p>
<p>也被用于检测账号被盗、生产、数据中心的电脑</p>
<h3 id="gaussian-distribution">Gaussian Distribution</h3>
<p>=Normal distribution</p>
<p>X ～ N (0, 1)，“distributed as”, 这里N的符号为"script N"</p>
<p>给定dataset，参数估计：via Maximum likelihood estimation
通常是m-1，对大数据集没影响 <span class="math display">\[
\mu = \frac{1}{m}\sum_{i=1}^mx^{(i)}\\
\sigma^2=\frac{1}{m}\sum_{i=1}^m(x^{(i)}-\mu)^2
\]</span></p>
<h3 id="algorithm">Algorithm</h3>
<p>基本假设，各特征间相互独立 <span class="math display">\[
P(x)=\prod_{j=1}^np(x_j;\mu_j,\sigma_j^2)
\]</span> <img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210404220930233.png" alt="Anomaly detection algorithm"></p>
<h2 id="building-an-anomaly-detection-system">Building an Anomaly
Detection System</h2>
<h3 id="developing-and-evaluating-an-anomaly-detection-system">Developing
and Evaluating an Anomaly Detection System</h3>
<p>Training set: normal examples (可以有少量异常的混进来)</p>
<p>然后应用于cross calidation set 和 test set</p>
<ul>
<li><p>10000正常，20异常：</p>
<p>​ 训练集：6000正常</p>
<p>​ CV：2000正常，10异常</p>
<p>​ Test：2000正常，10异常</p></li>
</ul>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210405114004132.png" alt="Algorithm evaluation">
<figcaption aria-hidden="true">Algorithm evaluation</figcaption>
</figure>
<p>由于normal是0，所以预测0常常有更高的准确率，是skew的偏斜的。因此查准率accuracy不是很好的分析指标。</p>
<ul>
<li>选择ε时，可以试几个不同的，然后选择使得Cross
validation集中F1-score最大的，或者效果最好的。</li>
<li>有时还需要决定用什么特征</li>
</ul>
<h3 id="anomaly-detection-vs.-supervised-learning">Anomaly detection vs.
Supervised learning</h3>
<p>Anomaly detection:</p>
<ul>
<li>y=1非常少(0-20常见), y=0占比更大</li>
<li>有大量不同的异常类型，其他算法难于分辨各种类型</li>
<li>有未知异常类型</li>
</ul>
<p>supervised learning：</p>
<ul>
<li>大量的positive 和negative examples</li>
<li>有足够positive examples，并且未来的positive
example和训练集的相似</li>
<li>Spam</li>
</ul>
<h3 id="choosing-what-features-to-use">Choosing what features to
use</h3>
<ul>
<li>Non-gaussian feature</li>
</ul>
<p>绘制特征的直方图，看是否大致是个bell shaped
curve，如果不是，运用一些变换使得其看起来更加gaussian</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210405203939050.png" alt="take a log transformation">
<figcaption aria-hidden="true">take a log transformation</figcaption>
</figure>
<ul>
<li><p>Error analysis for anomaly detection</p>
<p>甄别失败时，new feature
可能有帮助，例如组合现有的特征形成新特征</p></li>
</ul>
<h2 id="multivariate-gaussian-distribution">Multivariate Gaussian
Distribution</h2>
<h3 id="multivariate-gaussian-distribution-1">Multivariate Gaussian
Distribution</h3>
<p>不同于之前的是，p(x)不再是各个特征概率的乘积。</p>
<p>Parameters: <span class="math inline">\(\mu \in \R^n\)</span>, <span class="math inline">\(\Sigma \in \R^{n\times n}\)</span> <span class="math display">\[
p(x;\mu,\Sigma)=
\frac{1}{(2\pi)^{\frac{n}{2}}|\Sigma|^2}exp(-\frac{1}{2}(x-\mu)^T\Sigma^{-1}(x-\mu))
\]</span> <span class="math inline">\(|\Sigma|\)</span>=determinant of
Σ</p>
<p><img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210405214331278.png" alt="examples"> <span class="math display">\[
\mu = \frac{1}{m}\sum_{i=1}^mx^{(i)}\\
\Sigma = \frac{1}{m}\sum_{i=1}^m(x^{(i)}-\mu)(x^{(i)}-\mu)^T
\]</span></p>
<h3 id="anomaly-detection-using-the-multivariate-gaussian-distribution">Anomaly
Detection using the multivariate Gaussian distribution</h3>
<p>首先计算μ和Σ，然后计算p(x)，最后根据ε判断是否异常</p>
<ul>
<li><p>优点：自动捕捉特征间的相关性。m&gt;10n用起来才比较好，必须要m&gt;n，否则协方差矩阵不可逆。</p></li>
<li><p>缺点：计算量比较大。如果某个特征是其他的线性组合，那么协方差矩阵也不可逆，要注意避免。</p></li>
</ul>
<p>前述的模型：优点在于计算量小，但是要人工创造一些新特征来更好地分辨。m&lt;n的时候也能用。</p>
<p>若出现协方差矩阵不可逆：</p>
<ul>
<li>首先检查m, n大小</li>
<li>检查是否有redundant features，就是特征间是否线性独立</li>
</ul>
<h2 id="predicting-movie-ratings-recommendation-system">Predicting Movie
Ratings ——Recommendation System</h2>
<h3 id="problem-formulation">Problem Formulation</h3>
<p>r(i,j) 表示第i个电影，j用户是否打分；</p>
<p>y(i,j) 表示该用户对该电影的打分值 ；</p>
<h3 id="content-based-recommendations">Content Based
Recommendations</h3>
<p>设电影特征n个</p>
<p>For each user j, learn a parameter <span class="math inline">\(\theta^{(j)}\in\R^{n+1}\)</span>. Predict user j
as rating movie i with <span class="math inline">\((\theta^{(j)})^Tx^{(i)}\)</span> stars. （注意
<span class="math inline">\(x_0=1\)</span>）。用线性回归</p>
<p>To learn <span class="math inline">\(\theta^{(j)}\)</span>： <span class="math display">\[
\min_{\Theta^{(j)}}\frac{1}{2m^{(j)}}\sum_{i:r(i,j)=1}((\theta^{(j)})^Tx^{(i)}-y^{(i,j)})^2+\frac{\lambda}{2m^{(j)}}\sum_{k=1}^{n}(\theta_k^{(j)})^2
\]</span> Note: 这里 <span class="math inline">\(m^{(j)}\)</span>可以去掉，对结果没有任何影响</p>
<p>优化目标也可以为： <span class="math display">\[
J(\Theta^{(1)},...,\Theta^{(n_u)})=\min_{\Theta^{(1)},...,\Theta^{(n_u)}}\frac{1}{2}\sum_{j=1}^{n_u}\sum_{i:r(i,j)=1}((\theta^{(j)})^Tx^{(i)}-y^{(i,j)})^2+\frac{\lambda}{2}\sum_{j=1}^{n_u}\sum_{k=1}^{n}(\theta_k^{(j)})^2
\]</span> Gradient descent update: <span class="math display">\[
\theta_{k}^{(j)}:=\theta_{k}^{(j)}-\alpha \sum_{i: r(i,
j)=1}\left(\left(\theta^{(j)}\right)^{T} x^{(i)}-y^{(i, j)}\right)
x_{k}^{(i)}\ (\text { for } k=0)
\]</span></p>
<p><span class="math display">\[
\theta_{k}^{(j)}:=\theta_{k}^{(j)}-\alpha\left(\sum_{i: r(i,
j)=1}\left(\left(\theta^{(j)}\right)^{T} x^{(i)}-y^{(i, j)}\right)
x_{k}^{(i)}+\lambda \theta_{k}^{(j)}\right)\ (\text { for } k \neq 0)
\]</span></p>
<p>k=0的时候不加正则项</p>
<h2 id="collaborative-filtering">Collaborative Filtering</h2>
<h3 id="collaborative-filtering-1">Collaborative Filtering</h3>
<ul>
<li><p>feature learning</p></li>
<li><p>Given <span class="math inline">\(\Theta^{(1)},...,\Theta^{(n_u)}\)</span>，to learn
<span class="math inline">\(x^{(1)},...,x^{(n_m)}\)</span>;</p></li>
<li><p>算法类似7、8式</p></li>
<li><p><span class="math inline">\(用户的\Theta\rightarrow
电影特征x\rightarrow \Theta\rightarrow x\rightarrow...\)</span></p></li>
<li><p>每个用户都在帮助这个推荐系统更好地分类电影，从而更好地预测评分</p></li>
<li><p>算法：同时实现：</p>
<ol type="1">
<li><p>Given <span class="math inline">\(x^{(1)},...,x^{(n_m)}\)</span>，estimate <span class="math inline">\(\theta^{(1)},...,\theta^{(n_u)}\)</span>： <span class="math display">\[
\min_{\Theta^{(j)}}\frac{1}{2m^{(j)}}\sum_{i:r(i,j)=1}((\theta^{(j)})^Tx^{(i)}-y^{(i,j)})^2+\frac{\lambda}{2m^{(j)}}\sum_{k=1}^{n}(\theta_k^{(j)})^2
\]</span></p></li>
<li><p>Given <span class="math inline">\(\theta^{(1)},...,\theta^{(n_u)}\)</span>，estimate
<span class="math inline">\(x^{(1)},...,x^{(n_m)}\)</span>： <span class="math display">\[
\min _{x^{(1)}, \ldots, x^{\left(n_{m}\right)}} \frac{1}{2}
\sum_{i=1}^{n_{m}} \sum_{j: r(i,
j)=1}\left(\left(\theta^{(j)}\right)^{T} x^{(i)}-y^{(i,
j)}\right)^{2}+\frac{\lambda}{2} \sum_{i=1}^{n_{m}}
\sum_{k=1}^{n}\left(x_{k}^{(i)}\right)^{2}
\]</span></p></li>
</ol>
<p>即：</p>
<p>Minimizing <span class="math inline">\(x^{(1)},...,x^{(n_m)}\)</span>
and <span class="math inline">\(\theta^{(1)},...,\theta^{(n_u)}\)</span>
simultaneously： <span class="math display">\[
\min_{x^{(1)},...,x^{(n_m)}\\\theta^{(1)},...,\theta^{(n_u)}}J\left(x^{(1)},
\ldots, x^{\left(n_{m}\right)}, \theta^{(1)}, \ldots,
\theta^{\left(n_{u}\right)}\right)
\]</span></p>
<p><span class="math display">\[
J\left(x^{(1)}, \ldots, x^{\left(n_{m}\right)}, \theta^{(1)}, \ldots,
\theta^{\left(n_{u}\right)}\right)=\frac{1}{2} \sum_{(i, j): r(i,
j)=1}\left(\left(\theta^{(j)}\right)^{T} x^{(i)}-y^{(i,
j)}\right)^{2}+\frac{\lambda}{2} \sum_{i=1}^{n_{m}}
\sum_{k=1}^{n}\left(x_{k}^{(i)}\right)^{2}+\frac{\lambda}{2}
\sum_{j=1}^{n_{u}} \sum_{k=1}^{n}\left(\theta_{k}^{(j)}\right)^{2}
\]</span></p>
<blockquote>
<p>该算法下，无需设定 <span class="math inline">\(x_0=1\)</span>,
也没有<span class="math inline">\(\theta_0\)</span>，因为算法会自行选择参数。该算法下：<span class="math inline">\(\theta\in\R^n\)</span>，<span class="math inline">\(x\in\R^n\)</span>，n是特征数</p>
</blockquote></li>
<li><p>算法实现：</p>
<ol type="1">
<li>Initialize <span class="math inline">\(x^{(1)},...,x^{(n_m)}\)</span>， <span class="math inline">\(\theta^{(1)},...,\theta^{(n_u)}\)</span> to small
random values</li>
<li>Minimize J using gradient descent (or an advanced optimization
algorithm)</li>
<li>For a user with parameters <span class="math inline">\(\theta\)</span> and a movie with (learned)
features x, predict a star rating of <span class="math inline">\(\theta^Tx\)</span></li>
</ol></li>
</ul>
<h2 id="low-rank-matrix-factorization">Low Rank Matrix
Factorization</h2>
<p>### Vectorization</p>
<ul>
<li><p>Given matrices X (each row containing features of a particular
movie) and Θ (each row containing the weights for those features for a
given user), then the full matrix Y of all predicted ratings of all
movies by all users is given simply by: <span class="math inline">\(Y =
X\Theta^T\)</span>.</p></li>
<li><p>Predicting how similar two movies i and j are can be done using
the distance between their respective feature vectors x. Specifically,
we are looking for a small value of <span class="math inline">\(||x^{(i)} - x^{(j)}||\)</span>.</p></li>
</ul>
<h3 id="mean-normalization">Mean Normalization</h3>
<p>If the ranking system for movies is used from the previous lectures,
then new users (who have watched no movies), will be assigned new movies
incorrectly. Specifically, they will be assigned θ with all components
equal to zero due to the minimization of the regularization term. That
is, we assume that the new user will rank all movies 0, which does not
seem intuitively correct. 新用户会被预测为0</p>
<p>We rectify this problem by normalizing the data relative to the mean.
First, we use a matrix Y to store the data from previous ratings, where
the ith row of Y is the ratings for the ith movie and the jth column
corresponds to the ratings for the jth user.</p>
<p>We can now define a vector <span class="math display">\[
\mu  = [\mu_1, \mu_2, \dots , \mu_{n_m}]
\]</span> such that <span class="math display">\[
\mu_i = \frac{\sum_{j:r(i,j)=1}{Y_{i,j}}}{\sum_{j}{r(i,j)}}
\]</span> Which is effectively the mean of the previous ratings for the
ith movie (where only movies that have been watched by users are
counted). We now can normalize the data by subtracting u, the mean
rating, from the actual ratings for each user (column in matrix Y):</p>
<p>As an example, consider the following matrix Y and mean ratings μ:
<span class="math display">\[
Y=\left[\begin{array}{cccc}
5 &amp; 5 &amp; 0 &amp; 0 \\
4 &amp; ? &amp; ? &amp; 0 \\
0 &amp; 0 &amp; 5 &amp; 4 \\
0 &amp; 0 &amp; 5 &amp; 0
\end{array}\right], \quad \mu=\left[\begin{array}{c}
2.5 \\
2 \\
2.25 \\
1.25
\end{array}\right]
\]</span> The resulting Y′ vector is: <span class="math display">\[
Y^{\prime}=\left[\begin{array}{cccc}
2.5 &amp; 2.5 &amp; -2.5 &amp; -2.5 \\
2 &amp; ? &amp; ? &amp; -2 \\
-2 .25 &amp; -2.25 &amp; 3.75 &amp; 1.25 \\
-1.25 &amp; -1.25 &amp; 3.75 &amp; -1.25
\end{array}\right]
\]</span> Now we must slightly modify the linear regression prediction
to include the mean normalization term: <span class="math display">\[
(\theta^{(j)})^T x^{(i)} + \mu_i
\]</span> Now, for a new user, the initial predicted values will be
equal to the μ term instead of simply being initialized to zero, which
is more accurate.</p>
<blockquote>
<p>Note:
一般的均值归一化要除以range，即max-min，但是这里不需要，因为都有统一的scale</p>
</blockquote>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Machine Learning Week10</title>
    <url>/Machine-Learning-Week10/</url>
    <content><![CDATA[<h1 id="large-scale-machine-learning">Large Scale Machine Learning</h1>
<h2 id="gradient-descent-with-large-datasets">Gradient Descent with
Large Datasets</h2>
<h3 id="learning-with-large-datasets">Learning with large datasets</h3>
<p>如何知道小m（size of dataset）也能产生很好的结果？绘制learning
curve（error关于m的曲线）</p>
<p>左图为high variance，说明增加m有助于结果变好；右图为high
bias，说明增加m无助于结果变好</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210409182113679.png" alt="左：high variance；右: high bias">
<figcaption aria-hidden="true">左：high variance；右: high
bias</figcaption>
</figure>
<h3 id="stochastic-gradient-descent-随机梯度下降">Stochastic gradient
descent 随机梯度下降</h3>
<p>Batch gradient descent:
前述传统的梯度下降算法。batch意味着每次都要用到所有m个例子</p>
<p>Stochastic gradient descent：每次iteration用1个例子</p>
<ol type="1">
<li><p>Randomly shuffle dataset</p></li>
<li><p>Repeat：</p>
<p>for i =1,..., m { <span class="math inline">\(\theta_j=\theta_j-\alpha(h_{\theta}(x^{(i)})-y^{(i)})x_j^{(i)}\)</span>
}</p>
<blockquote>
<p>Note: 和Batch gradient
descent不同的是，无需每一步都要计算全部的training example</p>
</blockquote></li>
</ol>
<p>并不一定会达到global minimum，最后可能在全局最优附近徘徊。</p>
<p>上述过程重复的次数取决于数据集的大小，一般为10次，若数据集特别大，则1次。</p>
<h3 id="mini-batch-gradient-descent">Mini-Batch gradient descent</h3>
<p>每次iteration用b（mini-batch size）个例子，常用2-100</p>
<p>第i个例子，直到第i+b-1个例子</p>
<figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210415223239627.png" alt="mini-batch gradient descent">
<figcaption aria-hidden="true">mini-batch gradient descent</figcaption>
</figure>
<p>只有当have a good vetorized implementation
，mini-batch才能比stochastic表现得更好。（并行运算）</p>
<h3 id="stochastic-gradient-descent-convergence">Stochastic gradient
descent convergence</h3>
<p>收敛性：</p>
<ul>
<li><figure>
<img src="https://cdn.jsdelivr.net/gh/xuJ14/ImageHost@latest/images/image-20210416223947732.png" alt="Algorithm">
<figcaption aria-hidden="true">Algorithm</figcaption>
</figure></li>
<li><p>更小的学习速率学习曲线更平滑，有可能会得到slightly
better结果。（cost关于no. of iteration 的曲线）</p></li>
<li><p>增加1000这个数值，会使得曲线更加平滑</p></li>
<li><p>如果学习曲线在上升，就要用更小的α</p></li>
<li><p>如果学习曲线几乎在一个水平上，那么就需要增加特征等</p></li>
<li><p>关于学习速率的选择：</p>
<ul>
<li>Learning rate α is typically held constant 在随机梯度下降中</li>
<li>Can slowly decrease α over time if we want θ to converge.
（例如：<span class="math inline">\(\alpha=\frac{const1}{iteration
Number+const2}\)</span>）
<ul>
<li>但是这里，两个参数的调整tune会很费时间，所以很少采用这种方法</li>
</ul></li>
</ul></li>
</ul>
<h2 id="advanced-topics">Advanced Topics</h2>
<p>### Online Learning</p>
<ul>
<li><p>连续的数据流：用户进入离开</p></li>
<li><p><span class="math inline">\(p(y=1|x;\theta)\)</span>其中x表示价格，可以用logistic
regression或者神经网络</p></li>
<li><p>这里考虑逻辑回归：</p>
<p>Repeat forever {</p>
<p>​ Get (x,y) corresponding to user.</p>
<p>​ Update θ using (x,y):</p>
<p>​ <span class="math inline">\(\theta_j:=\theta_j-\alpha(h_{\theta}(x)-y)x_j\)</span>
(j=0, ..., n)</p>
<p>}</p></li>
<li><p>这个算法可以用于学习用户喜好</p>
<ul>
<li>Choosing special offers to show user</li>
<li>Customized selection of news articles</li>
<li>product recommendation/search</li>
</ul></li>
</ul>
<h3 id="map-reduce-and-data-parallelism">Map reduce and data
parallelism</h3>
<p>Map reduce 可以处理更多数据。思想来自于Jeffrey Dean和Sanjay
Ghemawat。summation over the training set。即并行处理</p>
<ul>
<li>神经网络也同样可以并行计算前向和后向propagation</li>
<li>有时只需要向量化实现算法，不需要多核并行</li>
<li>Hadoop是开源map reduce</li>
<li>由于并行的latency，速度会少于N倍 的单核心</li>
</ul>
]]></content>
      <categories>
        <category>Machine Learning</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>Programming in Python (1)</title>
    <url>/Programming-in-Python-1/</url>
    <content><![CDATA[<h1 id="string">String</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">seq = <span class="string">"this is a new world"</span></span><br><span class="line">seq[<span class="number">2</span>::-<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'it'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">seq[-<span class="number">1</span>::-<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'drwwnas it'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 倒序</span></span><br><span class="line">seq[::-<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'dlrow wen a si siht'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># &gt;&gt;&gt; seq.split(" ")</span></span><br><span class="line"><span class="comment"># AttributeError: 'list' object has no attribute 'split'</span></span><br><span class="line"></span><br><span class="line"><span class="string">"this is a new world"</span>.split(<span class="string">" "</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['this', 'is', 'a', 'new', 'world']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Delete 头尾的\n...</span></span><br><span class="line"><span class="string">'this\n'</span>.strip()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'this'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">word = <span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> word:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'True'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'False'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="number">1</span> <span class="keyword">in</span> my_list</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>] <span class="keyword">in</span> my_list</span><br><span class="line">[<span class="number">1</span>] <span class="keyword">in</span> my_list</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_letters = <span class="string">"abc"</span></span><br><span class="line"><span class="built_in">list</span>(my_letters)==my_list</span><br><span class="line"><span class="comment">## List is not String</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">type</span>(my_letters)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>str</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">type</span>(<span class="built_in">list</span>(my_letters))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>list</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">""</span>.join(<span class="built_in">list</span>(my_letters))</span><br><span class="line"><span class="comment"># 不同于 str("".join(list(my_letters)))</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>'abc'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"-"</span>.join(<span class="built_in">list</span>(my_letters))</span><br><span class="line"><span class="comment">## The list can not be numbers like [1,2,3]</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>'a-b-c'</code></pre>
<p>How to change some letters in the String?</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Error: my_letters[0]=z</span></span><br><span class="line"><span class="comment"># Correct: </span></span><br><span class="line">my_list = <span class="built_in">list</span>(my_letters)</span><br><span class="line">my_list[<span class="number">0</span>]=<span class="string">"z"</span></span><br><span class="line">my_list</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['z', 'b', 'c']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fruits = [<span class="string">"apple"</span>,<span class="string">"banana"</span>,<span class="string">"orange"</span>]</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">enumerate</span>(fruits))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(0, 'apple'), (1, 'banana'), (2, 'orange')]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">enumerate</span>(fruits, start=<span class="number">1</span>)) </span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 'apple'), (2, 'banana'), (3, 'orange')]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i,f <span class="keyword">in</span> <span class="built_in">enumerate</span>(fruits):</span><br><span class="line">  fruits[i]=f.upper()</span><br><span class="line">fruits</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['APPLE', 'BANANA', 'ORANGE']</code></pre>
<h1 id="list">List</h1>
<ul>
<li>list are not iterators, use <code>iter()</code> -<code>next()</code>
= <code>iter.__next__()</code></li>
<li>for loop 就是这种工作方式</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">numbers = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>range(1, 11)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">numbers</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">square</span>(<span class="params">x</span>):</span><br><span class="line">  <span class="keyword">return</span> x**<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x**<span class="number">2</span> <span class="keyword">if</span>(x%<span class="number">2</span>==<span class="number">0</span>) <span class="keyword">else</span> <span class="literal">None</span>, numbers))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[None, 4, None, 16, None, 36, None, 64, None, 100]</code></pre>
<p><code>map</code> function</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">map</span>(square,numbers)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;map at 0x1ce204a6950&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(square,numbers))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</code></pre>
<h1 id="anonymous-function">Anonymous Function:</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x**<span class="number">2</span>, numbers))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">[x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> numbers]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> numbers <span class="keyword">if</span> x%<span class="number">2</span>==<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[2, 4, 6, 8, 10]</code></pre>
<h1 id="dicts-and-tuples">Dicts and tuples</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_large_list = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10_000_000</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_large_dict = {v: v <span class="keyword">for</span> v <span class="keyword">in</span> my_large_list}</span><br><span class="line">my_large_dict</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{0: 0,
 1: 1,
 2: 2,
 3: 3,
 4: 4,
 5: 5,
 6: 6,
 7: 7,
 8: 8,
 9: 9,
 10: 10,
 11: 11,
 12: 12,
 13: 13,
 14: 14,
 15: 15,
 16: 16,
 17: 17,
 18: 18,
 19: 19,
 20: 20,
 21: 21,
 22: 22,
 23: 23,
 24: 24,
 25: 25,
 26: 26,
 27: 27,
 28: 28,
 29: 29,
 30: 30,
 31: 31,
 32: 32,
 33: 33,
 34: 34,
 35: 35,
 36: 36,
 37: 37,
 38: 38,
 39: 39,
 40: 40,
 41: 41,
 42: 42,
 43: 43,
 44: 44,
 45: 45,
 46: 46,
 47: 47,
 48: 48,
 49: 49,
 50: 50,
 51: 51,
 52: 52,
 53: 53,
 54: 54,
 55: 55,
 56: 56,
 57: 57,
 58: 58,
 59: 59,
 60: 60,
 61: 61,
 62: 62,
 63: 63,
 64: 64,
 65: 65,
 66: 66,
 67: 67,
 68: 68,
 69: 69,
 70: 70,
 71: 71,
 72: 72,
 73: 73,
 74: 74,
 75: 75,
 76: 76,
 77: 77,
 78: 78,
 79: 79,
 80: 80,
 81: 81,
 82: 82,
 83: 83,
 84: 84,
 85: 85,
 86: 86,
 87: 87,
 88: 88,
 89: 89,
 90: 90,
 91: 91,
 92: 92,
 93: 93,
 94: 94,
 95: 95,
 96: 96,
 97: 97,
 98: 98,
 99: 99,
 100: 100,
 101: 101,
 102: 102,
 103: 103,
 104: 104,
 105: 105,
 106: 106,
 107: 107,
 108: 108,
 109: 109,
 110: 110,
 111: 111,
 112: 112,
 113: 113,
 114: 114,
 115: 115,
 116: 116,
 117: 117,
 118: 118,
 119: 119,
 120: 120,
 121: 121,
 122: 122,
 123: 123,
 124: 124,
 125: 125,
 126: 126,
 127: 127,
 128: 128,
 129: 129,
 130: 130,
 131: 131,
 132: 132,
 133: 133,
 134: 134,
 135: 135,
 136: 136,
 137: 137,
 138: 138,
 139: 139,
 140: 140,
 141: 141,
 142: 142,
 143: 143,
 144: 144,
 145: 145,
 146: 146,
 147: 147,
 148: 148,
 149: 149,
 150: 150,
 151: 151,
 152: 152,
 153: 153,
 154: 154,
 155: 155,
 156: 156,
 157: 157,
 158: 158,
 159: 159,
 160: 160,
 161: 161,
 162: 162,
 163: 163,
 164: 164,
 165: 165,
 166: 166,
 167: 167,
 168: 168,
 169: 169,
 170: 170,
 171: 171,
 172: 172,
 173: 173,
 174: 174,
 175: 175,
 176: 176,
 177: 177,
 178: 178,
 179: 179,
 180: 180,
 181: 181,
 182: 182,
 183: 183,
 184: 184,
 185: 185,
 186: 186,
 187: 187,
 188: 188,
 189: 189,
 190: 190,
 191: 191,
 192: 192,
 193: 193,
 194: 194,
 195: 195,
 196: 196,
 197: 197,
 198: 198,
 199: 199,
 200: 200,
 201: 201,
 202: 202,
 203: 203,
 204: 204,
 205: 205,
 206: 206,
 207: 207,
 208: 208,
 209: 209,
 210: 210,
 211: 211,
 212: 212,
 213: 213,
 214: 214,
 215: 215,
 216: 216,
 217: 217,
 218: 218,
 219: 219,
 220: 220,
 221: 221,
 222: 222,
 223: 223,
 224: 224,
 225: 225,
 226: 226,
 227: 227,
 228: 228,
 229: 229,
 230: 230,
 231: 231,
 232: 232,
 233: 233,
 234: 234,
 235: 235,
 236: 236,
 237: 237,
 238: 238,
 239: 239,
 240: 240,
 241: 241,
 242: 242,
 243: 243,
 244: 244,
 245: 245,
 246: 246,
 247: 247,
 248: 248,
 249: 249,
 250: 250,
 251: 251,
 252: 252,
 253: 253,
 254: 254,
 255: 255,
 256: 256,
 257: 257,
 258: 258,
 259: 259,
 260: 260,
 261: 261,
 262: 262,
 263: 263,
 264: 264,
 265: 265,
 266: 266,
 267: 267,
 268: 268,
 269: 269,
 270: 270,
 271: 271,
 272: 272,
 273: 273,
 274: 274,
 275: 275,
 276: 276,
 277: 277,
 278: 278,
 279: 279,
 280: 280,
 281: 281,
 282: 282,
 283: 283,
 284: 284,
 285: 285,
 286: 286,
 287: 287,
 288: 288,
 289: 289,
 290: 290,
 291: 291,
 292: 292,
 293: 293,
 294: 294,
 295: 295,
 296: 296,
 297: 297,
 298: 298,
 299: 299,
 300: 300,
 301: 301,
 302: 302,
 303: 303,
 304: 304,
 305: 305,
 306: 306,
 307: 307,
 308: 308,
 309: 309,
 310: 310,
 311: 311,
 312: 312,
 313: 313,
 314: 314,
 315: 315,
 316: 316,
 317: 317,
 318: 318,
 319: 319,
 320: 320,
 321: 321,
 322: 322,
 323: 323,
 324: 324,
 325: 325,
 326: 326,
 327: 327,
 328: 328,
 329: 329,
 330: 330,
 331: 331,
 332: 332,
 333: 333,
 334: 334,
 335: 335,
 336: 336,
 337: 337,
 338: 338,
 339: 339,
 340: 340,
 341: 341,
 342: 342,
 343: 343,
 344: 344,
 345: 345,
 346: 346,
 347: 347,
 348: 348,
 349: 349,
 350: 350,
 351: 351,
 352: 352,
 353: 353,
 354: 354,
 355: 355,
 356: 356,
 357: 357,
 358: 358,
 359: 359,
 360: 360,
 361: 361,
 362: 362,
 363: 363,
 364: 364,
 365: 365,
 366: 366,
 367: 367,
 368: 368,
 369: 369,
 370: 370,
 371: 371,
 372: 372,
 373: 373,
 374: 374,
 375: 375,
 376: 376,
 377: 377,
 378: 378,
 379: 379,
 380: 380,
 381: 381,
 382: 382,
 383: 383,
 384: 384,
 385: 385,
 386: 386,
 387: 387,
 388: 388,
 389: 389,
 390: 390,
 391: 391,
 392: 392,
 393: 393,
 394: 394,
 395: 395,
 396: 396,
 397: 397,
 398: 398,
 399: 399,
 400: 400,
 401: 401,
 402: 402,
 403: 403,
 404: 404,
 405: 405,
 406: 406,
 407: 407,
 408: 408,
 409: 409,
 410: 410,
 411: 411,
 412: 412,
 413: 413,
 414: 414,
 415: 415,
 416: 416,
 417: 417,
 418: 418,
 419: 419,
 420: 420,
 421: 421,
 422: 422,
 423: 423,
 424: 424,
 425: 425,
 426: 426,
 427: 427,
 428: 428,
 429: 429,
 430: 430,
 431: 431,
 432: 432,
 433: 433,
 434: 434,
 435: 435,
 436: 436,
 437: 437,
 438: 438,
 439: 439,
 440: 440,
 441: 441,
 442: 442,
 443: 443,
 444: 444,
 445: 445,
 446: 446,
 447: 447,
 448: 448,
 449: 449,
 450: 450,
 451: 451,
 452: 452,
 453: 453,
 454: 454,
 455: 455,
 456: 456,
 457: 457,
 458: 458,
 459: 459,
 460: 460,
 461: 461,
 462: 462,
 463: 463,
 464: 464,
 465: 465,
 466: 466,
 467: 467,
 468: 468,
 469: 469,
 470: 470,
 471: 471,
 472: 472,
 473: 473,
 474: 474,
 475: 475,
 476: 476,
 477: 477,
 478: 478,
 479: 479,
 480: 480,
 481: 481,
 482: 482,
 483: 483,
 484: 484,
 485: 485,
 486: 486,
 487: 487,
 488: 488,
 489: 489,
 490: 490,
 491: 491,
 492: 492,
 493: 493,
 494: 494,
 495: 495,
 496: 496,
 497: 497,
 498: 498,
 499: 499,
 500: 500,
 501: 501,
 502: 502,
 503: 503,
 504: 504,
 505: 505,
 506: 506,
 507: 507,
 508: 508,
 509: 509,
 510: 510,
 511: 511,
 512: 512,
 513: 513,
 514: 514,
 515: 515,
 516: 516,
 517: 517,
 518: 518,
 519: 519,
 520: 520,
 521: 521,
 522: 522,
 523: 523,
 524: 524,
 525: 525,
 526: 526,
 527: 527,
 528: 528,
 529: 529,
 530: 530,
 531: 531,
 532: 532,
 533: 533,
 534: 534,
 535: 535,
 536: 536,
 537: 537,
 538: 538,
 539: 539,
 540: 540,
 541: 541,
 542: 542,
 543: 543,
 544: 544,
 545: 545,
 546: 546,
 547: 547,
 548: 548,
 549: 549,
 550: 550,
 551: 551,
 552: 552,
 553: 553,
 554: 554,
 555: 555,
 556: 556,
 557: 557,
 558: 558,
 559: 559,
 560: 560,
 561: 561,
 562: 562,
 563: 563,
 564: 564,
 565: 565,
 566: 566,
 567: 567,
 568: 568,
 569: 569,
 570: 570,
 571: 571,
 572: 572,
 573: 573,
 574: 574,
 575: 575,
 576: 576,
 577: 577,
 578: 578,
 579: 579,
 580: 580,
 581: 581,
 582: 582,
 583: 583,
 584: 584,
 585: 585,
 586: 586,
 587: 587,
 588: 588,
 589: 589,
 590: 590,
 591: 591,
 592: 592,
 593: 593,
 594: 594,
 595: 595,
 596: 596,
 597: 597,
 598: 598,
 599: 599,
 600: 600,
 601: 601,
 602: 602,
 603: 603,
 604: 604,
 605: 605,
 606: 606,
 607: 607,
 608: 608,
 609: 609,
 610: 610,
 611: 611,
 612: 612,
 613: 613,
 614: 614,
 615: 615,
 616: 616,
 617: 617,
 618: 618,
 619: 619,
 620: 620,
 621: 621,
 622: 622,
 623: 623,
 624: 624,
 625: 625,
 626: 626,
 627: 627,
 628: 628,
 629: 629,
 630: 630,
 631: 631,
 632: 632,
 633: 633,
 634: 634,
 635: 635,
 636: 636,
 637: 637,
 638: 638,
 639: 639,
 640: 640,
 641: 641,
 642: 642,
 643: 643,
 644: 644,
 645: 645,
 646: 646,
 647: 647,
 648: 648,
 649: 649,
 650: 650,
 651: 651,
 652: 652,
 653: 653,
 654: 654,
 655: 655,
 656: 656,
 657: 657,
 658: 658,
 659: 659,
 660: 660,
 661: 661,
 662: 662,
 663: 663,
 664: 664,
 665: 665,
 666: 666,
 667: 667,
 668: 668,
 669: 669,
 670: 670,
 671: 671,
 672: 672,
 673: 673,
 674: 674,
 675: 675,
 676: 676,
 677: 677,
 678: 678,
 679: 679,
 680: 680,
 681: 681,
 682: 682,
 683: 683,
 684: 684,
 685: 685,
 686: 686,
 687: 687,
 688: 688,
 689: 689,
 690: 690,
 691: 691,
 692: 692,
 693: 693,
 694: 694,
 695: 695,
 696: 696,
 697: 697,
 698: 698,
 699: 699,
 700: 700,
 701: 701,
 702: 702,
 703: 703,
 704: 704,
 705: 705,
 706: 706,
 707: 707,
 708: 708,
 709: 709,
 710: 710,
 711: 711,
 712: 712,
 713: 713,
 714: 714,
 715: 715,
 716: 716,
 717: 717,
 718: 718,
 719: 719,
 720: 720,
 721: 721,
 722: 722,
 723: 723,
 724: 724,
 725: 725,
 726: 726,
 727: 727,
 728: 728,
 729: 729,
 730: 730,
 731: 731,
 732: 732,
 733: 733,
 734: 734,
 735: 735,
 736: 736,
 737: 737,
 738: 738,
 739: 739,
 740: 740,
 741: 741,
 742: 742,
 743: 743,
 744: 744,
 745: 745,
 746: 746,
 747: 747,
 748: 748,
 749: 749,
 750: 750,
 751: 751,
 752: 752,
 753: 753,
 754: 754,
 755: 755,
 756: 756,
 757: 757,
 758: 758,
 759: 759,
 760: 760,
 761: 761,
 762: 762,
 763: 763,
 764: 764,
 765: 765,
 766: 766,
 767: 767,
 768: 768,
 769: 769,
 770: 770,
 771: 771,
 772: 772,
 773: 773,
 774: 774,
 775: 775,
 776: 776,
 777: 777,
 778: 778,
 779: 779,
 780: 780,
 781: 781,
 782: 782,
 783: 783,
 784: 784,
 785: 785,
 786: 786,
 787: 787,
 788: 788,
 789: 789,
 790: 790,
 791: 791,
 792: 792,
 793: 793,
 794: 794,
 795: 795,
 796: 796,
 797: 797,
 798: 798,
 799: 799,
 800: 800,
 801: 801,
 802: 802,
 803: 803,
 804: 804,
 805: 805,
 806: 806,
 807: 807,
 808: 808,
 809: 809,
 810: 810,
 811: 811,
 812: 812,
 813: 813,
 814: 814,
 815: 815,
 816: 816,
 817: 817,
 818: 818,
 819: 819,
 820: 820,
 821: 821,
 822: 822,
 823: 823,
 824: 824,
 825: 825,
 826: 826,
 827: 827,
 828: 828,
 829: 829,
 830: 830,
 831: 831,
 832: 832,
 833: 833,
 834: 834,
 835: 835,
 836: 836,
 837: 837,
 838: 838,
 839: 839,
 840: 840,
 841: 841,
 842: 842,
 843: 843,
 844: 844,
 845: 845,
 846: 846,
 847: 847,
 848: 848,
 849: 849,
 850: 850,
 851: 851,
 852: 852,
 853: 853,
 854: 854,
 855: 855,
 856: 856,
 857: 857,
 858: 858,
 859: 859,
 860: 860,
 861: 861,
 862: 862,
 863: 863,
 864: 864,
 865: 865,
 866: 866,
 867: 867,
 868: 868,
 869: 869,
 870: 870,
 871: 871,
 872: 872,
 873: 873,
 874: 874,
 875: 875,
 876: 876,
 877: 877,
 878: 878,
 879: 879,
 880: 880,
 881: 881,
 882: 882,
 883: 883,
 884: 884,
 885: 885,
 886: 886,
 887: 887,
 888: 888,
 889: 889,
 890: 890,
 891: 891,
 892: 892,
 893: 893,
 894: 894,
 895: 895,
 896: 896,
 897: 897,
 898: 898,
 899: 899,
 900: 900,
 901: 901,
 902: 902,
 903: 903,
 904: 904,
 905: 905,
 906: 906,
 907: 907,
 908: 908,
 909: 909,
 910: 910,
 911: 911,
 912: 912,
 913: 913,
 914: 914,
 915: 915,
 916: 916,
 917: 917,
 918: 918,
 919: 919,
 920: 920,
 921: 921,
 922: 922,
 923: 923,
 924: 924,
 925: 925,
 926: 926,
 927: 927,
 928: 928,
 929: 929,
 930: 930,
 931: 931,
 932: 932,
 933: 933,
 934: 934,
 935: 935,
 936: 936,
 937: 937,
 938: 938,
 939: 939,
 940: 940,
 941: 941,
 942: 942,
 943: 943,
 944: 944,
 945: 945,
 946: 946,
 947: 947,
 948: 948,
 949: 949,
 950: 950,
 951: 951,
 952: 952,
 953: 953,
 954: 954,
 955: 955,
 956: 956,
 957: 957,
 958: 958,
 959: 959,
 960: 960,
 961: 961,
 962: 962,
 963: 963,
 964: 964,
 965: 965,
 966: 966,
 967: 967,
 968: 968,
 969: 969,
 970: 970,
 971: 971,
 972: 972,
 973: 973,
 974: 974,
 975: 975,
 976: 976,
 977: 977,
 978: 978,
 979: 979,
 980: 980,
 981: 981,
 982: 982,
 983: 983,
 984: 984,
 985: 985,
 986: 986,
 987: 987,
 988: 988,
 989: 989,
 990: 990,
 991: 991,
 992: 992,
 993: 993,
 994: 994,
 995: 995,
 996: 996,
 997: 997,
 998: 998,
 999: 999,
 ...}</code></pre>
<p><code>hash()</code> function</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Get hash of the object</span></span><br><span class="line"><span class="built_in">hash</span>(<span class="number">10_000_000</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>10000000</code></pre>
<h1 id="operation-time-of-the-loops">Operation time of the loops</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">%%timeit</span><br><span class="line"><span class="number">10_000_000</span> <span class="keyword">in</span> my_large_dict</span><br></pre></td></tr></tbody></table></figure>
<pre><code>327 ns ± 141 ns per loop (mean ± std. dev. of 7 runs, 1,000,000 loops each)</code></pre>
<h1 id="dict">Dict</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="number">1</span>:<span class="string">'jonathan'</span>,<span class="number">2</span>:<span class="string">'julian'</span>}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(d)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 2]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> d.items():</span><br><span class="line">  <span class="built_in">print</span>(d[key])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>jonathan
julian</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(d.items())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 'jonathan'), (2, 'julian')]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>(d)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d[<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'jonathan'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">a,b,c = my_list</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a,b = (b,a)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">b</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<p>There's no difference between these two expressions.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a,b = b,a</span><br><span class="line">a</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">seq = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">add = <span class="keyword">lambda</span> x, y: x+y</span><br><span class="line">seq_avg = reduce(add,seq)/<span class="built_in">len</span>(seq)</span><br><span class="line">seq_avg</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2.5</code></pre>
<p>Operation time of dict is very slow than list But faster for
lookup</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">phon = {x: x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100_000_000</span>)}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">min_coins</span>(<span class="params">c, S</span>):</span><br><span class="line">  <span class="keyword">if</span> c&lt;<span class="number">0</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span></span><br></pre></td></tr></tbody></table></figure>
<h1 id="brief-of-if-and-else">Brief of if and else</h1>
<p>result_true if cond(A) else result_false</p>
<h1 id="application-of-dict-listtuple">Application of <code>dict</code>,
<code>list</code>,<code>tuple</code></h1>
<h2 id="list-1">List</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list[<span class="number">0</span>], my_list[-<span class="number">1</span>], my_list[:<span class="number">2</span>], my_list[-<span class="number">2</span>:]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0, 2, [0, 1], [1, 2])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list.append(<span class="number">3</span>)</span><br><span class="line">my_list</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 1, 2, 3]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list+my_list</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 1, 2, 3, 0, 1, 2, 3]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_list*<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 3]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">4</span> <span class="keyword">in</span> my_list <span class="comment"># expensive:searching over whole list</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<p>my_list = [func(x) for x in interable if cond(x)]</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">[x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>) <span class="keyword">if</span> x % <span class="number">3</span> ==<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 3, 6, 9]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10_000_000_000</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>range(0, 10000000000)</code></pre>
<p>If you use <code>list(range(10_000_000_000))</code>, it will crush
your computer. For list has much longer operation time. And it will
iterate the expression. Thus, <code>list()</code> must have iterable
arguments. Check hlep() of list.</p>
<h3 id="exercise-is_prime">Exercise: is_prime</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n):</span><br><span class="line">        <span class="keyword">if</span> n % k == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">is_prime(<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<h1 id="all-function"><code>all()</code> function</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span>(n%k !=<span class="number">0</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n))</span><br><span class="line">is_prime(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>([n <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,<span class="number">101</span>) <span class="keyword">if</span> is_prime(n)])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>25</code></pre>
<h2 id="exercise-mean">Exercise mean()</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mean</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">'return the mean of the list of numbers x'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(x)/<span class="built_in">len</span>(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Error: mean("this is not a float")</span></span><br><span class="line">mean([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2.5</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">median</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">'return a median'</span></span><br><span class="line">    x_sorted = <span class="built_in">sorted</span>(x)</span><br><span class="line">    n = <span class="built_in">len</span>(x)</span><br><span class="line">    <span class="keyword">if</span> n%<span class="number">2</span> ==<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> x_sorted[(n-<span class="number">1</span>)//<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (x_sorted[n//<span class="number">2</span>-<span class="number">1</span>] + x_sorted[n//<span class="number">2</span>])/<span class="number">2</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">x = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">median(x)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>2.5</code></pre>
<h1 id="sorted-list-sort-and-sorted">Sorted List <code>sort()</code> and
<code>sorted()</code></h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">x.sort()</span><br><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 1, 2, 3, 4]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x_sorted = x.sort()</span><br><span class="line">x_sorted</span><br><span class="line"><span class="built_in">type</span>(x_sorted)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>NoneType</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x_sorted = <span class="built_in">sorted</span>(x)</span><br><span class="line">x_sorted</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 1, 2, 3, 4]</code></pre>
<h1 id="if-you-want-to-get-integer">If you want to get integer</h1>
<p>The index of the list must be integer, sometimes it might be wrong
using <code>x/2</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">4</span>//<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">4</span>//<span class="number">1.0</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>4.0</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">5</span>//<span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">4</span>/<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>2.0</code></pre>
<h1 id="all-function-1"><code>all()</code> function</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">all</span>(k%<span class="number">2</span> !=<span class="number">0</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n))</span><br></pre></td></tr></tbody></table></figure>
<p>return true if all the expression is true</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mean</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sum</span>(x)/<span class="built_in">len</span>(x)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>If the type is not right, it will return wrong. And make the program
easier to understand</p>
<h1 id="dict-1"><code>Dict</code></h1>
<ul>
<li>Used to store key-value pairs</li>
<li>Fast lookup</li>
<li>"Gereralized lists"</li>
<li>Keys must be <strong>hashable</strong>; values can be anything</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_dict = {<span class="string">"cat"</span>: [<span class="string">"kitten"</span>,<span class="string">"Gaff"</span>], <span class="string">"dog"</span>: <span class="string">"puppy"</span>, <span class="string">"chicken"</span>: <span class="string">"chick"</span>}</span><br><span class="line">my_dict[<span class="string">"cat"</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['kitten', 'Gaff']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_dict[<span class="string">"cat"</span>][<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'kitten'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># iterators to keys, values, and key/value pairs</span></span><br><span class="line"><span class="built_in">list</span>(my_dict.keys())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['cat', 'dog', 'chicken']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># If no "list", the type is different</span></span><br><span class="line">my_dict.keys()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>dict_keys(['cat', 'dog', 'chicken'])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(my_dict.values())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[['kitten', 'Gaff'], 'puppy', 'chick']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># return As Tuple</span></span><br><span class="line"><span class="built_in">list</span>(my_dict.items())</span><br><span class="line"><span class="comment"># A method for loops:</span></span><br><span class="line"><span class="comment"># for k,v in d.items():</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('cat', ['kitten', 'Gaff']), ('dog', 'puppy'), ('chicken', 'chick')]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># return a default value if missing</span></span><br><span class="line">my_dict.get(<span class="string">"penguin"</span>, <span class="literal">None</span>)  </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># return a default value if missing</span></span><br><span class="line">my_dict.get(<span class="string">"penguin"</span>, <span class="string">"not found"</span>)  </span><br></pre></td></tr></tbody></table></figure>
<pre><code>'not found'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_dict.get(<span class="string">"cat"</span>, <span class="string">"not found"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['kitten', 'Gaff']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># add two dicts together; requires Python 3.9+</span></span><br><span class="line">my_dict | {<span class="string">"horse"</span>: <span class="string">"foal"</span>}  </span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'cat': ['kitten', 'Gaff'],
 'dog': 'puppy',
 'chicken': 'chick',
 'horse': 'foal'}</code></pre>
<h2 id="exercise-mode">Exercise mode()</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>].count(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># This operation is expensive: O(n)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mode</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    highest_count = -<span class="number">1</span></span><br><span class="line">    highest_value = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> x:</span><br><span class="line">        <span class="keyword">if</span> x.count(y) &gt; highest_count:</span><br><span class="line">            highest_count = x.count(y)</span><br><span class="line">            highest_value = y</span><br><span class="line">    <span class="keyword">return</span> highest_value</span><br><span class="line"></span><br><span class="line">mode([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mode</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    d = {}</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> x:</span><br><span class="line">        <span class="comment"># if y not in d:</span></span><br><span class="line">        <span class="comment">#     d[y]=0</span></span><br><span class="line">        d.setdefault(y,<span class="number">0</span>) <span class="comment"># if None, set default num = 0</span></span><br><span class="line">        d[y]+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">mode([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>])   </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>{0: 1, 1: 2, 2: 1}</code></pre>
<h2 id="max"><code>max()</code></h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">max</span>([<span class="number">0</span>,<span class="number">1</span>,<span class="number">23</span>,<span class="number">3</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>23</code></pre>
<h2 id="count-list"><code>count()</code> list</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># count the object</span></span><br><span class="line">my_list.count(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<h2 id="setdefault"><code>setdefault()</code></h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d={}</span><br><span class="line">y=<span class="number">0</span></span><br><span class="line">d.setdefault(y,<span class="number">0</span>) <span class="comment"># 如果是空集，就赋值一个默认值</span></span><br><span class="line">d[y]=d[y]+<span class="number">1</span></span><br><span class="line">d</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{0: 1}</code></pre>
<h1 id="collections-类"><code>Collections</code> 类</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">Counter([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Counter({0: 1, 1: 2, 2: 1})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Counter([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>])[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># return the first n most common entries</span></span><br><span class="line">Counter([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]).most_common(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(2, 3)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mode</span>(<span class="params">x: <span class="built_in">list</span>[<span class="built_in">float</span>]</span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="keyword">return</span> Counter(x).most_common(<span class="number">1</span>)[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">mode([<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<h1 id="tuple">Tuple</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Compare the first element</span></span><br><span class="line">(<span class="number">0</span>,<span class="number">1</span>) &gt; (<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Compare the first element</span></span><br><span class="line"><span class="built_in">max</span>((<span class="number">0</span>,<span class="number">3</span>),(<span class="number">1</span>,<span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1, 2)</code></pre>
<h2 id="exerciseharry-potter">Exercise：Harry Potter</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">hp1 = <span class="built_in">list</span>(<span class="built_in">open</span>(<span class="string">"2/hp1.txt"</span>,<span class="string">"rt"</span>))</span><br><span class="line">hp1[:<span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>["Harry Potter and the Sorcerer's Stone\n", '\n', '\n', 'CHAPTER ONE\n', '\n']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>(hp1)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>10702</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">hp1[<span class="number">0</span>].split(<span class="string">" "</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Harry', 'Potter', 'and', 'the', "Sorcerer's", 'Stone\n']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">hp1[<span class="number">0</span>].strip().split(<span class="string">" "</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Harry', 'Potter', 'and', 'the', "Sorcerer's", 'Stone']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">all_word = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> hp1:</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> line.strip().split(<span class="string">" "</span>):</span><br><span class="line">        all_word.append(word)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">all_word = [word </span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> hp1 </span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> line.strip().split(<span class="string">" "</span>)</span><br><span class="line">            ]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">all_word[<span class="number">5</span>:<span class="number">10</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Stone', '', '', 'CHAPTER', 'ONE']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 参见String部分</span></span><br><span class="line"><span class="comment"># "" 返回 False</span></span><br><span class="line">all_word = [word </span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> hp1 </span><br><span class="line">            <span class="keyword">for</span> word <span class="keyword">in</span> line.strip().split(<span class="string">" "</span>)</span><br><span class="line">            <span class="keyword">if</span> word</span><br><span class="line">            ]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">all_word[<span class="number">5</span>:<span class="number">10</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Stone', 'CHAPTER', 'ONE', 'THE', 'BOY']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">c = Counter(all_word)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">c.most_common(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('the', 3306), ('to', 1827), ('and', 1787), ('a', 1577), ('of', 1235)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">stopwords = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">"2/stopwords.txt"</span>,<span class="string">"rt"</span>)]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">uncommon_words = [word <span class="keyword">for</span> word <span class="keyword">in</span> all_word <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Counter(uncommon_words).most_common(<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('Harry', 903), ('--', 688), ('said', 659), ('I', 499), ('He', 468)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">caps = [word <span class="keyword">for</span> word <span class="keyword">in</span> all_word <span class="keyword">if</span> word[<span class="number">0</span>].upper()==word[<span class="number">0</span>] <span class="keyword">and</span> <span class="built_in">len</span>(word)&gt;<span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Counter(caps).most_common(<span class="number">5</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('Hagrid', 196),
 ('Hermione', 175),
 ('Professor', 161),
 ('Harry,', 134),
 ('Harry.', 115)]</code></pre>
<h1 id="iterators">Iterators</h1>
<p>Iterable is python 的精髓</p>
<p>Iterator:</p>
<ul>
<li>Call <code>next()</code></li>
<li>IF no more values Next() raise
<code>stopiteration</code>（是exception的一种）</li>
<li>可以infinite，但是list不可以</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">a = [1,2]</span></span><br><span class="line"><span class="string">next(a)</span></span><br><span class="line"><span class="string">next(a)</span></span><br><span class="line"><span class="string">next(a)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>List is not an iterator</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># Iterate something</span></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">a = <span class="built_in">iter</span>(a)</span><br><span class="line"><span class="built_in">next</span>(a)</span><br><span class="line"><span class="built_in">next</span>(a)</span><br><span class="line"><span class="built_in">next</span>(a)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

StopIteration                             Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 134' in &lt;module&gt;
     &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000133?line=10'&gt;11&lt;/a&gt; next(a)
     &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000133?line=11'&gt;12&lt;/a&gt; next(a)
---&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000133?line=12'&gt;13&lt;/a&gt; next(a)


StopIteration: </code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">len(a)</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>TypeError: object of type 'list_iterator' has no len()</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="built_in">len</span>(a)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 135' in &lt;module&gt;
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000134?line=0'&gt;1&lt;/a&gt; """
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000134?line=1'&gt;2&lt;/a&gt; len(a)
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000134?line=2'&gt;3&lt;/a&gt; &gt;&gt;&gt; TypeError: object of type 'list_iterator' has no len()
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000134?line=3'&gt;4&lt;/a&gt; """
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000134?line=4'&gt;5&lt;/a&gt; len(a)


TypeError: object of type 'list_iterator' has no len()</code></pre>
<p>Iterator and Generator can hold large dataset, not off memory.
Conceptually represent large dataset.</p>
<p><strong>Iterable</strong> is something I can call the function
<code>iter()</code> on. Eg: list is an iterable.</p>
<p>All the <strong>container</strong> are iterable. Eg: dicts</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="number">1</span>:<span class="string">"a"</span>,<span class="number">2</span>:<span class="string">"b"</span>}</span><br><span class="line">e = <span class="built_in">iter</span>(d)</span><br><span class="line"><span class="comment"># return the key of dict</span></span><br><span class="line"><span class="built_in">next</span>(e)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">it = <span class="built_in">iter</span>(iterable)</span><br><span class="line"><span class="keyword">while</span> true:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        a  =<span class="built_in">next</span>(t)</span><br><span class="line">    <span class="keyword">except</span> SropIteration:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="itertools">Itertools</h2>
<ul>
<li>Group By</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">a_list = [(<span class="string">"Animal"</span>, <span class="string">"cat"</span>), </span><br><span class="line">          (<span class="string">"Animal"</span>, <span class="string">"dog"</span>), </span><br><span class="line">          (<span class="string">"Bird"</span>, <span class="string">"peacock"</span>), </span><br><span class="line">          (<span class="string">"Bird"</span>, <span class="string">"pigeon"</span>)]</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">an_iterator = itertools.groupby(a_list, <span class="keyword">lambda</span> x : x[<span class="number">0</span>])</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> key, group <span class="keyword">in</span> an_iterator:</span><br><span class="line">    key_and_group = {key : <span class="built_in">list</span>(group)}</span><br><span class="line">    <span class="built_in">print</span>(key_and_group)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'Animal': [('Animal', 'cat'), ('Animal', 'dog')]}
{'Bird': [('Bird', 'peacock'), ('Bird', 'pigeon')]}</code></pre>
<h3 id="it.product-将两个list一一对应形成一系列tuple"><code>it.product</code>
将两个list一一对应形成一系列tuple</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools <span class="keyword">as</span> it</span><br><span class="line">suits = <span class="string">"♦♣♥♠"</span></span><br><span class="line">ranks = [<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">11</span>)] + <span class="built_in">list</span>(<span class="string">"JQKA"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cards = it.product(ranks, suits)</span><br><span class="line"><span class="built_in">next</span>(cards)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>('2', '♦')</code></pre>
<p>iter.product 不能shuffle</p>
<p>Error: object of type "itertools.product" has no len()</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.shuffle(cards)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 143' in &lt;module&gt;
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000142?line=0'&gt;1&lt;/a&gt; import random
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000142?line=1'&gt;2&lt;/a&gt; random.shuffle(cards)


File C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0\lib\random.py:391, in Random.shuffle(self, x, random)
    &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=388'&gt;389&lt;/a&gt; if random is None:
    &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=389'&gt;390&lt;/a&gt;     randbelow = self._randbelow
--&gt; &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=390'&gt;391&lt;/a&gt;     for i in reversed(range(1, len(x))):
    &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=391'&gt;392&lt;/a&gt;         # pick an element in x[:i+1] with which to exchange x[i]
    &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=392'&gt;393&lt;/a&gt;         j = randbelow(i + 1)
    &lt;a href='file:///c%3A/Program%20Files/WindowsApps/PythonSoftwareFoundation.Python.3.10_3.10.752.0_x64__qbz5n2kfra8p0/lib/random.py?line=393'&gt;394&lt;/a&gt;         x[i], x[j] = x[j], x[i]


TypeError: object of type 'itertools.product' has no len()</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(cards)</span><br><span class="line"><span class="comment"># list(cards)</span></span><br><span class="line"><span class="comment"># 第二次list(iterator)返回空集，因为iterator已经遍历完了</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('2', '♣'),
 ('2', '♥'),
 ('2', '♠'),
 ('3', '♦'),
 ('3', '♣'),
 ('3', '♥'),
 ('3', '♠'),
 ('4', '♦'),
 ('4', '♣'),
 ('4', '♥'),
 ('4', '♠'),
 ('5', '♦'),
 ('5', '♣'),
 ('5', '♥'),
 ('5', '♠'),
 ('6', '♦'),
 ('6', '♣'),
 ('6', '♥'),
 ('6', '♠'),
 ('7', '♦'),
 ('7', '♣'),
 ('7', '♥'),
 ('7', '♠'),
 ('8', '♦'),
 ('8', '♣'),
 ('8', '♥'),
 ('8', '♠'),
 ('9', '♦'),
 ('9', '♣'),
 ('9', '♥'),
 ('9', '♠'),
 ('10', '♦'),
 ('10', '♣'),
 ('10', '♥'),
 ('10', '♠'),
 ('J', '♦'),
 ('J', '♣'),
 ('J', '♥'),
 ('J', '♠'),
 ('Q', '♦'),
 ('Q', '♣'),
 ('Q', '♥'),
 ('Q', '♠'),
 ('K', '♦'),
 ('K', '♣'),
 ('K', '♥'),
 ('K', '♠'),
 ('A', '♦'),
 ('A', '♣'),
 ('A', '♥'),
 ('A', '♠')]</code></pre>
<h3 id="随机list">随机list</h3>
<ul>
<li>Only List</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">a = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line">random.shuffle(a)</span><br><span class="line">a</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[2, 1, 4, 3, 0]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(cards)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(cards)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[]</code></pre>
<p>Only can list once. 第二次为空，除非重新iter.product</p>
<h3 id="iterable-can-be-infinite">iterable can be infinite</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">natural = itertools.count()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Never stop</span></span><br><span class="line"><span class="built_in">next</span>(natural)</span><br><span class="line"><span class="comment"># No `list(natural)` : because it is infinite</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>0</code></pre>
<h3 id="itertools.islice"><code>itertools.islice</code></h3>
<ul>
<li>Can not slice iterable, unless use <code>islice</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">natural = itertools.count()</span><br><span class="line"><span class="comment"># 0-37</span></span><br><span class="line">naturalsTo38 = itertools.islice(natural,<span class="number">38</span>)</span><br><span class="line"><span class="built_in">list</span>(naturalsTo38)</span><br><span class="line"><span class="comment"># 76， 因为natural是一个iterator，上一句在37结束，下一句从38开始做第一个，然后从38个以后也就是76开始</span></span><br><span class="line">naturals38 = itertools.islice(natural,<span class="number">38</span>,<span class="literal">None</span>)</span><br><span class="line"><span class="built_in">next</span>(naturals38)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>76</code></pre>
<h1 id="generators">Generators</h1>
<ul>
<li>is a type of iterator</li>
<li><code>yield</code>: reserved word
<ul>
<li>直到最后一个之后，return StopIteration</li>
<li>能够从上次结束的位置开始，<strong>无需重新循环一遍</strong></li>
<li>有点类似<code>return</code>,按顺序每次返回一个数，返回的type是generator</li>
</ul></li>
</ul>
<h3 id="yield"><code>yield</code></h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">one</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">one()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;generator object one at 0x000001CE21C93D80&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_first_iter = one()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">next</span>(my_first_iter)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ten</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">yield</span> i**<span class="number">2</span></span><br><span class="line">my_2nd_iter = ten()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">next</span>(my_2nd_iter)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">5</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">g = gen()</span><br><span class="line"><span class="built_in">list</span>(g)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 2, 3, 4, 5, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></pre>
<h4 id="generate-the-perfect-numbers">Generate the perfect numbers</h4>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">divisors</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n) <span class="keyword">if</span> n%i==<span class="number">0</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_perfect</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(divisors(i))==i</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">perfect_numbers</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> is_perfect(i):</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">perfects = perfect_numbers()</span><br><span class="line"><span class="comment"># 这里不能直接next(perfect_numbers()), 否则一直是第一个数</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">next</span>(perfects)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0</code></pre>
<h1 id="exceptions">Exceptions</h1>
<ul>
<li>exception is object</li>
<li>https://docs.python.org/3/library/exceptions.html</li>
<li>常用：ValueError, TypeError, RuntimeError</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> can_do_thing():</span><br><span class="line">    do_thing()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    handle_error()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do_thing()</span><br><span class="line"><span class="keyword">except</span> NoCanDo:</span><br><span class="line">    handle_error()</span><br></pre></td></tr></tbody></table></figure>
<p>Never:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do_thing()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    handle_error()</span><br></pre></td></tr></tbody></table></figure>
<p>Never:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do_thing()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="number">1</span>:<span class="number">2</span>}</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span>(d[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"1 not in"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(d[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"key not in via excepttion"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<h1 id="files">Files</h1>
<ul>
<li><code>open(filename,mode)</code> default: read only
<ul>
<li>reading,writing,or appending</li>
<li>text or binary(.dat)</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">"readme.txt"</span>):</span><br><span class="line">    <span class="built_in">print</span>(line)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

FileNotFoundError                         Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 171' in &lt;module&gt;
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000170?line=0'&gt;1&lt;/a&gt; for line in open("readme.txt"):
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000170?line=1'&gt;2&lt;/a&gt;     print(line)


FileNotFoundError: [Errno 2] No such file or directory: 'readme.txt'</code></pre>
<h1 id="formatting-strings">Formatting strings</h1>
<ul>
<li>% (old)</li>
<li>string.format()</li>
<li>f_strings(newest)</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">topping = <span class="string">"tomato"</span></span><br><span class="line"><span class="string">"my fav pizza is %s"</span> % topping</span><br><span class="line"><span class="string">"my fav pizza is {}"</span>.<span class="built_in">format</span>(topping)</span><br><span class="line"><span class="string">"my fav pizza is {topping}"</span>.<span class="built_in">format</span>(topping=topping)</span><br><span class="line"><span class="string">f"my fav pizza is <span class="subst">{topping}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Exercise: Weather in Ann Arbor</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">!head <span class="number">3</span>/a2temps.dat</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'head' �����ڲ����ⲿ���Ҳ���ǿ����еĳ���
���������ļ���</code></pre>
<p><code>*variate</code>可以用作多个data一次性赋值list：packing</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'3/a2temps.dat'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    tbl1 = <span class="built_in">list</span>(itertools.islice(f,<span class="number">2</span>,<span class="number">2</span>+<span class="number">3</span>))</span><br><span class="line">    month,*data = tbl1[<span class="number">0</span>].strip().split(<span class="string">","</span>)</span><br><span class="line">data[:<span class="number">5</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>['206', '267', '261', '228', '139']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">month,*data = <span class="built_in">map</span>(<span class="built_in">int</span>,tbl1[<span class="number">0</span>].strip().split(<span class="string">","</span>))</span><br><span class="line">data[:<span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[206, 267, 261, 228, 139]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parse_table</span>(<span class="params">txt</span>):</span><br><span class="line">    d = {}</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> txt:</span><br><span class="line">        month,*data = <span class="built_in">map</span>(<span class="built_in">int</span>,line.strip().split(<span class="string">","</span>))</span><br><span class="line">        d[month] = data</span><br><span class="line">    <span class="keyword">return</span> d</span><br></pre></td></tr></tbody></table></figure>
<p><code>repr()</code> is what python actually sees</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">a2temps = {}</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'3/a2temps.dat'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = []</span><br><span class="line">    current_year = <span class="number">1891</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(line) == <span class="number">4</span>:</span><br><span class="line">            a2temps[current_year] = parse_table(lines)</span><br><span class="line">            lines = []</span><br><span class="line">            current_year = <span class="built_in">int</span>(line)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(line) &gt; <span class="number">4</span>:</span><br><span class="line">            lines.append(line)</span><br><span class="line"><span class="comment"># a2temps[year][month][day]</span></span><br><span class="line">a2temps[<span class="number">1893</span>][<span class="number">1</span>][:<span class="number">5</span>]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[-6, 0, -83, -94, -72]</code></pre>
<h1 id="generator">Generator</h1>
<ul>
<li>expression like list, but create iterator</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = Squares() <span class="comment"># infinite</span></span><br><span class="line"><span class="comment"># Error: [x**2 for x in s]</span></span><br><span class="line">sggen = (x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> s)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">even</span>():</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> i</span><br><span class="line">        i+=<span class="number">2</span></span><br><span class="line"></span><br><span class="line">e = even()</span><br><span class="line"><span class="built_in">next</span>(e),<span class="built_in">next</span>(e),<span class="built_in">next</span>(e)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0, 2, 4)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">gen = (e**<span class="number">2</span> <span class="keyword">for</span> e <span class="keyword">in</span> even())</span><br><span class="line">gen</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;generator object &lt;genexpr&gt; at 0x000001CEF3932CE0&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">next</span>(gen),<span class="built_in">next</span>(gen),<span class="built_in">next</span>(gen)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0, 4, 16)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">r = <span class="built_in">range</span>(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">sum</span>(</span><br><span class="line">    (rr**<span class="number">2</span> <span class="keyword">for</span> rr <span class="keyword">in</span> r)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>285</code></pre>
<h1 id="lambda-expressions"><code>lambda</code> expressions</h1>
<ul>
<li>define functions without <code>def</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x: x**<span class="number">2</span></span><br><span class="line">f(<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>100</code></pre>
<h1 id="any-and-all"><code>any()</code> and <code>all()</code></h1>
<ul>
<li>argument must be iterator</li>
<li><code>any()</code> return True if and only if one or more is
True:</li>
<li>0,0.0,empty string, empty list, is False</li>
<li><code>all()</code> return True if all is true</li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">any</span>((<span class="number">0</span>,<span class="number">0.0</span>,<span class="string">""</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<h1 id="reading-csv-and-txt">Reading csv and txt</h1>
<p><code>open()</code> is an iterable</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'4/example2.txt'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(line.strip().split(<span class="string">","</span>))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>['1', '2', '3', '4']
['5', '6', '7', '8']
['9', '10', '11', '12']</code></pre>
<h2 id="reading-csv-with-a-header">Reading csv with a header</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">open</span>(<span class="string">"4/example3.txt"</span>).read())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>col1,col2,col3,col4
1,2,3,4
5,6,7,8
9,10,11,12</code></pre>
<p>​</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'4/example3.txt'</span>)</span><br><span class="line">header = <span class="built_in">next</span>(f).strip().split(<span class="string">","</span>)</span><br><span class="line">data =[]</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    data.append(line.strip().split(<span class="string">","</span>))</span><br><span class="line">header,data</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(['col1', 'col2', 'col3', 'col4'],
 [['1', '2', '3', '4'], ['5', '6', '7', '8'], ['9', '10', '11', '12']])</code></pre>
<h2 id="using-pandas-to-read-and-write-csv">using pandas to read and
write csv</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">pd.read_csv(<span class="string">"4/example3.txt"</span>)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
col1
</th>
<th>
col2
</th>
<th>
col3
</th>
<th>
col4
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1
</td>
<td>
2
</td>
<td>
3
</td>
<td>
4
</td>
</tr>
<tr>
<th>
1
</th>
<td>
5
</td>
<td>
6
</td>
<td>
7
</td>
<td>
8
</td>
</tr>
<tr>
<th>
2
</th>
<td>
9
</td>
<td>
10
</td>
<td>
11
</td>
<td>
12
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="reading-bytes-from-a-file">Reading bytes from a file</h2>
<ul>
<li><code>file.read(b)</code> will read b bytes from a file.</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'4/example3.txt'</span>,<span class="string">'rb'</span>)</span><br><span class="line">b = f.read(<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">b,<span class="built_in">type</span>(b)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(b'col1', bytes)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Error:TypeError: can't concat str to bytes</span></span><br><span class="line"><span class="comment"># print(b+"2345")</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(b.decode(<span class="string">"ascii"</span>)+<span class="string">"2345"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>col12345</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">type</span>(b.decode(<span class="string">"ascii"</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>str</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#character</span></span><br><span class="line"><span class="built_in">print</span>(b.decode(<span class="string">"ascii"</span>))</span><br><span class="line"><span class="comment"># integer, big endian encoding</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>.from_bytes(b,<span class="string">'big'</span>))</span><br><span class="line"><span class="comment"># integer, little endian encoding</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">int</span>.from_bytes(b,<span class="string">'little'</span>))</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="comment"># to Float</span></span><br><span class="line"><span class="built_in">print</span>(struct.unpack(<span class="string">'f'</span>,b))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>col1
1668246577
829189987
(3.4405835958040143e-09,)</code></pre>
<h1 id="object">Object</h1>
<ul>
<li>everything in python is an object</li>
<li>object-oriented programming</li>
<li><code>class</code> name in CamelCase</li>
<li>Object &amp; instance</li>
<li>attribute
<ul>
<li>attributeobject embedded: object have other object as their
attributes.</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiation: instance(object) p of the class Point</span></span><br><span class="line">p = Point()</span><br><span class="line"><span class="built_in">type</span>(p)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>__main__.Point</code></pre>
<p>Constructor:</p>
<ul>
<li><p>__开始的函数</p></li>
<li><p><code>__init__()</code> is to initialize the object</p></li>
<li><p><code>self</code>, refer to the object itself: DON'T
FORGET!</p></li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># invisiblely : __init__: initialize the method</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        <span class="built_in">print</span>(self,x,y)</span><br><span class="line">        self.x =x</span><br><span class="line">        self.y = y</span><br><span class="line">p = Point(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(p.x,p.y)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;__main__.Point object at 0x000001CF0323E8F0&gt; 1 1
1 1</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,x,y</span>):</span><br><span class="line">        self.x =x</span><br><span class="line">        self.y = y</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">norm</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># DON'T FORGET: self</span></span><br><span class="line">        <span class="keyword">return</span> math.sqrt(self.x**<span class="number">2</span>+self.y**<span class="number">2</span>)</span><br><span class="line">p = Point(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">p.norm()</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1.4142135623730951</code></pre>
<h3 id="tictoctoe">TicTocToe</h3>
<ul>
<li>Define Private Variable in Python: <code>_variable</code>.
<strong>[Convention]</strong></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TicTacToe</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>():</span><br><span class="line">        self._board = [</span><br><span class="line">            [<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>],</span><br><span class="line">            [<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>],</span><br><span class="line">            [<span class="literal">None</span>,<span class="literal">None</span>,<span class="literal">None</span>]</span><br><span class="line">        ]</span><br><span class="line">        self._turn = <span class="string">"X"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">move</span>(<span class="params">self,i,j</span>):</span><br><span class="line">        <span class="keyword">if</span> self._board[i][j] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"square is occupied"</span>)</span><br><span class="line">        self._board[i][j] = self._turn</span><br><span class="line">        <span class="keyword">if</span> self._turn == <span class="string">"X"</span>:</span><br><span class="line">            self._turn = <span class="string">"O"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._turn = <span class="string">"X"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">winner</span>(<span class="params">board</span>):</span><br><span class="line">        winning_combinations = [</span><br><span class="line">            [(x, y), (x + a, y + b), (x + <span class="number">2</span> * a, y + <span class="number">2</span> * b)]</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">max</span>(a, b) &gt; <span class="number">0</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> winning_combinations:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = {board[x][y] <span class="keyword">for</span> x, y <span class="keyword">in</span> w}</span><br><span class="line">                sq = s.pop()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> <span class="keyword">and</span> sq <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">return</span> sq</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">!tail <span class="number">4</span>/ttt.py</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'tail' �����ڲ����ⲿ���Ҳ���ǿ����еĳ���
���������ļ���</code></pre>
<p><strong>Dunder methods:</strong></p>
<ul>
<li><code>__str__()</code>, show the object as a string
<ul>
<li>use <code>str()</code> to call this function</li>
<li>Or, when use <code>print()</code>, object will be showed as string
format</li>
</ul></li>
</ul>
<h3 id="example-class">Example: <code>class</code></h3>
<ul>
<li>How to specify a <code>constructor</code> in Python:
<ul>
<li><code>__init__()</code></li>
<li>dunder method</li>
<li></li>
</ul></li>
</ul>
<p><strong>The splat operator: <code>*args</code></strong>: any number
of arguments</p>
<ul>
<li>return a tuple</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">splat</span>(<span class="params">*args</span>):</span><br><span class="line">    <span class="built_in">print</span>(args)</span><br><span class="line"></span><br><span class="line">splat(<span class="number">1</span>,<span class="number">2</span>,<span class="string">"hello"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1, 2, 'hello')</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">splat</span>(<span class="params">a,b,*args</span>):</span><br><span class="line">    <span class="built_in">print</span>(a,b,args)</span><br><span class="line">splat(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1 2 (3, 4)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">splat</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a,b)</span><br><span class="line">splat(a=<span class="number">1</span>,b=<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1 2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">splat</span>(<span class="params">a,b,*args</span>):</span><br><span class="line">    <span class="built_in">print</span>(a,b,args)</span><br><span class="line">splat(a=<span class="number">1</span>,b=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># Error: splat(a=1,b=2,3)</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1 2 ()</code></pre>
<p>传递值时的不同</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">splat(*[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]) <span class="comment"># spat(1,2,3,4)</span></span><br><span class="line"><span class="comment"># not = splat([1,2,3,4])</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1 2 (3, 4)</code></pre>
<p><code>**kwargs</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">splat</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"{0}={1}"</span>.<span class="built_in">format</span>(key,value))</span><br><span class="line">splat(name=<span class="string">"jun"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>name=jun</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>():</span><br><span class="line">    <span class="string">"A vector of real numbers"</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,*args</span>):</span><br><span class="line">        <span class="keyword">from</span> numbers <span class="keyword">import</span> Number</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(arg,Number) <span class="keyword">for</span> arg <span class="keyword">in</span> args):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Vector requires numerical data"</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        self._val = <span class="built_in">tuple</span>(args)</span><br><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># Vector.__init__ = __init__</span></span><br><span class="line"><span class="comment"># Vector(1,2,3,[])</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p><code>isinstance(arg,Number)</code> check if it is a number</p>
<p><code>Vector.__init__ = __init__</code>
函数可以=，让两个函数相等,这里直接给class中添加后面的函数</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dim</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(self._val)</span><br><span class="line">Vector.dim = dim</span><br><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">v.dim()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<p>Decorate:<code>@property</code></p>
<ul>
<li>被标记的方法是属性</li>
<li>无法随意修改属性内容</li>
<li>调用时函数名后面可以不用加括号</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dim</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(self._val)</span><br><span class="line">Vector.dim = dim</span><br><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">v.dim</span><br><span class="line"><span class="comment"># Error: v.dim()</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<p>Dunder Method</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(self._val)</span><br><span class="line">Vector.__len__ = __len__</span><br><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="comment"># Error: v.len()</span></span><br><span class="line"><span class="built_in">len</span>(v)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<p><code>__getitem__</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self,i</span>):</span><br><span class="line">    <span class="keyword">return</span> self._val[i]</span><br><span class="line"></span><br><span class="line">Vector.__getitem__ = __getitem__</span><br><span class="line">Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1</code></pre>
<p>Iteration: <code>iter</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 等价于：return iter(self._val)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self)):</span><br><span class="line">        <span class="keyword">yield</span> self[i]</span><br><span class="line">        </span><br><span class="line">Vector.__iter__ = __iter__</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(v)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1
2
3</code></pre>
<p><code>stopiteration</code>的条件可以在<code>__next__</code>里面定义，同时更新self._val:<code>return self._val</code></p>
<p><code>__iter__</code>可以直接return self</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">    s = <span class="string">", "</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,self))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"("</span> + s + <span class="string">")"</span></span><br><span class="line"></span><br><span class="line">Vector.__str__ = __str__</span><br><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(v)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1, 2, 3)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Vector"</span>+<span class="built_in">str</span>(self)</span><br><span class="line">Vector.__repr__ = __repr__</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>x+y in python:</p>
<ul>
<li>try x.__add__(y)</li>
<li>if fails, Python tries y.__radd__(x)</li>
<li>if fails, Python raises TypeError</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, Vector):</span><br><span class="line">        <span class="keyword">if</span> self.dim == other.dim:</span><br><span class="line">            <span class="keyword">return</span> Vector(*[x + y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(self, other)])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"not the same dim"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vector.__add__ = __add__</span><br><span class="line">Vector(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) + Vector(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Vector(5, 7, 9)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">v = Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">next</span>(v)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;generator object __next__ at 0x000001AE30025FC0&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">zip</span>(Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),Vector(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 4), (2, 5), (3, 6)]</code></pre>
<p><strong>Notes</strong>:</p>
<ul>
<li>We used a new operator
<code>*[x + y for x, y in zip(self, other)]</code>. This is called the
"splat" operator. It takes all the items in the list (or iterable more
generally) and passes them in as function arguments.</li>
<li><code>NotImplemented</code> is a special Python value signifying
that the operation is not implemented. Here we do not allow anything to
be added to a vector except another vector.</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">    <span class="keyword">from</span> numbers <span class="keyword">import</span> Number</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, Number):</span><br><span class="line">        <span class="keyword">return</span> Vector(*[other * x <span class="keyword">for</span> x <span class="keyword">in</span> self])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vector.__mul__ = __mul__</span><br><span class="line">Vector(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) * <span class="number">2</span></span><br><span class="line">Vector.__rmul__ = __mul__</span><br><span class="line"><span class="number">2</span>*Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Vector(2, 4, 6)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Vector.__neg__ = <span class="keyword">lambda</span> self: -<span class="number">1</span>*self</span><br><span class="line">Vector.__sub__ = <span class="keyword">lambda</span> self,other:self+(-other)</span><br><span class="line">Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)-Vector(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Vector(0, 0, 0)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dot</span>(<span class="params">self, other</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(a * b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(self, other))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vector.dot = dot</span><br><span class="line">Vector(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).dot(Vector(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>8</code></pre>
<h2 id="classmethod"><code>@classmethod</code></h2>
<ul>
<li>A class method is a method which is bound to the class and not the
object of the class.</li>
<li>不需要预先生成一个object</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ones</span>(<span class="params">cls, d</span>):</span><br><span class="line">    <span class="string">"return the d-dimensional vector of ones"</span></span><br><span class="line">    ones = [<span class="number">1</span>] * d</span><br><span class="line">    <span class="keyword">return</span> cls(*ones)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vector.ones = ones</span><br><span class="line">Vector.ones(<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Vector(1, 1, 1)</code></pre>
<p>Note: 普通方法的话还需要先创建一个instance</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Vector.mean = <span class="keyword">lambda</span> self: <span class="built_in">sum</span>(self) / <span class="built_in">len</span>(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">var</span>(<span class="params">self</span>):</span><br><span class="line">    e = Vector.ones(<span class="built_in">len</span>(self))</span><br><span class="line">    s = self - self.mean() * e</span><br><span class="line">    <span class="keyword">return</span> s.dot(s) / (<span class="built_in">len</span>(self) - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Vector.var = var</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">Vector.std = <span class="keyword">lambda</span> self: math.sqrt(self.var())</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">X = Vector(*[random.normalvariate(mu=<span class="number">1</span>, sigma=<span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>)])</span><br><span class="line">X.mean(), X.var()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0.9980224941670806, 4.005165548865144)</code></pre>
<h2 id="dataframe-class">Dataframe class</h2>
<ul>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line">        self._val = <span class="built_in">tuple</span>(args)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(x, numbers.Number) <span class="keyword">for</span> x <span class="keyword">in</span> self):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Input should be a sequence of numbers"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dim</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._conformable(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> Vector(*[a + b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(self, other)])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">import</span> numbers</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(other, numbers.Number):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> Vector(*[a * other <span class="keyword">for</span> a <span class="keyword">in</span> self._val])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self._val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> self._conformable(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">all</span>(a == b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(self, other))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dot</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._conformable(other):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"cannot dot product with a non-conformable vector"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(a * b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(self, other))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__rmul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> self.__mul__(other)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(self._val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, i</span>):</span><br><span class="line">        <span class="keyword">return</span> self._val[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"("</span> + <span class="string">", "</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> self._val) + <span class="string">")"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_conformable</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">isinstance</span>(other, Vector) <span class="keyword">and</span> self.dim == other.dim</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">my_iris = {</span><br><span class="line">    <span class="string">'sepal_length'</span>: Vector(<span class="number">5.1</span>, <span class="number">4.9</span>, <span class="number">4.7</span>, <span class="number">4.6</span>, <span class="number">5.0</span>), </span><br><span class="line">    <span class="string">'sepal_width'</span>: Vector(<span class="number">3.5</span>, <span class="number">3.0</span>, <span class="number">3.2</span>, <span class="number">3.1</span>, <span class="number">3.6</span>),</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>positional argument: don't have a name</li>
<li>keyward argument: have a name</li>
<li>所以带变量名字的argument不能传递给positional argument</li>
<li><code>double splat</code>: new operator
<ul>
<li><code>**kwargs</code>: generate a dictionary with keywords</li>
<li>kwargs 不是唯一的，可以命名为别的</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">double_splat</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(kwargs)</span><br><span class="line">    <span class="comment"># print("I got passed these args:\n" + str(args))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">double_splat(kw1=<span class="number">1</span>, kw2=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line">kwargs = {<span class="string">'kw1'</span>: <span class="number">1</span>, <span class="string">'kw2'</span>: <span class="number">2</span>}</span><br><span class="line">double_splat(**kwargs)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'kw1': 1, 'kw2': 2}
{'kw1': 1, 'kw2': 2}</code></pre>
<p>If I want to support variable numbers of both keyword and positional
arguments, I can combine both forms of splat:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">both_splat</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"positional args"</span>, args)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"kw args"</span>, kwargs)</span><br><span class="line">    </span><br><span class="line">both_splat(<span class="number">1</span>, <span class="number">2</span>, kw=<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>positional args (1, 2)
kw args {'kw': 3}</code></pre>
<p>Python has some restrictions on the use of splat in functions. The
keyword arguments always come last:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">both_splat</span>(<span class="params">**kwargs, *args</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>  Input In [177]
    def both_splat(**kwargs, *args):
                             ^
SyntaxError: invalid syntax</code></pre>
<p>What if I want a mix of mandatory and optional arguments?</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">some_optional</span>(<span class="params">a, b, *args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, args, kwargs)</span><br><span class="line"></span><br><span class="line">some_optional(<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1 2 () {'c': 3}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataFrame</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">        self._data = kwargs    </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df = DataFrame(col=Vector(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;__main__.DataFrame at 0x1cf037f11e0&gt;</code></pre>
<p>Keys in dictionary:</p>
<ul>
<li>hashable</li>
<li>unique</li>
<li>keys is a <code>set</code>
<ul>
<li>set is unique</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>} <span class="comment"># set</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1, 2, 3}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">{x+<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)}</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a = {<span class="number">1</span>,<span class="number">2</span>}</span><br><span class="line">b = {<span class="number">2</span>,<span class="number">3</span>}</span><br><span class="line">a&amp;b,a|b</span><br></pre></td></tr></tbody></table></figure>
<pre><code>({2}, {1, 2, 3})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a = <span class="built_in">frozenset</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">b = <span class="built_in">frozenset</span>([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

AttributeError                            Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 268' in &lt;module&gt;
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000343?line=0'&gt;1&lt;/a&gt; a = frozenset([1,2,3])
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000343?line=1'&gt;2&lt;/a&gt; b = frozenset([4,5,6])
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000343?line=2'&gt;3&lt;/a&gt; a.add(b)


AttributeError: 'frozenset' object has no attribute 'add'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1, 2, 3}</code></pre>
<ul>
<li>list 不能作为key
<ul>
<li>unhashable</li>
<li>can be change</li>
</ul></li>
<li>set 中不能有list</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">set</span>([<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">"a"</span>,<span class="string">"b"</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 269' in &lt;module&gt;
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000268?line=0'&gt;1&lt;/a&gt; set([1,1,2,3,"a","b",[1,2,3]])


TypeError: unhashable type: 'list'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(col, Vector) <span class="keyword">for</span> col <span class="keyword">in</span> kwargs.values()):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">"DataFrame columns are Vectors"</span>)</span><br><span class="line">    dims = {<span class="built_in">len</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> kwargs.values()}  <span class="comment"># set comprehension</span></span><br><span class="line">    <span class="comment"># set 里面的值是unique的</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(dims) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"All columns must have the same dimension"</span>)</span><br><span class="line"></span><br><span class="line">DataFrame.__init__ = __init__</span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 282' in &lt;module&gt;
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000272?line=5'&gt;6&lt;/a&gt;     if len(dims) &gt; 1:
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000272?line=6'&gt;7&lt;/a&gt;         raise ValueError("All columns must have the same dimension")
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000272?line=8'&gt;9&lt;/a&gt; DataFrame.__init__ = __init__


NameError: name 'DataFrame' is not defined</code></pre>
<h2 id="inheritance">Inheritance</h2>
<ul>
<li><code>class ChildClass(ParentClass):</code></li>
<li>支持Multiple Inheritance</li>
<li>继承父类中的所有方法</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataFrame</span>(<span class="title class_ inherited__">dict</span>):</span><br><span class="line">    <span class="string">'a data set consisting of labeled vectors'</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">v1 = Vector(<span class="number">1</span>, <span class="number">2</span>); v2 = Vector(<span class="number">3</span>, <span class="number">4</span>); df = DataFrame(col1=v1, col2=v2)</span><br><span class="line">df[<span class="string">'col1'</span>], <span class="built_in">len</span>(df), <span class="built_in">list</span>(df)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(&lt;__main__.Vector at 0x1cf037f0e50&gt;, 2, ['col1', 'col2'])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">isinstance</span>(df, <span class="built_in">dict</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<p>The validation code we wrote above will not automatically apply. We
need to <em>override</em> the default <code>__init__</code> method of
<code>DataFrame</code> with our own:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">DataFrame.__init__ = __init__</span><br><span class="line">DataFrame(col1=v1, col2=v2)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{}</code></pre>
<h2 id="super-constructor">Super constructor</h2>
<ul>
<li>父类中也有一个__init__</li>
<li>如果不加super constructor 就没有initialize the thing that hold the
object</li>
<li>只需要call it in init function</li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, **kwargs</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(col, Vector) <span class="keyword">for</span> col <span class="keyword">in</span> kwargs.values()):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">"DataFrame columns are Vectors"</span>)</span><br><span class="line">    dims = {<span class="built_in">len</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> kwargs.values()}  <span class="comment"># set comprehension</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(dims) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"All columns must have the same dimension"</span>)</span><br><span class="line">    <span class="built_in">dict</span>.__init__(self, **kwargs)  <span class="comment"># call superconstructor</span></span><br><span class="line"></span><br><span class="line">DataFrame.__init__ = __init__</span><br><span class="line">DataFrame(col1=v1, col2=v2)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'col1': &lt;__main__.Vector at 0x1cf037f0e50&gt;,
 'col2': &lt;__main__.Vector at 0x1cf037f3670&gt;}</code></pre>
<p>This <code>__init__</code> function is okay, but has the deficiency
that it doesn't allow us to create DataFrames in other, more flexible
ways. For example, we can create a <code>dict</code> as follows:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">kv = [(<span class="number">1</span>, Vector(<span class="number">1</span>)), (<span class="number">2</span>, Vector(<span class="number">2</span>))]  <span class="comment"># key-value pairs</span></span><br><span class="line"><span class="built_in">dict</span>(kv)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1: &lt;__main__.Vector at 0x1cf037f22f0&gt;, 2: &lt;__main__.Vector at 0x1cf037f0640&gt;}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Not work for our Data Frame</span></span><br><span class="line">DataFrame(kv)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

c:\Users\Jun\Documents\Courses\Stats 507\CourseNote.ipynb Cell 281' in &lt;module&gt;
      &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000283?line=0'&gt;1&lt;/a&gt; # Not work for our Data Frame
----&gt; &lt;a href='vscode-notebook-cell:/c%3A/Users/Jun/Documents/Courses/Stats%20507/CourseNote.ipynb#ch0000283?line=1'&gt;2&lt;/a&gt; DataFrame(kv)


TypeError: __init__() takes 1 positional argument but 2 were given</code></pre>
<ul>
<li>More General way:<code>__init__(self, *args, **kwargs)</code></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">    <span class="built_in">dict</span>.__init__(self, *args, **kwargs)  <span class="comment"># call superconstructor</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>(<span class="built_in">isinstance</span>(col, Vector) <span class="keyword">for</span> col <span class="keyword">in</span> self.values()):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">"DataFrame columns are Vectors"</span>)</span><br><span class="line">    dims = {<span class="built_in">len</span>(v) <span class="keyword">for</span> v <span class="keyword">in</span> self.values()}  <span class="comment"># set comprehension</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(dims) &gt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"All columns must have the same dimension"</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">DataFrame.__init__ = __init__</span><br><span class="line">DataFrame(col1=v1, col2=v2)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'col1': &lt;__main__.Vector at 0x1cf037f0e50&gt;,
 'col2': &lt;__main__.Vector at 0x1cf037f3670&gt;}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Now we can do</span></span><br><span class="line">DataFrame(kv)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1: &lt;__main__.Vector at 0x1cf037f22f0&gt;, 2: &lt;__main__.Vector at 0x1cf037f0640&gt;}</code></pre>
<ul>
<li>Python 中不常用继承：
<ul>
<li>因为继承会继承父类所有的method， 有时候合并数据之类的会比较奇怪</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">DataFrame(col1=v1, col2=v2) | {<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>}</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'col1': &lt;__main__.Vector at 0x1cf037f0e50&gt;,
 'col2': &lt;__main__.Vector at 0x1cf037f3670&gt;,
 'a': 1,
 'b': 2}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="number">1</span>:<span class="number">2</span>}</span><br><span class="line">d.update(hello=<span class="number">3</span>)</span><br><span class="line">d</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1: 2, 'hello': 3}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df = DataFrame(col1=v1, col2=v2)</span><br><span class="line">df.update(col2=<span class="string">'uh oh'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;class '__main__.DataFrame'&gt;





{'col1': &lt;__main__.Vector at 0x1cf037f0e50&gt;, 'col2': 'uh oh'}</code></pre>
<h2 id="overide">Overide</h2>
<ul>
<li>overide the original function by using the original function</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, x</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(x,<span class="built_in">tuple</span>):</span><br><span class="line">        <span class="comment"># unpack a tuple!!!</span></span><br><span class="line">        k,i=x</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>.__getitem__(self,k)[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>.__getitem__(self, x)</span><br><span class="line"></span><br><span class="line">DataFrame.__getitem__ = __getitem__</span><br><span class="line">DataFrame(col1=v2, col2=v2)[<span class="string">'col1'</span>, <span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<h1 id="iterating-over-observations">Iterating over observations</h1>
<p>When analyzing data, it will be helpful to iterate over each
observation. Something like:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; df = DataFrame(col1=Vector(1, 2), col2=Vector(3, 4))</span><br><span class="line">&gt;&gt;&gt; for x in df.obs():</span><br><span class="line">&gt;&gt;&gt;    print(x)</span><br><span class="line">&gt;&gt;&gt;    ...</span><br><span class="line">{'col1': 1, 'col2': 3}</span><br><span class="line">{'col1': 2, 'col2': 4}</span><br></pre></td></tr></tbody></table></figure>
<p>To accomplish this, we'll want to zip together the vectors col1 and
col2:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">zip</span>(Vector(<span class="number">1</span>, <span class="number">2</span>), Vector(<span class="number">3</span>, <span class="number">4</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 3), (2, 4)]</code></pre>
<p>We will use this behavior to construct a second kind of iterator for
our class:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">obs</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">'Yields each observation as column-value dict'</span></span><br><span class="line">    <span class="keyword">for</span> vals <span class="keyword">in</span> <span class="built_in">zip</span>(self.values()):</span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">dict</span>(<span class="built_in">zip</span>(self, vals))</span><br></pre></td></tr></tbody></table></figure>
<p>Let's try it out:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">DataFrame.obs = obs</span><br><span class="line"><span class="keyword">for</span> ob <span class="keyword">in</span> DataFrame(col1=v1, col2=v2, col3=v1).obs():</span><br><span class="line">    <span class="built_in">print</span>(ob)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'col1': &lt;__main__.Vector object at 0x000001CF037F0E50&gt;}
{'col1': &lt;__main__.Vector object at 0x000001CF037F3670&gt;}
{'col1': &lt;__main__.Vector object at 0x000001CF037F0E50&gt;}</code></pre>
<p>因为问题出现在obs()中zip函数里，里面传的两个object组成的list，应该要加一个*，这样可以传递vector内部的值</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">obs</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">'Yields each observation as column-value dict'</span></span><br><span class="line">    <span class="keyword">for</span> vals <span class="keyword">in</span> <span class="built_in">zip</span>(*self.values()):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">list</span>(self))</span><br><span class="line">        <span class="comment"># 这里self返回的是key值</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">dict</span>(<span class="built_in">zip</span>(self, vals))</span><br><span class="line">DataFrame.obs = obs</span><br><span class="line"><span class="keyword">for</span> ob <span class="keyword">in</span> DataFrame(col1=v1, col2=v2, col3=v1).obs():</span><br><span class="line">    <span class="built_in">print</span>(ob)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['col1', 'col2', 'col3']
{'col1': 1, 'col2': 3, 'col3': 1}
['col1', 'col2', 'col3']
{'col1': 2, 'col2': 4, 'col3': 2}</code></pre>
<p>Note: 字典的list是key的list</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a = {<span class="string">"a"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">"b"</span>:[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]}</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a
b</code></pre>
<p>Note: <code>zip()</code> 可以形成一个一一对应的tuple
Python中很重要的概念就是iteration，要好好理解，有很多不同的用法</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">it = <span class="built_in">zip</span>(*df.values())</span><br><span class="line">vals = <span class="built_in">next</span>(it)</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">zip</span>(df,vals))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('col1', 1), ('col2', 'u')]</code></pre>
<p>Note: <code>**args</code>也可以理解为unpack every thing</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 0 1 2 3 4 5 ...</span></span><br><span class="line"><span class="comment"># 1 2 3 4 5 6 ...</span></span><br><span class="line"><span class="comment"># 2 3 4 5 6 7 ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">windowed</span>(<span class="params">iterable, k</span>):</span><br><span class="line">    <span class="string">'(x[1], x[2], ...) -&gt; [(x[1], ..., x[k]), (x[k], ..., x[k+1]), ...]'</span></span><br><span class="line">    <span class="comment"># k copies of iterable</span></span><br><span class="line">    iters = itertools.tee(iterable, k)</span><br><span class="line"></span><br><span class="line">    offsetted = [itertools.islice(it, i, <span class="literal">None</span>) <span class="keyword">for</span> i, it <span class="keyword">in</span> <span class="built_in">enumerate</span>(iters)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">zip</span>(*offsetted)</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>(windowed(<span class="built_in">range</span>(<span class="number">10</span>), <span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(0, 1, 2),
 (1, 2, 3),
 (2, 3, 4),
 (3, 4, 5),
 (4, 5, 6),
 (5, 6, 7),
 (6, 7, 8),
 (7, 8, 9)]</code></pre>
<h1 id="map-filter-and-reduce">map, filter, and reduce</h1>
<ul>
<li><code>map</code> applies a function to every element, yield a new
sequence(iterator)</li>
<li><code>filter</code> remove some element(TRUE or FALSE)</li>
<li></li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x**<span class="number">2</span>+<span class="number">1</span>,<span class="built_in">range</span>(<span class="number">10</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 2, 5, 10, 17, 26, 37, 50, 65, 82]</code></pre>
<h2 id="map"><code>map</code></h2>
<ul>
<li>2 positional args
<ul>
<li>number of iterables must match arguments in function</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">poly</span>(<span class="params">x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> (x*y)</span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(poly,<span class="built_in">range</span>(<span class="number">10</span>),<span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 11, 24, 39, 56, 75, 96, 119, 144, 171]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x,y: x*y,<span class="built_in">range</span>(<span class="number">10</span>),<span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 11, 24, 39, 56, 75, 96, 119, 144, 171]</code></pre>
<p><code>filter</code></p>
<ul>
<li>takes a Boolean function</li>
<li>returns only elements that function is TRUE</li>
<li>2nd argument can be any iterator
<ul>
<li>generator</li>
<li>iterator</li>
<li>...</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span>(x%<span class="number">2</span>==<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># return x%2==0</span></span><br><span class="line"><span class="built_in">list</span>(<span class="built_in">filter</span>(is_even,<span class="built_in">range</span>(<span class="number">10</span>)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 2, 4, 6, 8]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">filter</span>(is_even,(x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)))) <span class="comment"># Filtering a generator</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 4, 16, 36, 64]</code></pre>
<h2 id="reduce"><code>Reduce</code></h2>
<ul>
<li>reduce an iterator to a single element</li>
<li><code>functools</code> contains a bunch of useful functional
programming functions, including reduce</li>
<li><code>functools.reduce</code></li>
<li>By initial an accumulator and repeatedly update the accumulator</li>
<li>If initial value is not supplied, Python will initializes the
accumulator as acc=f(x,y), where x and y are the first two elements of
the iterator.</li>
<li>of the iterator is length 1, it will return that element.</li>
<li>Best to specify the initial value</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="built_in">print</span>(functools.reduce(<span class="keyword">lambda</span> x,y: y/x, <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">4</span>),<span class="number">1</span>)) <span class="comment"># 1 is initial value</span></span><br><span class="line"><span class="built_in">print</span>(functools.reduce(<span class="keyword">lambda</span> x,y: x/y, <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">4</span>),<span class="number">1</span>)) <span class="comment"># 1 is initial value</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>1.5
0.16666666666666666</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span>([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]],[])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[1, 2, 3, 4, 5, 7, 8, 9]</code></pre>
<p>理解reduce的运算规则</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">elements = <span class="built_in">range</span>(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(reduce(<span class="keyword">lambda</span> accum,x:accum+<span class="number">1</span>,elements))</span><br><span class="line">elements = <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">100</span>))</span><br><span class="line"><span class="built_in">print</span>(reduce(<span class="keyword">lambda</span> accum,x:accum+<span class="number">1</span>,elements))</span><br><span class="line">elements = <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">100</span>))</span><br><span class="line"><span class="built_in">print</span>(reduce(<span class="keyword">lambda</span> accum,x:accum+<span class="number">1</span>,elements,<span class="number">0</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>99
198
100</code></pre>
<p>map is in parrallel</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">hp1 = <span class="built_in">open</span>(<span class="string">"2/hp1.txt"</span>,<span class="string">"rt"</span>)</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">line</span>):</span><br><span class="line">    words = line.strip().split(<span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">return</span> Counter(words)</span><br><span class="line"></span><br><span class="line">result = reduce(<span class="keyword">lambda</span> x,y: x+y,<span class="built_in">map</span>(mapper,hp1)) <span class="comment"># This method is really slow</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">c1 = Counter([<span class="string">"hello"</span>,<span class="string">'world'</span>])</span><br><span class="line">c2 = Counter([<span class="string">'hello'</span>,<span class="string">'Jun'</span>])</span><br><span class="line">c1,c2,c1+c2</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(Counter({'hello': 1, 'world': 1}),
 Counter({'hello': 1, 'Jun': 1}),
 Counter({'hello': 2, 'world': 1, 'Jun': 1}))</code></pre>
<h3 id="enron-e-mail-data">Enron e-mail data</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">!gzcat email-Enron.txt.gz | head</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'gzcat' �����ڲ����ⲿ���Ҳ���ǿ����еĳ���
���������ļ���</code></pre>
<p><code>gzip</code> 打开gz压缩文件</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enron</span>(<span class="params">limit=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">with</span> gzip.<span class="built_in">open</span>(<span class="string">"7/email-Enron.txt.gz"</span>,<span class="string">"rt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        lines = (line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> f <span class="keyword">if</span> <span class="keyword">not</span> line.startswith(<span class="string">"#"</span>))</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> itertools.islice(lines,limit)</span><br></pre></td></tr></tbody></table></figure>
<h4 id="who-sends-the-most-e-mail">Who sends the most e-mail</h4>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">line</span>):</span><br><span class="line">    <span class="keyword">return</span> Counter({<span class="built_in">int</span>(line.split(<span class="string">"\t"</span>)[<span class="number">0</span>]): <span class="number">1</span>})</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reducer</span>(<span class="params">accumulated, x</span>):</span><br><span class="line">    <span class="keyword">return</span> accumulated + x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">senders = reduce(reducer, <span class="built_in">map</span>(mapper, enron(<span class="number">10000</span>)))</span><br><span class="line">senders.most_common(<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(76, 815),
 (95, 597),
 (127, 481),
 (93, 455),
 (106, 422),
 (72, 377),
 (90, 366),
 (78, 339),
 (109, 339),
 (56, 309)]</code></pre>
<h2 id="set"><code>set()</code></h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = <span class="built_in">set</span>()</span><br><span class="line">x.add(<span class="number">1</span>)</span><br><span class="line">x.add(<span class="number">2</span>)</span><br><span class="line">x.add(<span class="number">1</span>)</span><br><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{1, 2}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = <span class="built_in">set</span>()</span><br><span class="line">x.add(<span class="built_in">frozenset</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line">x </span><br><span class="line"><span class="comment"># Error: x.add({1,2,3})</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>{frozenset({1, 2, 3})}</code></pre>
<h4 id="who-e-mailed-the-most-unique-people">Who e-mailed the most
unique people</h4>
<ul>
<li><code>set()</code></li>
<li>复杂的reduce例子</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">line</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line.split(<span class="string">"\t"</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reducer</span>(<span class="params">accumulated, x</span>):</span><br><span class="line">    sender, receiver = x</span><br><span class="line">    accumulated.setdefault(sender, <span class="built_in">set</span>())</span><br><span class="line">    accumulated[sender].add(receiver)</span><br><span class="line">    <span class="keyword">return</span> accumulated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unique_recipients = reduce(reducer, <span class="built_in">map</span>(mapper, enron(<span class="number">10000</span>)), {})</span><br></pre></td></tr></tbody></table></figure>
<p>This pattern emerges over and over in data analysis. So we'll stop
repeating ourselves and make a function:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">map_reduce</span>(<span class="params">iterable, mapper, reducer, reduce_init=<span class="literal">None</span></span>):</span><br><span class="line">    iter1 = <span class="built_in">map</span>(mapper, iterable)</span><br><span class="line">    iter2 = reduce(reducer, iter1, reduce_init)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(iter2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">email_score = map_reduce(enron(<span class="number">10000</span>), mapper, reducer, {})</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;IPython.core.display.Javascript object&gt;</code></pre>
<ul>
<li>create default value for dict</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">init = defaultdict(<span class="keyword">lambda</span>:<span class="number">0</span>)</span><br><span class="line">init</span><br></pre></td></tr></tbody></table></figure>
<pre><code>defaultdict(&lt;function __main__.&lt;lambda&gt;()&gt;, {})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">init[<span class="number">5</span>]+=<span class="number">1</span></span><br><span class="line">init</span><br></pre></td></tr></tbody></table></figure>
<pre><code>defaultdict(&lt;function __main__.&lt;lambda&gt;()&gt;, {5: 1})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">init = defaultdict(<span class="keyword">lambda</span>:<span class="number">0</span>)</span><br><span class="line">email_score = reduce(reducer,<span class="built_in">map</span>(mapper,enron(<span class="number">10</span>)),init)</span><br><span class="line">email_score</span><br></pre></td></tr></tbody></table></figure>
<pre><code>defaultdict(&lt;function __main__.&lt;lambda&gt;()&gt;,
            {0: {1}, 1: {0, 2, 3, 4, 5, 6, 7, 8, 9}})</code></pre>
<p>This is an example of where I would consider writing a class:</p>
<ul>
<li>只需要改变mapper和reducer，用函数overide的方式</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapReduce</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, iterable</span>):</span><br><span class="line">        self._iterable = iterable</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reducer</span>(<span class="params">self, accumulated, x</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> reduce(self.reducer, <span class="built_in">map</span>(self.mapper, self._iterable), self.reduce_init)</span><br></pre></td></tr></tbody></table></figure>
<p>Here is how we would use this class:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EmailScore</span>(<span class="title class_ inherited__">MapReduce</span>):</span><br><span class="line">    reduce_init = {}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">self, line</span>):</span><br><span class="line">        <span class="keyword">return</span> [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> line.strip().split(<span class="string">"\t"</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reducer</span>(<span class="params">self, accumulated, x</span>):</span><br><span class="line">        sender, receiver = x</span><br><span class="line">        key = <span class="built_in">tuple</span>(<span class="built_in">sorted</span>(x))</span><br><span class="line">        direction = <span class="number">1</span> <span class="keyword">if</span> key[<span class="number">0</span>] == sender <span class="keyword">else</span> -<span class="number">1</span></span><br><span class="line">        accumulated.setdefault(key, <span class="number">0</span>)</span><br><span class="line">        accumulated[key] += direction</span><br><span class="line">        <span class="keyword">return</span> accumulated</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">email_score = EmailScore(enron(<span class="number">10000</span>)).run()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="mapreduce-通用模板">Mapreduce 通用模板</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapReduce</span>:</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reduce_init</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># override as necessary if the init parameter needs to change</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mapper</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reducer</span>(<span class="params">self, accum, x</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">postprocess</span>(<span class="params">self, reduced</span>):</span><br><span class="line">        <span class="comment"># override if necessary</span></span><br><span class="line">        <span class="keyword">return</span> reduced</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, iterable</span>):</span><br><span class="line">        mapped = <span class="built_in">map</span>(self.mapper, iterable)</span><br><span class="line">        reduced = reduce(self.reducer, mapped, self.reduce_init)</span><br><span class="line">        processed = self.postprocess(reduced)</span><br><span class="line">        <span class="keyword">return</span> processed</span><br></pre></td></tr></tbody></table></figure>
<h3 id="tricks">Tricks</h3>
<ul>
<li>用于有些index为负数的情况</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">-<span class="number">1</span>%<span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>4</code></pre>
<ul>
<li>list中有if else的情况
<ul>
<li>and or</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">[i==<span class="number">2</span> <span class="keyword">and</span> <span class="string">"1"</span> <span class="keyword">or</span> <span class="string">"0"</span> <span class="keyword">for</span> i <span class="keyword">in</span> x]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['0', '1', '0', '0']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="string">"1"</span> <span class="keyword">if</span> i==<span class="number">2</span> <span class="keyword">else</span> <span class="string">"0"</span>  <span class="keyword">for</span> i <span class="keyword">in</span> x]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['0', '1', '0', '0']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pyspark</title>
    <url>/Pyspark/</url>
    <content><![CDATA[<h1 id="pyspark">Pyspark</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyspark</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> findspark</span><br><span class="line">findspark.init()</span><br><span class="line">sc = pyspark.SparkContext()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data=sc.textFile(<span class="string">'16\simple.txt'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.collect() <span class="comment"># form a list of data</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Raining cats and dogs',
 'Cats eat mice, mice eat cheese',
 'Mice and cats and dogs have fleas']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data = sc.textFile(<span class="string">'16\\numbers.txt'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data2 = data.<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data2.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[10, 23, 16, 7, 12, 0, 1, 1, 2, 3, 5, 8, -1, 42, 64, 101, -101, 3]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line">data2.reduce(add)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>196</code></pre>
<ul>
<li>map</li>
<li>filter</li>
<li>flatMap</li>
<li>sample</li>
<li>distinct</li>
<li>reduceByKey</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data = sc.textFile(<span class="string">'16\\numbers.txt'</span>).<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[10, 23, 16, 7, 12, 0, 1, 1, 2, 3, 5, 8, -1, 42, 64, 101, -101, 3]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x%<span class="number">2</span> == <span class="number">0</span>).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[10, 16, 12, 0, 2, 8, 42, 64]</code></pre>
<p>sample(withReplacement,fraction,[seed])</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.sample(<span class="literal">True</span>,<span class="number">0.3</span>).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[23, 23, 1, 1, 64]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.sample(<span class="literal">True</span>,<span class="number">0.3</span>,<span class="number">1</span>).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[23, 7, 0, -1, 64, 64, 101, 3]</code></pre>
<p>复杂的data：pickle module里面serializaiton</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data = sc.textFile(<span class="string">'16\\scientists.txt'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['John Bardeen 3.1 EE 1908',
 'Eugene Wigner 3.2 Physics 1902',
 'Albert Einstein 4.0 Physics 1879',
 'Ronald Fisher 3.25 Statistics 1890',
 'Emmy Noether 2.9 Physics 1882',
 'Leonard Euler 3.9 Mathematics 1707',
 'Jerzy Neyman 3.5 Statistics 1894',
 'Ky Fan 3.55 Mathematics 1914']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.<span class="built_in">map</span>(<span class="keyword">lambda</span> line: line.split()).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[['John', 'Bardeen', '3.1', 'EE', '1908'],
 ['Eugene', 'Wigner', '3.2', 'Physics', '1902'],
 ['Albert', 'Einstein', '4.0', 'Physics', '1879'],
 ['Ronald', 'Fisher', '3.25', 'Statistics', '1890'],
 ['Emmy', 'Noether', '2.9', 'Physics', '1882'],
 ['Leonard', 'Euler', '3.9', 'Mathematics', '1707'],
 ['Jerzy', 'Neyman', '3.5', 'Statistics', '1894'],
 ['Ky', 'Fan', '3.55', 'Mathematics', '1914']]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.<span class="built_in">map</span>(<span class="built_in">str</span>.split).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[['John', 'Bardeen', '3.1', 'EE', '1908'],
 ['Eugene', 'Wigner', '3.2', 'Physics', '1902'],
 ['Albert', 'Einstein', '4.0', 'Physics', '1879'],
 ['Ronald', 'Fisher', '3.25', 'Statistics', '1890'],
 ['Emmy', 'Noether', '2.9', 'Physics', '1882'],
 ['Leonard', 'Euler', '3.9', 'Mathematics', '1707'],
 ['Jerzy', 'Neyman', '3.5', 'Statistics', '1894'],
 ['Ky', 'Fan', '3.55', 'Mathematics', '1914']]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = data.<span class="built_in">map</span>(<span class="built_in">str</span>.split).<span class="built_in">map</span>(<span class="keyword">lambda</span> tup: (tup[<span class="number">0</span>]+<span class="string">' '</span>+tup[<span class="number">1</span>],<span class="built_in">float</span>(tup[<span class="number">2</span>]),<span class="built_in">int</span>(tup[<span class="number">4</span>])))</span><br><span class="line">d.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('John Bardeen', 3.1, 1908),
 ('Eugene Wigner', 3.2, 1902),
 ('Albert Einstein', 4.0, 1879),
 ('Ronald Fisher', 3.25, 1890),
 ('Emmy Noether', 2.9, 1882),
 ('Leonard Euler', 3.9, 1707),
 ('Jerzy Neyman', 3.5, 1894),
 ('Ky Fan', 3.55, 1914)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d.<span class="built_in">map</span>(<span class="keyword">lambda</span> tup: tup[<span class="number">1</span>]).mean()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3.425</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data = sc.textFile(<span class="string">'16/numbers_weird.txt'</span>)</span><br><span class="line">data.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['10 23 16', '7 12', '0', '1 1 2 3 5 8', '-1 42', '64 101 -101', '3']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.<span class="built_in">map</span>(<span class="built_in">str</span>.split).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[['10', '23', '16'],
 ['7', '12'],
 ['0'],
 ['1', '1', '2', '3', '5', '8'],
 ['-1', '42'],
 ['64', '101', '-101'],
 ['3']]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.flatMap(<span class="built_in">str</span>.split).collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['10',
 '23',
 '16',
 '7',
 '12',
 '0',
 '1',
 '1',
 '2',
 '3',
 '5',
 '8',
 '-1',
 '42',
 '64',
 '101',
 '-101',
 '3']</code></pre>
<ul>
<li>reduce</li>
<li>collect</li>
<li>count</li>
<li>countByKey</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data  =sc.textFile(<span class="string">'16/simple.txt'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.collect()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Raining cats and dogs',
 'Cats eat mice, mice eat cheese',
 'Mice and cats and dogs have fleas']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.flatMap(<span class="built_in">str</span>.split).<span class="built_in">map</span>(<span class="built_in">str</span>.lower).<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.replace(<span class="string">','</span>,<span class="string">''</span>)).<span class="built_in">map</span>(<span class="keyword">lambda</span> x: (x,<span class="number">1</span>)).countByKey()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>defaultdict(int,
            {'raining': 1,
             'cats': 3,
             'and': 3,
             'dogs': 2,
             'eat': 2,
             'mice': 3,
             'cheese': 1,
             'have': 1,
             'fleas': 1})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">data.flatMap(<span class="built_in">str</span>.split).<span class="built_in">map</span>(<span class="built_in">str</span>.lower).<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.replace(<span class="string">','</span>,<span class="string">''</span>)).countByKey()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>defaultdict(int,
            {'r': 1, 'c': 4, 'a': 3, 'd': 2, 'e': 2, 'm': 3, 'h': 1, 'f': 1})</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyspark</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">spark = pyspark.sql.SparkSession(sc)</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Programming in Python (2)</title>
    <url>/Programming-in-Python-2/</url>
    <content><![CDATA[<h1 id="numpy">Numpy</h1>
<ul>
<li>Built on Numpy:
<ul>
<li>SciPy</li>
<li>Pandas</li>
<li>matplotlib</li>
<li>Tensorflow</li>
<li>Scikit Learn</li>
<li>PyTorch</li>
<li>JAX</li>
</ul></li>
<li>Numpy quick start guide:
https://numpy.org/doc/stable/user/quickstart.html</li>
<li>closely related package <code>scipy</code> is for opimization</li>
<li>Basic numerical data types:
<ul>
<li>bool</li>
<li>int</li>
<li>uint</li>
<li>float</li>
<li>complex</li>
<li>https://docs.scipy.org/doc/numpy-1.10.1/user/basics.types.html</li>
</ul></li>
</ul>
<h2 id="numpy.array"><code>numpy.array</code></h2>
<ul>
<li>https://docs.scipy.org/doc/numpy-1.10.1/user/basics.creation.html</li>
<li>compared to list:
<ul>
<li>faster</li>
<li>operation easy</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],dtype=<span class="string">'uint'</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1, 2, 3], dtype=uint32)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.zeros((<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0., 0., 0.],
       [0., 0., 0.]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.arange(<span class="number">2</span>,<span class="number">3</span>,<span class="number">0.1</span>,dtype=<span class="string">'float'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([2. , 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9])</code></pre>
<p>小心大整数会导致数据溢出，不同机器结果不一样</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.arange(<span class="number">100_000_000</span>,dtype=<span class="string">'int64'</span>)</span><br><span class="line">np.<span class="built_in">sum</span>(a)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>4999999950000000</code></pre>
<p>empty 有时候会有随机结果，容易出错</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.empty((<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0., 0., 0.],
       [0., 0., 0.]])</code></pre>
<h2 id="arange"><code>arange()</code></h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.arange(<span class="number">27</span>).reshape(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[[ 0,  1,  2],
        [ 3,  4,  5],
        [ 6,  7,  8]],

       [[ 9, 10, 11],
        [12, 13, 14],
        [15, 16, 17]],

       [[18, 19, 20],
        [21, 22, 23],
        [24, 25, 26]]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">a = np.arange(<span class="number">27</span>).reshape(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">a[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.arange(<span class="number">5</span>,<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([5, 6, 7, 8, 9])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.arange(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0. , 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9])</code></pre>
<h2 id="array-indexing">array indexing</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x=np.arange(<span class="number">10</span>)</span><br><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[:-<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 1, 2, 3, 4, 5, 6, 7])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[<span class="number">1</span>:<span class="number">7</span>:<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1, 3, 5])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[::<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 2, 4, 6, 8])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = np.reshape(np.arange(<span class="number">1</span>,<span class="number">13</span>),(<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([5, 6, 7, 8])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[:,(<span class="number">1</span>,<span class="number">3</span>)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 2,  4],
       [ 6,  8],
       [10, 12]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[(<span class="number">0</span>,<span class="number">2</span>),(<span class="number">1</span>,<span class="number">3</span>)] <span class="comment"># 表示（0，1）和（2，3），第二项表示第几列，第一项表示第几行</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([ 2, 12])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[x&gt;<span class="number">7</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([ 8,  9, 10, 11, 12])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[(<span class="literal">True</span>,<span class="literal">False</span>,<span class="literal">False</span>)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([], shape=(0, 2, 5), dtype=int32)</code></pre>
<ul>
<li>index 组合可以用np.ix_</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">x[np.ix_([<span class="number">0</span>,<span class="number">2</span>],[<span class="number">0</span>,<span class="number">1</span>])]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[[0 1 2]
 [3 4 5]
 [6 7 8]]





array([[0, 1],
       [6, 7]])</code></pre>
<h3 id="example-minist">Example: minist</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">minist = np.load(<span class="string">'8/mnist.npz'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">minist[<span class="string">'images'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       ...,
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0],
       [0, 0, 0, ..., 0, 0, 0]], dtype=uint8)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(minist) <span class="comment"># get key</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>['images', 'labels']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">minist[<span class="string">'images'</span>].ndim</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">minist[<span class="string">'images'</span>].shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(60000, 784)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">img = minist[<span class="string">'images'</span>]</span><br><span class="line">img[<span class="number">0</span>].shape <span class="comment"># 一维</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>(784,)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">img_0 = img[<span class="number">0</span>].reshape(<span class="number">28</span>,<span class="number">28</span>)</span><br><span class="line"></span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.imshow(img_0,cmap=<span class="string">"Greys"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;matplotlib.image.AxesImage at 0x2d675185120&gt;</code></pre>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_35_1.png" alt="png"> ​</p>
<p>mnist中的数据按照uint8存储，所以加和是错误的</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.uint8(<span class="number">255</span>).astype(<span class="built_in">int</span>).dtype</span><br></pre></td></tr></tbody></table></figure>
<pre><code>dtype('int32')</code></pre>
<h2 id="numpyscipy-universal-functionsufuncs">numpy/scipy universal
functions(ufuncs)</h2>
<ul>
<li>support vectorized operations</li>
<li><code>np.min</code>快于<code>min</code>,<code>max</code></li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span>(img.reshape(<span class="built_in">len</span>(img),<span class="number">28</span>,<span class="number">28</span>)).shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(28, 28)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.mean(img)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>33.318421449829934</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">img.reshape(-<span class="number">1</span>).shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(47040000,)</code></pre>
<p>按照维度相加</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">plt.imshow(img[minist[<span class="string">'labels'</span>]==<span class="number">8</span>].mean(axis=<span class="number">0</span>).reshape(<span class="number">28</span>,<span class="number">28</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;matplotlib.image.AxesImage at 0x2d675301ab0&gt;</code></pre>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_43_1.png" alt="png"> ​</p>
<h2 id="numpy-example">Numpy example</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">salaries_full = pd.read_csv(</span><br><span class="line">    <span class="string">"9/salaries_clean.csv"</span>, encoding=<span class="string">"latin1"</span>, index_col=<span class="string">"salary_id"</span></span><br><span class="line">)</span><br><span class="line">columns = [</span><br><span class="line">    <span class="string">"location_latitude"</span>,</span><br><span class="line">    <span class="string">"location_longitude"</span>,</span><br><span class="line">    <span class="string">"total_experience_years"</span>,</span><br><span class="line">    <span class="string">"employer_experience_years"</span>,</span><br><span class="line">    <span class="string">"annual_base_pay"</span>,</span><br><span class="line">    <span class="string">"signing_bonus"</span>,</span><br><span class="line">]</span><br><span class="line">salary_data = salaries_full[columns].to_numpy()</span><br><span class="line">salary_data</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 3.7770e+01, -1.2241e+02,  1.3000e+01,  2.0000e+00,  1.2500e+05,
         5.0000e+03],
       [ 3.6360e+01, -9.4200e+01,  1.5000e+01,  8.0000e+00,  6.5000e+04,
                nan],
       [ 4.1470e+01, -8.1670e+01,  4.0000e+00,  1.0000e+00,  8.6000e+04,
         5.0000e+03],
       ...,
       [        nan,         nan,  7.0000e+00,  1.0000e+00,  1.5000e+05,
         0.0000e+00],
       [ 3.8990e+01, -7.6930e+01,  5.0000e+00,  1.0000e+00,  7.5000e+04,
                nan],
       [        nan,         nan,  2.0000e+00,  0.0000e+00,  5.0000e+01,
         0.0000e+00]])</code></pre>
<p>Numpy indexing conventirons:</p>
<ul>
<li>outermost,innermost</li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data[:,<span class="number">0</span>].shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1655,)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">col = np.array(columns)</span><br><span class="line">col==<span class="string">'annual_base_pay'</span></span><br><span class="line">annual_base_pay = salary_data[:,col==<span class="string">'annual_base_pay'</span>] </span><br><span class="line">np.mean(annual_base_pay)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>nan</code></pre>
<ul>
<li>index 可以boolean</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.nanmean(annual_base_pay)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>6325003.746965475</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.isnan(annual_base_pay)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[False],
       [False],
       [False],
       ...,
       [False],
       [False],
       [False]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">annual_base_pay.reshape(-<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1.25e+05, 6.50e+04, 8.60e+04, ..., 1.50e+05, 7.50e+04, 5.00e+01])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">annual_base_pay[np.isnan(annual_base_pay)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([nan, nan, nan, nan])</code></pre>
<ul>
<li>取反</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">~np.isnan(annual_base_pay)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ True],
       [ True],
       [ True],
       ...,
       [ True],
       [ True],
       [ True]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.<span class="built_in">all</span>(~np.isnan(salary_data),axis=<span class="number">1</span>)</span><br><span class="line">np.<span class="built_in">any</span>(np.isnan(salary_data),axis=<span class="number">1</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([False,  True, False, ...,  True,  True,  True])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data[~np.<span class="built_in">any</span>(np.isnan(salary_data),axis=<span class="number">1</span>)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 3.7770e+01, -1.2241e+02,  1.3000e+01,  2.0000e+00,  1.2500e+05,
         5.0000e+03],
       [ 4.1470e+01, -8.1670e+01,  4.0000e+00,  1.0000e+00,  8.6000e+04,
         5.0000e+03],
       [ 3.8000e+01, -9.7000e+01,  5.0000e+00,  1.5000e+00,  4.0000e+04,
         0.0000e+00],
       ...,
       [ 4.0030e+01, -7.5630e+01,  2.0000e+00,  1.0000e+00,  6.0000e+04,
         0.0000e+00],
       [ 3.9950e+01, -7.5160e+01,  6.0000e+00,  2.5000e+00,  1.1100e+05,
         5.0000e+03],
       [ 4.0020e+01, -1.0525e+02,  1.0000e+00,  5.0000e-01,  6.0500e+04,
         0.0000e+00]])</code></pre>
<ul>
<li>last 2 rows</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data[-<span class="number">2</span>:]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 3.899e+01, -7.693e+01,  5.000e+00,  1.000e+00,  7.500e+04,
               nan],
       [       nan,        nan,  2.000e+00,  0.000e+00,  5.000e+01,
         0.000e+00]])</code></pre>
<ul>
<li>list 是行的index</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[ 3.636e+01, -9.420e+01,  1.500e+01,  8.000e+00,  6.500e+04,
               nan],
       [ 4.147e+01, -8.167e+01,  4.000e+00,  1.000e+00,  8.600e+04,
         5.000e+03],
       [       nan,        nan,  4.000e+00,  0.000e+00,  1.050e+05,
         5.000e+03]])</code></pre>
<ul>
<li>tuple 是坐标</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># salary_data[(1,2,3)] # Error: () 代表坐标</span></span><br><span class="line">salary_data[(<span class="number">1</span>,<span class="number">2</span>)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>15.0</code></pre>
<p>Normalizing Data</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">col_mean = np.nanmean(salary_data,axis=<span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([ 3.77543939e+01, -6.47122727e+01,  6.75611318e+00,  2.65616294e+00,
        6.32500375e+06,  2.24056269e+04])</code></pre>
<ul>
<li>Broad casting</li>
</ul>
<p>Note: 如果矩阵很大，可能会溢出，这样就得用for loop来写</p>
<p>Broad cast的矩阵，要么某些维度数量match，要么就是1或没有</p>
<ul>
<li><span class="math inline">\(5\times4\)</span> ; 1</li>
<li><span class="math inline">\(5\times4\)</span> ; 4</li>
<li>但是<span class="math inline">\(5\times4\)</span>如果要每行减去一列数字，不能是一个长度为5的array，因为匹配的是innermost
index，应该reshape(1,5) 或者
<code>[:,None]</code>即最后加一个维度=1</li>
<li></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data.mean(<span class="number">1</span>)</span><br><span class="line">salary_data.mean(axis=<span class="number">1</span>) <span class="comment"># mean of each row</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([21655.06,      nan, 15160.8 , ...,      nan,      nan,      nan])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">row_mu = salary_data.mean(axis=<span class="number">1</span>)</span><br><span class="line">row_mu.shape,row_mu[:,<span class="literal">None</span>].shape,row_mu[:,<span class="literal">None</span>,<span class="literal">None</span>].shape</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>((1655,), (1655, 1), (1655, 1, 1))</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data-row_mu[:,<span class="literal">None</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[-21617.29, -21777.47, -21642.06, -21653.06, 103344.94, -16655.06],
       [      nan,       nan,       nan,       nan,       nan,       nan],
       [-15119.33, -15242.47, -15156.8 , -15159.8 ,  70839.2 , -10160.8 ],
       ...,
       [      nan,       nan,       nan,       nan,       nan,       nan],
       [      nan,       nan,       nan,       nan,       nan,       nan],
       [      nan,       nan,       nan,       nan,       nan,       nan]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.array(<span class="number">1</span>).shape,np.array(<span class="number">1</span>)[<span class="literal">None</span>].shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>((), (1,))</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">row_mu = salary_data.mean(axis=<span class="number">1</span>,keepdims=<span class="literal">True</span>)</span><br><span class="line">row_mu.shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1655, 1)</code></pre>
<ul>
<li>Reductions and <code>axis=</code>
<ul>
<li>that axis will disapear</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">salary_data.mean(axis=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([21655.06,      nan, 15160.8 , ...,      nan,      nan,      nan])</code></pre>
<p><code>for</code> loops too slow</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">prices = np.array([<span class="number">20</span>,<span class="number">18</span>,<span class="number">21</span>,<span class="number">14</span>])</span><br><span class="line">prices - np.minimum.accumulate(prices)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 0, 3, 0])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">n = <span class="number">10</span></span><br><span class="line">p = <span class="number">2</span></span><br><span class="line">k = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">x = np.random.rand(n,p)</span><br><span class="line">c = np.random.rand(k,p)</span><br><span class="line">x.shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(10, 2)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0.57019677, 0.43860151],
       [0.98837384, 0.10204481],
       [0.20887676, 0.16130952],
       [0.65310833, 0.2532916 ],
       [0.46631077, 0.24442559],
       [0.15896958, 0.11037514],
       [0.65632959, 0.13818295],
       [0.19658236, 0.36872517],
       [0.82099323, 0.09710128],
       [0.83794491, 0.09609841]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.rand(<span class="number">10</span>,<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0.58651293, 0.02010755],
       [0.82894003, 0.00469548],
       [0.67781654, 0.27000797],
       [0.73519402, 0.96218855],
       [0.24875314, 0.57615733],
       [0.59204193, 0.57225191],
       [0.22308163, 0.95274901],
       [0.44712538, 0.84640867],
       [0.69947928, 0.29743695],
       [0.81379782, 0.39650574]])</code></pre>
<ul>
<li>(n,1,p)-(1,k,p)是一个(n,k,p)的array</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">D = x[:,<span class="literal">None</span>,:]-c[<span class="literal">None</span>,:]</span><br><span class="line">D[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[-0.40626269, -0.03004969],
       [-0.40656432, -0.16624401],
       [-0.16906681,  0.39941372]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">D.shape</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(10, 3, 2)</code></pre>
<ul>
<li>第三个维度被reduction</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x_c_norm = np.linalg.norm(D,axis=<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.argmin(x_c_norm,axis=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 2, 2, 2, 2, 2, 2, 2, 2, 2], dtype=int64)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">k=<span class="number">3</span></span><br><span class="line">a= np.array([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">ans = a[:,<span class="literal">None</span>]+a[<span class="literal">None</span>,:]</span><br><span class="line">ans[:<span class="built_in">len</span>(a)-k+<span class="number">1</span>,:k]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0, 1, 2],
       [1, 2, 3],
       [2, 3, 4],
       [3, 4, 5]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">10</span>)</span><br><span class="line">x[np.logical_and(x&gt;<span class="number">3</span>,x&lt;<span class="number">7</span>)]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([4, 5, 6])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x[np.logical_or(x&gt;<span class="number">3</span>,x&lt;<span class="number">7</span>)]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.random((<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0.8754406 , 0.31234192, 0.21472602],
       [0.1417056 , 0.6179606 , 0.0532995 ]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.normal(<span class="number">0</span>,<span class="number">1</span>,<span class="number">20</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([ 1.36952814,  0.39363222,  0.48644709, -0.23743297,  0.21279548,
       -0.5515374 , -2.22034906, -1.41651274,  0.08532262,  0.49804278,
       -2.03253663,  0.66368554,  0.28155033,  0.94521731,  0.5938768 ,
       -1.57368613, -1.55284648,  0.54146951, -0.75257585, -0.23976487])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.uniform(<span class="number">0</span>,<span class="number">1</span>,(<span class="number">2</span>,<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0.5909873 , 0.8235658 , 0.14703172, 0.94326283],
       [0.79080321, 0.34115745, 0.75083531, 0.31725324]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x=np.arange(<span class="number">1</span>,<span class="number">11</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(np.random.choice(x,<span class="number">5</span>,<span class="literal">False</span>,x/<span class="built_in">float</span>(<span class="built_in">sum</span>(x))))</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[ 6 10  7  9  5]
[ 9  8 10  7  6]
[ 2  8  9 10  5]
[10  9  8  3  6]
[7 8 6 5 9]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x = np.arange(<span class="number">10</span>)</span><br><span class="line">np.random.shuffle(x)</span><br><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1, 7, 4, 0, 8, 3, 5, 2, 6, 9])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.permutation(x) <span class="comment">#x not change</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1, 9, 5, 7, 3, 4, 2, 0, 6, 8])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">x</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([1, 7, 4, 0, 8, 3, 5, 2, 6, 9])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.sort(x)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</code></pre>
<h1 id="pandas">Pandas</h1>
<h2 id="basic-structures">basic structures</h2>
<ul>
<li>Series
<ul>
<li>One dimensional labeled array</li>
</ul></li>
<li>DataFrame
<ul>
<li>tabel of rows, with labeled columns</li>
<li></li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a= np.array([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">(a[:,<span class="literal">None</span>]+a[<span class="literal">None</span>,:])[:<span class="number">4</span>,:<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([[0, 1, 2],
       [1, 2, 3],
       [2, 3, 4],
       [3, 4, 5]])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">flight = pd.read_csv(<span class="string">"10/flights.csv.gz"</span>)</span><br></pre></td></tr></tbody></table></figure>
<h2 id="series"><code>Series</code></h2>
<ul>
<li>can create a pandas series from any array-like structure(dict,numpy
array,list)</li>
<li>和numpy不同的是：有label
<ul>
<li>可以自己改label</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">numbers = np.random.randn(<span class="number">5</span>)</span><br><span class="line">s = pd.Series(numbers)</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0    1.556860
1    0.187127
2   -0.245997
3    1.342677
4   -0.117419
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">idx = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>]</span><br><span class="line">s = pd.Series(numbers,index=idx)</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    1.556860
b    0.187127
c   -0.245997
d    1.342677
e   -0.117419
dtype: float64</code></pre>
<blockquote>
<p>providing too few or too many indices is a ValueError</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">pd.Series(np.random.rand(<span class="number">5</span>),index=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    0.996875
b    0.893754
c    0.925473
d    0.853753
e    0.500225
dtype: float64</code></pre>
<blockquote>
<p>can create a Series from a dict</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="string">"dog"</span>:<span class="number">1</span>,<span class="string">"cat"</span>:<span class="number">2</span>}</span><br><span class="line">pd.Series(d)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>dog    1
cat    2
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">pd.Series(d,index=[<span class="string">"dog"</span>,<span class="string">"cat"</span>,<span class="string">"pig"</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>dog    1.0
cat    2.0
pig    NaN
dtype: float64</code></pre>
<p>字典里没有pig，所以这里赋值给pig：NaN</p>
<p>inf==inf+X</p>
<p>np.nan不等于np.nan</p>
<p>用np.isnan()判断</p>
<p>或者用变量不等于自身判断nan，这是一个变量不等于自身的特例</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1.5568595147700188</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[-<span class="number">1</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>-0.11741940757185318</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[:<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    1.556860
b    0.187127
c   -0.245997
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="string">'a'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1.5568595147700188</code></pre>
<blockquote>
<p>这里需要注意的是：用:以及index名字分割数组时，:后面的也会包含进去。但是数字不会,哪怕索引名字是数字。</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="string">'a'</span>:<span class="string">'c'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    1.556860
b    0.187127
c   -0.245997
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="number">0</span>:<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    1.556860
b    0.187127
c   -0.245997
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.exp(s[:<span class="number">3</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    4.743900
b    1.205781
c    0.781924
dtype: float64</code></pre>
<ul>
<li>indices need not be unique</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = pd.Series([<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>],index=[<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'a'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a     2
a     3
a     5
c     7
d    11
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="string">'a'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    2
a    3
a    5
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="string">'a'</span>:<span class="string">'c'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    2
a    3
a    5
c    7
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="number">0</span>:<span class="number">3</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    2
a    3
a    5
dtype: int64</code></pre>
<blockquote>
<p>和np一样，可以用boolean series索引</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[s&gt;<span class="number">5</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>c     7
d    11
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s&gt;<span class="number">5</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    False
a    False
a    False
c     True
d     True
dtype: bool</code></pre>
<p>Series objects are dict-like, in that we can access and update
entries via their keys.</p>
<p>Like dictionary, accessing a non-existent key is a KeyError.</p>
<p>Series also support <code>in</code> operator.</p>
<p>also support <code>get</code> method in dictionary</p>
<p>entries in Series can be mix type, but no sequence</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s.name = <span class="string">"random int"</span></span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a     2
a     3
a     5
c     7
d    11
Name: random int, dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = pd.Series([<span class="string">'dog'</span>,<span class="string">'fish'</span>,<span class="string">'elephant'</span>])</span><br><span class="line">s.<span class="built_in">map</span>(<span class="keyword">lambda</span> s:<span class="built_in">len</span>(s))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0    3
1    4
2    8
dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s.<span class="built_in">map</span>(<span class="built_in">len</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0    3
1    4
2    8
dtype: int64</code></pre>
<blockquote>
<p><code>map</code> in Series allows to change values based on another
Series.</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = pd.Series([<span class="string">'fruit'</span>,<span class="string">'animal'</span>,<span class="string">'animal'</span>,<span class="string">'fruit'</span>,<span class="string">'fruit'</span>],index=[<span class="string">'apple'</span>,<span class="string">'cat'</span>,<span class="string">'goat'</span>,<span class="string">'banana'</span>,<span class="string">'kiwi'</span>])</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>apple      fruit
cat       animal
goat      animal
banana     fruit
kiwi       fruit
dtype: object</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">t = pd.Series({<span class="string">'fruit'</span>:<span class="number">0</span>,<span class="string">'animal'</span>:<span class="number">1</span>})</span><br><span class="line">s.<span class="built_in">map</span>(t)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>apple     0
cat       1
goat      1
banana    0
kiwi      0
dtype: int64</code></pre>
<h2 id="dataframe">DataFrame</h2>
<ul>
<li>each column can have its own index. DataFrame will have all the
index. 缺失值NaN</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">d = {<span class="string">'A'</span>:pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],index={<span class="string">'cat'</span>,<span class="string">'dog'</span>,<span class="string">'bird'</span>}),<span class="string">'B'</span>:{<span class="string">'dog'</span>:<span class="number">1</span>,<span class="string">'cat'</span>:<span class="number">2</span>,<span class="string">'bird'</span>:<span class="number">3</span>,<span class="string">'goat'</span>:<span class="number">4</span>}}</span><br><span class="line">df = pd.DataFrame(d)</span><br><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
2.0
</td>
<td>
3
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1.0
</td>
<td>
1
</td>
</tr>
<tr>
<th>
goat
</th>
<td>
NaN
</td>
<td>
4
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df[<span class="string">'A'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>bird    2.0
cat     3.0
dog     1.0
goat    NaN
Name: A, dtype: float64</code></pre>
<p>By default: rows and columns are ordered alphabetically</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.columns</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Index(['A', 'B'], dtype='object')</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.index</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Index(['bird', 'cat', 'dog', 'goat'], dtype='object')</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df[<span class="string">'C'</span>]=df[<span class="string">'A'</span>]*<span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
2.0
</td>
<td>
3
</td>
<td>
4.0
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
<td>
6.0
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1.0
</td>
<td>
1
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
goat
</th>
<td>
NaN
</td>
<td>
4
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight[<span class="string">'max_delay'</span>]=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">max</span>,flight[<span class="string">'arr_delay'</span>],flight[<span class="string">'dep_delay'</span>]))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">v = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">np.maximum(v,v*<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>array([ 2,  4,  6,  8, 10])</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.<span class="built_in">max</span>(v)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>5</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight[<span class="string">'max_delay'</span>] = np.maximum(flight[<span class="string">'arr_delay'</span>],flight[<span class="string">'dep_delay'</span>])</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight[<span class="string">'num'</span>]=<span class="number">0</span> <span class="comment"># Broadcast</span></span><br><span class="line">flight[<span class="string">'num'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0         0
1         0
2         0
3         0
4         0
         ..
336771    0
336772    0
336773    0
336774    0
336775    0
Name: num, Length: 336776, dtype: int64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">del</span> flight[<span class="string">'num'</span>]</span><br><span class="line">flight.columns</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Index(['year', 'month', 'day', 'dep_time', 'sched_dep_time', 'dep_delay',
       'arr_time', 'sched_arr_time', 'arr_delay', 'carrier', 'flight',
       'tailnum', 'origin', 'dest', 'air_time', 'distance', 'hour', 'minute',
       'time_hour', 'max_delay'],
      dtype='object')</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.loc[<span class="string">'cat'</span>] <span class="comment"># select rows by labels</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>A    3.0
B    2.0
Name: cat, dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.iloc[<span class="number">1</span>] <span class="comment"># select rows by their integer labels(starting from 0)</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>A    3.0
B    2.0
Name: cat, dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df[<span class="number">1</span>:<span class="number">3</span>] <span class="comment"># rows</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1.0
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df[df[<span class="string">'A'</span>]&gt;<span class="number">2</span>]</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.iloc[:<span class="number">2</span>,:<span class="number">1</span>] <span class="comment"># 这里无法去掉iloc</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
2.0
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.loc[<span class="string">'cat'</span>:<span class="string">'dog'</span>,<span class="string">'A'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>cat    3.0
dog    1.0
Name: A, dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1 = pd.DataFrame(np.random.randn(<span class="number">8</span>,<span class="number">4</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</span><br><span class="line">df2 = pd.DataFrame(np.random.randn(<span class="number">5</span>,<span class="number">3</span>),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</span><br><span class="line">df1+df2</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
<th>
d
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0.150499
</td>
<td>
-0.084967
</td>
<td>
-1.304810
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
1
</th>
<td>
-1.723753
</td>
<td>
0.809527
</td>
<td>
-3.027434
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
2
</th>
<td>
-1.770957
</td>
<td>
-1.115960
</td>
<td>
-0.606153
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
3
</th>
<td>
-1.322787
</td>
<td>
-0.154228
</td>
<td>
0.316819
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0.357720
</td>
<td>
2.129364
</td>
<td>
2.252070
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
5
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
6
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
7
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df2-df2.iloc[<span class="number">0</span>] <span class="comment"># Broadcast</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0.000000
</td>
<td>
0.000000
</td>
<td>
0.000000
</td>
</tr>
<tr>
<th>
1
</th>
<td>
-0.406540
</td>
<td>
-0.015429
</td>
<td>
-0.683493
</td>
</tr>
<tr>
<th>
2
</th>
<td>
-0.095646
</td>
<td>
-1.092577
</td>
<td>
1.542312
</td>
</tr>
<tr>
<th>
3
</th>
<td>
-0.462943
</td>
<td>
-0.349725
</td>
<td>
1.856521
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0.749604
</td>
<td>
1.157111
</td>
<td>
1.999972
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">(df1&gt;<span class="number">0.5</span>).<span class="built_in">any</span>()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    True
b    True
c    True
d    True
dtype: bool</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">(df1&gt;<span class="number">0.5</span>).<span class="built_in">all</span>()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    False
b    False
c    False
d    False
dtype: bool</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.T*df1.T</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
0
</th>
<th>
1
</th>
<th>
2
</th>
<th>
3
</th>
<th>
4
</th>
<th>
5
</th>
<th>
6
</th>
<th>
7
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
a
</th>
<td>
0.039975
</td>
<td>
1.607250
</td>
<td>
2.643456
</td>
<td>
0.656756
</td>
<td>
0.117268
</td>
<td>
0.264463
</td>
<td>
0.471706
</td>
<td>
1.462087
</td>
</tr>
<tr>
<th>
b
</th>
<td>
0.012506
</td>
<td>
0.636951
</td>
<td>
0.002525
</td>
<td>
0.028437
</td>
<td>
0.893762
</td>
<td>
2.970262
</td>
<td>
0.084393
</td>
<td>
3.932983
</td>
</tr>
<tr>
<th>
c
</th>
<td>
0.002420
</td>
<td>
1.184460
</td>
<td>
0.797188
</td>
<td>
0.080707
</td>
<td>
2.273190
</td>
<td>
0.834139
</td>
<td>
2.697453
</td>
<td>
0.488765
</td>
</tr>
<tr>
<th>
d
</th>
<td>
0.650234
</td>
<td>
0.199167
</td>
<td>
0.196074
</td>
<td>
0.403005
</td>
<td>
0.352569
</td>
<td>
1.245693
</td>
<td>
0.628392
</td>
<td>
0.021431
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.T.dot(df1) <span class="comment"># numpy-like</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
<th>
d
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
a
</th>
<td>
7.262961
</td>
<td>
-4.896682
</td>
<td>
2.348484
</td>
<td>
-2.077213
</td>
</tr>
<tr>
<th>
b
</th>
<td>
-4.896682
</td>
<td>
8.561819
</td>
<td>
3.042636
</td>
<td>
2.741910
</td>
</tr>
<tr>
<th>
c
</th>
<td>
2.348484
</td>
<td>
3.042636
</td>
<td>
8.358324
</td>
<td>
-0.150733
</td>
</tr>
<tr>
<th>
d
</th>
<td>
-2.077213
</td>
<td>
2.741910
</td>
<td>
-0.150733
</td>
<td>
3.696565
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.T@df1</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
a
</th>
<th>
b
</th>
<th>
c
</th>
<th>
d
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
a
</th>
<td>
7.262961
</td>
<td>
-4.896682
</td>
<td>
2.348484
</td>
<td>
-2.077213
</td>
</tr>
<tr>
<th>
b
</th>
<td>
-4.896682
</td>
<td>
8.561819
</td>
<td>
3.042636
</td>
<td>
2.741910
</td>
</tr>
<tr>
<th>
c
</th>
<td>
2.348484
</td>
<td>
3.042636
</td>
<td>
8.358324
</td>
<td>
-0.150733
</td>
</tr>
<tr>
<th>
d
</th>
<td>
-2.077213
</td>
<td>
2.741910
</td>
<td>
-0.150733
</td>
<td>
3.696565
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.dropna(axis=<span class="number">1</span>,how=<span class="string">'any'</span>) <span class="comment"># drop columns</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
3
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
2
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1
</td>
</tr>
<tr>
<th>
goat
</th>
<td>
4
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.dropna() <span class="comment"># drop rows</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
2.0
</td>
<td>
3
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1.0
</td>
<td>
1
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.dropna(axis=<span class="number">1</span>,how=<span class="string">"all"</span>) <span class="comment"># drop columns with all missing data</span></span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
bird
</th>
<td>
2.0
</td>
<td>
3
</td>
</tr>
<tr>
<th>
cat
</th>
<td>
3.0
</td>
<td>
2
</td>
</tr>
<tr>
<th>
dog
</th>
<td>
1.0
</td>
<td>
1
</td>
</tr>
<tr>
<th>
goat
</th>
<td>
NaN
</td>
<td>
4
</td>
</tr>
</tbody>
</table>
</div>
<p>pandas supports read/write for a wide range of different file
format</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight.info()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 336776 entries, 0 to 336775
Data columns (total 20 columns):
 #   Column          Non-Null Count   Dtype  
---  ------          --------------   -----  
 0   year            336776 non-null  int64  
 1   month           336776 non-null  int64  
 2   day             336776 non-null  int64  
 3   dep_time        328521 non-null  float64
 4   sched_dep_time  336776 non-null  int64  
 5   dep_delay       328521 non-null  float64
 6   arr_time        328063 non-null  float64
 7   sched_arr_time  336776 non-null  int64  
 8   arr_delay       327346 non-null  float64
 9   carrier         336776 non-null  object 
 10  flight          336776 non-null  int64  
 11  tailnum         334264 non-null  object 
 12  origin          336776 non-null  object 
 13  dest            336776 non-null  object 
 14  air_time        327346 non-null  float64
 15  distance        336776 non-null  int64  
 16  hour            336776 non-null  int64  
 17  minute          336776 non-null  int64  
 18  time_hour       336776 non-null  object 
 19  max_delay       327346 non-null  float64
dtypes: float64(6), int64(9), object(5)
memory usage: 51.4+ MB</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight.head()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
year
</th>
<th>
month
</th>
<th>
day
</th>
<th>
dep_time
</th>
<th>
sched_dep_time
</th>
<th>
dep_delay
</th>
<th>
arr_time
</th>
<th>
sched_arr_time
</th>
<th>
arr_delay
</th>
<th>
carrier
</th>
<th>
flight
</th>
<th>
tailnum
</th>
<th>
origin
</th>
<th>
dest
</th>
<th>
air_time
</th>
<th>
distance
</th>
<th>
hour
</th>
<th>
minute
</th>
<th>
time_hour
</th>
<th>
max_delay
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
517.0
</td>
<td>
515
</td>
<td>
2.0
</td>
<td>
830.0
</td>
<td>
819
</td>
<td>
11.0
</td>
<td>
UA
</td>
<td>
1545
</td>
<td>
N14228
</td>
<td>
EWR
</td>
<td>
IAH
</td>
<td>
227.0
</td>
<td>
1400
</td>
<td>
5
</td>
<td>
15
</td>
<td>
2013-01-01T10:00:00Z
</td>
<td>
11.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
533.0
</td>
<td>
529
</td>
<td>
4.0
</td>
<td>
850.0
</td>
<td>
830
</td>
<td>
20.0
</td>
<td>
UA
</td>
<td>
1714
</td>
<td>
N24211
</td>
<td>
LGA
</td>
<td>
IAH
</td>
<td>
227.0
</td>
<td>
1416
</td>
<td>
5
</td>
<td>
29
</td>
<td>
2013-01-01T10:00:00Z
</td>
<td>
20.0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
542.0
</td>
<td>
540
</td>
<td>
2.0
</td>
<td>
923.0
</td>
<td>
850
</td>
<td>
33.0
</td>
<td>
AA
</td>
<td>
1141
</td>
<td>
N619AA
</td>
<td>
JFK
</td>
<td>
MIA
</td>
<td>
160.0
</td>
<td>
1089
</td>
<td>
5
</td>
<td>
40
</td>
<td>
2013-01-01T10:00:00Z
</td>
<td>
33.0
</td>
</tr>
<tr>
<th>
3
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
544.0
</td>
<td>
545
</td>
<td>
-1.0
</td>
<td>
1004.0
</td>
<td>
1022
</td>
<td>
-18.0
</td>
<td>
B6
</td>
<td>
725
</td>
<td>
N804JB
</td>
<td>
JFK
</td>
<td>
BQN
</td>
<td>
183.0
</td>
<td>
1576
</td>
<td>
5
</td>
<td>
45
</td>
<td>
2013-01-01T10:00:00Z
</td>
<td>
-1.0
</td>
</tr>
<tr>
<th>
4
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
554.0
</td>
<td>
600
</td>
<td>
-6.0
</td>
<td>
812.0
</td>
<td>
837
</td>
<td>
-25.0
</td>
<td>
DL
</td>
<td>
461
</td>
<td>
N668DN
</td>
<td>
LGA
</td>
<td>
ATL
</td>
<td>
116.0
</td>
<td>
762
</td>
<td>
6
</td>
<td>
0
</td>
<td>
2013-01-01T11:00:00Z
</td>
<td>
-6.0
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight.tail()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
year
</th>
<th>
month
</th>
<th>
day
</th>
<th>
dep_time
</th>
<th>
sched_dep_time
</th>
<th>
dep_delay
</th>
<th>
arr_time
</th>
<th>
sched_arr_time
</th>
<th>
arr_delay
</th>
<th>
carrier
</th>
<th>
flight
</th>
<th>
tailnum
</th>
<th>
origin
</th>
<th>
dest
</th>
<th>
air_time
</th>
<th>
distance
</th>
<th>
hour
</th>
<th>
minute
</th>
<th>
time_hour
</th>
<th>
max_delay
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
336771
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
NaN
</td>
<td>
1455
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
1634
</td>
<td>
NaN
</td>
<td>
9E
</td>
<td>
3393
</td>
<td>
NaN
</td>
<td>
JFK
</td>
<td>
DCA
</td>
<td>
NaN
</td>
<td>
213
</td>
<td>
14
</td>
<td>
55
</td>
<td>
2013-09-30T18:00:00Z
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
336772
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
NaN
</td>
<td>
2200
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
2312
</td>
<td>
NaN
</td>
<td>
9E
</td>
<td>
3525
</td>
<td>
NaN
</td>
<td>
LGA
</td>
<td>
SYR
</td>
<td>
NaN
</td>
<td>
198
</td>
<td>
22
</td>
<td>
0
</td>
<td>
2013-10-01T02:00:00Z
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
336773
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
NaN
</td>
<td>
1210
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
1330
</td>
<td>
NaN
</td>
<td>
MQ
</td>
<td>
3461
</td>
<td>
N535MQ
</td>
<td>
LGA
</td>
<td>
BNA
</td>
<td>
NaN
</td>
<td>
764
</td>
<td>
12
</td>
<td>
10
</td>
<td>
2013-09-30T16:00:00Z
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
336774
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
NaN
</td>
<td>
1159
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
1344
</td>
<td>
NaN
</td>
<td>
MQ
</td>
<td>
3572
</td>
<td>
N511MQ
</td>
<td>
LGA
</td>
<td>
CLE
</td>
<td>
NaN
</td>
<td>
419
</td>
<td>
11
</td>
<td>
59
</td>
<td>
2013-09-30T15:00:00Z
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
336775
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
NaN
</td>
<td>
840
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
1020
</td>
<td>
NaN
</td>
<td>
MQ
</td>
<td>
3531
</td>
<td>
N839MQ
</td>
<td>
LGA
</td>
<td>
RDU
</td>
<td>
NaN
</td>
<td>
431
</td>
<td>
8
</td>
<td>
40
</td>
<td>
2013-09-30T12:00:00Z
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1 = df*<span class="number">2</span></span><br><span class="line">df2 = df+df</span><br><span class="line">(df1==df2).<span class="built_in">all</span>() <span class="comment"># 有NaN，判断相等时要小心</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>A    False
B     True
dtype: bool</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.nan==np.nan</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.equals(df2)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.mean(<span class="number">0</span>) <span class="comment"># mean of colums</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>A    4.0
B    5.0
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df1.mean(<span class="number">1</span>) <span class="comment"># mean of rows</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>bird    5.0
cat     5.0
dog     2.0
goat    8.0
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.mean(df1) <span class="comment"># skip na, 也可以设置skipna=False</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>A    4.0
B    5.0
dtype: float64</code></pre>
<blockquote>
<p>np.mean作用于dataframe时，自动跳过nan，但是on np.array时，返回nan</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight.describe()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
year
</th>
<th>
month
</th>
<th>
day
</th>
<th>
dep_time
</th>
<th>
sched_dep_time
</th>
<th>
dep_delay
</th>
<th>
arr_time
</th>
<th>
sched_arr_time
</th>
<th>
arr_delay
</th>
<th>
flight
</th>
<th>
air_time
</th>
<th>
distance
</th>
<th>
hour
</th>
<th>
minute
</th>
<th>
max_delay
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
count
</th>
<td>
336776.0
</td>
<td>
336776.000000
</td>
<td>
336776.000000
</td>
<td>
328521.000000
</td>
<td>
336776.000000
</td>
<td>
328521.000000
</td>
<td>
328063.000000
</td>
<td>
336776.000000
</td>
<td>
327346.000000
</td>
<td>
336776.000000
</td>
<td>
327346.000000
</td>
<td>
336776.000000
</td>
<td>
336776.000000
</td>
<td>
336776.000000
</td>
<td>
327346.000000
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
2013.0
</td>
<td>
6.548510
</td>
<td>
15.710787
</td>
<td>
1349.109947
</td>
<td>
1344.254840
</td>
<td>
12.639070
</td>
<td>
1502.054999
</td>
<td>
1536.380220
</td>
<td>
6.895377
</td>
<td>
1971.923620
</td>
<td>
150.686460
</td>
<td>
1039.912604
</td>
<td>
13.180247
</td>
<td>
26.230100
</td>
<td>
16.969943
</td>
</tr>
<tr>
<th>
std
</th>
<td>
0.0
</td>
<td>
3.414457
</td>
<td>
8.768607
</td>
<td>
488.281791
</td>
<td>
467.335756
</td>
<td>
40.210061
</td>
<td>
533.264132
</td>
<td>
497.457142
</td>
<td>
44.633292
</td>
<td>
1632.471938
</td>
<td>
93.688305
</td>
<td>
733.233033
</td>
<td>
4.661316
</td>
<td>
19.300846
</td>
<td>
42.376455
</td>
</tr>
<tr>
<th>
min
</th>
<td>
2013.0
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
106.000000
</td>
<td>
-43.000000
</td>
<td>
1.000000
</td>
<td>
1.000000
</td>
<td>
-86.000000
</td>
<td>
1.000000
</td>
<td>
20.000000
</td>
<td>
17.000000
</td>
<td>
1.000000
</td>
<td>
0.000000
</td>
<td>
-33.000000
</td>
</tr>
<tr>
<th>
25%
</th>
<td>
2013.0
</td>
<td>
4.000000
</td>
<td>
8.000000
</td>
<td>
907.000000
</td>
<td>
906.000000
</td>
<td>
-5.000000
</td>
<td>
1104.000000
</td>
<td>
1124.000000
</td>
<td>
-17.000000
</td>
<td>
553.000000
</td>
<td>
82.000000
</td>
<td>
502.000000
</td>
<td>
9.000000
</td>
<td>
8.000000
</td>
<td>
-4.000000
</td>
</tr>
<tr>
<th>
50%
</th>
<td>
2013.0
</td>
<td>
7.000000
</td>
<td>
16.000000
</td>
<td>
1401.000000
</td>
<td>
1359.000000
</td>
<td>
-2.000000
</td>
<td>
1535.000000
</td>
<td>
1556.000000
</td>
<td>
-5.000000
</td>
<td>
1496.000000
</td>
<td>
129.000000
</td>
<td>
872.000000
</td>
<td>
13.000000
</td>
<td>
29.000000
</td>
<td>
1.000000
</td>
</tr>
<tr>
<th>
75%
</th>
<td>
2013.0
</td>
<td>
10.000000
</td>
<td>
23.000000
</td>
<td>
1744.000000
</td>
<td>
1729.000000
</td>
<td>
11.000000
</td>
<td>
1940.000000
</td>
<td>
1945.000000
</td>
<td>
14.000000
</td>
<td>
3465.000000
</td>
<td>
192.000000
</td>
<td>
1389.000000
</td>
<td>
17.000000
</td>
<td>
44.000000
</td>
<td>
19.000000
</td>
</tr>
<tr>
<th>
max
</th>
<td>
2013.0
</td>
<td>
12.000000
</td>
<td>
31.000000
</td>
<td>
2400.000000
</td>
<td>
2359.000000
</td>
<td>
1301.000000
</td>
<td>
2400.000000
</td>
<td>
2359.000000
</td>
<td>
1272.000000
</td>
<td>
8500.000000
</td>
<td>
695.000000
</td>
<td>
4983.000000
</td>
<td>
23.000000
</td>
<td>
59.000000
</td>
<td>
1301.000000
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="pipe-method-method-chaining"><code>pipe</code> method: method
chaining</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x : x**<span class="number">2</span></span><br><span class="line">g = <span class="keyword">lambda</span> x : x+<span class="number">1</span></span><br><span class="line">h = <span class="keyword">lambda</span> x : <span class="number">2</span>*x</span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">5</span>,<span class="number">3</span>),columns=[<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>])</span><br><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
-0.413218
</td>
<td>
0.348975
</td>
<td>
-1.313533
</td>
</tr>
<tr>
<th>
1
</th>
<td>
1.658054
</td>
<td>
0.495508
</td>
<td>
2.021334
</td>
</tr>
<tr>
<th>
2
</th>
<td>
-1.136187
</td>
<td>
0.002771
</td>
<td>
-1.651880
</td>
</tr>
<tr>
<th>
3
</th>
<td>
-1.125284
</td>
<td>
0.205869
</td>
<td>
-0.670324
</td>
</tr>
<tr>
<th>
4
</th>
<td>
1.085758
</td>
<td>
-0.103062
</td>
<td>
2.407278
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">h(g(f(df)))</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
2.341498
</td>
<td>
2.243567
</td>
<td>
5.450740
</td>
</tr>
<tr>
<th>
1
</th>
<td>
7.498284
</td>
<td>
2.491057
</td>
<td>
10.171579
</td>
</tr>
<tr>
<th>
2
</th>
<td>
4.581844
</td>
<td>
2.000015
</td>
<td>
7.457418
</td>
</tr>
<tr>
<th>
3
</th>
<td>
4.532527
</td>
<td>
2.084764
</td>
<td>
2.898668
</td>
</tr>
<tr>
<th>
4
</th>
<td>
4.357740
</td>
<td>
2.021243
</td>
<td>
13.589975
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.pipe(f).pipe(g).pipe(h)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
2.341498
</td>
<td>
2.243567
</td>
<td>
5.450740
</td>
</tr>
<tr>
<th>
1
</th>
<td>
7.498284
</td>
<td>
2.491057
</td>
<td>
10.171579
</td>
</tr>
<tr>
<th>
2
</th>
<td>
4.581844
</td>
<td>
2.000015
</td>
<td>
7.457418
</td>
</tr>
<tr>
<th>
3
</th>
<td>
4.532527
</td>
<td>
2.084764
</td>
<td>
2.898668
</td>
</tr>
<tr>
<th>
4
</th>
<td>
4.357740
</td>
<td>
2.021243
</td>
<td>
13.589975
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="row--and-column-wise-function-apply">row- and column-wise
function: <code>apply()</code></h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">flight.apply()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="pandas-ii">Pandas II</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = pd.Series(np.random.randn(<span class="number">8</span>))</span><br><span class="line">s.pct_change()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0         NaN
1   -3.496694
2   -1.735719
3   -0.905374
4    2.515764
5   -1.755356
6    0.058851
7    2.335997
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s1 = pd.Series(np.random.randn(<span class="number">100</span>))</span><br><span class="line">s2 = pd.Series(<span class="number">0.1</span>*s1+np.random.randn(<span class="number">100</span>))</span><br><span class="line">s1.cov(s2)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0.2999112016156914</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = pd.Series(np.random.randn(<span class="number">5</span>),index=<span class="built_in">list</span>(<span class="string">'abcde'</span>))</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a   -0.709341
b    0.346186
c    0.136598
d   -0.826597
e   -1.181088
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s.rank()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    3.0
b    5.0
c    4.0
d    2.0
e    1.0
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="number">0</span>]=s[<span class="number">1</span>]=<span class="number">0</span></span><br><span class="line">s.rank()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a    3.5
b    3.5
c    5.0
d    2.0
e    1.0
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf = pd.DataFrame(np.random.randn(<span class="number">10</span>,<span class="number">3</span>),columns=[<span class="string">'DOW'</span>,<span class="string">'NASDAQ'</span>,<span class="string">'SP500'</span>],index=pd.date_range(<span class="string">'1/1/2000'</span>,periods=<span class="number">10</span>))</span><br><span class="line">tsdf</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2000-01-01
</th>
<td>
0.656688
</td>
<td>
-1.531741
</td>
<td>
-0.024392
</td>
</tr>
<tr>
<th>
2000-01-02
</th>
<td>
-0.706209
</td>
<td>
0.325865
</td>
<td>
-0.329847
</td>
</tr>
<tr>
<th>
2000-01-03
</th>
<td>
-0.127025
</td>
<td>
0.806435
</td>
<td>
-0.910426
</td>
</tr>
<tr>
<th>
2000-01-04
</th>
<td>
-0.401866
</td>
<td>
0.191501
</td>
<td>
-0.204383
</td>
</tr>
<tr>
<th>
2000-01-05
</th>
<td>
-1.283493
</td>
<td>
1.175840
</td>
<td>
-1.195107
</td>
</tr>
<tr>
<th>
2000-01-06
</th>
<td>
0.467726
</td>
<td>
-0.255641
</td>
<td>
0.056299
</td>
</tr>
<tr>
<th>
2000-01-07
</th>
<td>
-0.371994
</td>
<td>
0.140242
</td>
<td>
-0.650468
</td>
</tr>
<tr>
<th>
2000-01-08
</th>
<td>
0.818794
</td>
<td>
0.461664
</td>
<td>
1.267799
</td>
</tr>
<tr>
<th>
2000-01-09
</th>
<td>
2.121635
</td>
<td>
1.405991
</td>
<td>
-0.179316
</td>
</tr>
<tr>
<th>
2000-01-10
</th>
<td>
-1.062810
</td>
<td>
0.308460
</td>
<td>
1.338484
</td>
</tr>
</tbody>
</table>
</div>
<p>apply to each column</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.agg([np.median,np.mean,np.std])</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
median
</th>
<td>
-0.249509
</td>
<td>
0.317162
</td>
<td>
-0.191849
</td>
</tr>
<tr>
<th>
mean
</th>
<td>
0.011145
</td>
<td>
0.302862
</td>
<td>
-0.083136
</td>
</tr>
<tr>
<th>
std
</th>
<td>
1.022643
</td>
<td>
0.814786
</td>
<td>
0.829758
</td>
</tr>
</tbody>
</table>
</div>
<p>agg can take dict as functions</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.agg({<span class="string">'DOW'</span>:<span class="string">'mean'</span>,<span class="string">'NASDAQ'</span>:<span class="string">'median'</span>,<span class="string">'SP500'</span>:<span class="string">'max'</span>})</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>DOW       0.011145
NASDAQ    0.317162
SP500     1.338484
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.corr(method=<span class="string">'spearman'</span>)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
DOW
</th>
<td>
1.000000
</td>
<td>
-0.018182
</td>
<td>
0.369697
</td>
</tr>
<tr>
<th>
NASDAQ
</th>
<td>
-0.018182
</td>
<td>
1.000000
</td>
<td>
-0.345455
</td>
</tr>
<tr>
<th>
SP500
</th>
<td>
0.369697
</td>
<td>
-0.345455
</td>
<td>
1.000000
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.corr(method=<span class="string">'pearson'</span>)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
DOW
</th>
<td>
1.000000
</td>
<td>
-0.012922
</td>
<td>
0.191341
</td>
</tr>
<tr>
<th>
NASDAQ
</th>
<td>
-0.012922
</td>
<td>
1.000000
</td>
<td>
-0.222936
</td>
</tr>
<tr>
<th>
SP500
</th>
<td>
0.191341
</td>
<td>
-0.222936
</td>
<td>
1.000000
</td>
</tr>
</tbody>
</table>
</div>
<p>dataframe ranks columns(default)</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.rank()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2000-01-01
</th>
<td>
8.0
</td>
<td>
1.0
</td>
<td>
7.0
</td>
</tr>
<tr>
<th>
2000-01-02
</th>
<td>
3.0
</td>
<td>
6.0
</td>
<td>
4.0
</td>
</tr>
<tr>
<th>
2000-01-03
</th>
<td>
6.0
</td>
<td>
8.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-04
</th>
<td>
4.0
</td>
<td>
4.0
</td>
<td>
5.0
</td>
</tr>
<tr>
<th>
2000-01-05
</th>
<td>
1.0
</td>
<td>
9.0
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
2000-01-06
</th>
<td>
7.0
</td>
<td>
2.0
</td>
<td>
8.0
</td>
</tr>
<tr>
<th>
2000-01-07
</th>
<td>
5.0
</td>
<td>
3.0
</td>
<td>
3.0
</td>
</tr>
<tr>
<th>
2000-01-08
</th>
<td>
9.0
</td>
<td>
7.0
</td>
<td>
9.0
</td>
</tr>
<tr>
<th>
2000-01-09
</th>
<td>
10.0
</td>
<td>
10.0
</td>
<td>
6.0
</td>
</tr>
<tr>
<th>
2000-01-10
</th>
<td>
2.0
</td>
<td>
5.0
</td>
<td>
10.0
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tsdf.rank(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
DOW
</th>
<th>
NASDAQ
</th>
<th>
SP500
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2000-01-01
</th>
<td>
3.0
</td>
<td>
1.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-02
</th>
<td>
1.0
</td>
<td>
3.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-03
</th>
<td>
2.0
</td>
<td>
3.0
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
2000-01-04
</th>
<td>
1.0
</td>
<td>
3.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-05
</th>
<td>
1.0
</td>
<td>
3.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-06
</th>
<td>
3.0
</td>
<td>
1.0
</td>
<td>
2.0
</td>
</tr>
<tr>
<th>
2000-01-07
</th>
<td>
2.0
</td>
<td>
3.0
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
2000-01-08
</th>
<td>
2.0
</td>
<td>
1.0
</td>
<td>
3.0
</td>
</tr>
<tr>
<th>
2000-01-09
</th>
<td>
3.0
</td>
<td>
2.0
</td>
<td>
1.0
</td>
</tr>
<tr>
<th>
2000-01-10
</th>
<td>
1.0
</td>
<td>
2.0
</td>
<td>
3.0
</td>
</tr>
</tbody>
</table>
</div>
<p>iterating over Series get an iterator on values</p>
<p>iterating over dataframe get an iterator over column names</p>
<p><code>df.iteritems</code><br>
<code>df.iterrows</code></p>
<h2 id="pandasgroup-by">pandas,Group By</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df = pd.DataFrame({<span class="string">'A'</span>:[<span class="string">'plant'</span>,<span class="string">'animal'</span>,<span class="string">'plant'</span>,<span class="string">'plant'</span>],<span class="string">'B'</span>:[<span class="string">'apple'</span>,<span class="string">'goat'</span>,<span class="string">'kiwi'</span>,<span class="string">'grape'</span>],<span class="string">'C'</span>:np.random.randn(<span class="number">4</span>),<span class="string">'D'</span>:np.random.randn(<span class="number">4</span>)})</span><br><span class="line">df</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
<th>
D
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
plant
</td>
<td>
apple
</td>
<td>
2.392546
</td>
<td>
-0.554108
</td>
</tr>
<tr>
<th>
1
</th>
<td>
animal
</td>
<td>
goat
</td>
<td>
-1.292467
</td>
<td>
0.800007
</td>
</tr>
<tr>
<th>
2
</th>
<td>
plant
</td>
<td>
kiwi
</td>
<td>
0.718886
</td>
<td>
0.600089
</td>
</tr>
<tr>
<th>
3
</th>
<td>
plant
</td>
<td>
grape
</td>
<td>
-0.665115
</td>
<td>
-1.205696
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.groupby(<span class="string">'A'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x00000155D469CD00&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.groupby(<span class="string">'A'</span>).groups</span><br></pre></td></tr></tbody></table></figure>
<pre><code>{'animal': [1], 'plant': [0, 2, 3]}</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">df.groupby(<span class="string">'A'</span>).mean()</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
C
</th>
<th>
D
</th>
</tr>
<tr>
<th>
A
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
animal
</th>
<td>
-1.292467
</td>
<td>
0.800007
</td>
</tr>
<tr>
<th>
plant
</th>
<td>
0.815439
</td>
<td>
-0.386571
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">index = pd.date_range(<span class="string">'10/1/1999'</span>,periods=<span class="number">1100</span>)</span><br><span class="line">ts = pd.Series(np.random.normal(<span class="number">0.5</span>,<span class="number">2</span>,<span class="number">1100</span>),index)</span><br><span class="line">ts.head()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1999-10-01    1.318674
1999-10-02    2.784437
1999-10-03    4.774021
1999-10-04    0.017314
1999-10-05    2.678237
Freq: D, dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">key = <span class="keyword">lambda</span> d: d.year</span><br><span class="line">zscore = <span class="keyword">lambda</span> x: (x-x.mean())/x.std()</span><br><span class="line">transformed = ts.groupby(key).transform(zscore)</span><br><span class="line">transformed.head()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>1999-10-01    0.409280
1999-10-02    1.168705
1999-10-03    2.199526
1999-10-04   -0.264966
1999-10-05    1.113682
Freq: D, dtype: float64</code></pre>
<p>filter return ungrouped resulted</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">sf = pd.Series([<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line">sf.groupby(sf).<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x.<span class="built_in">sum</span>()&gt;<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2    2
3    2
4    3
5    3
dtype: int64</code></pre>
<p><code>df.groupby().agg()</code><br>
<code>df.groupby().transform()</code></p>
<p><code>df.concat</code><br>
<code>df.pivot</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">df4 = pd.DataFrame({</span><br><span class="line">    <span class="string">"stock"</span>:[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>, <span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'A'</span>,<span class="string">'C'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'D'</span>,<span class="string">'D'</span>,<span class="string">'D'</span>,<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>],</span><br><span class="line">    <span class="string">"date"</span>:[<span class="string">'20210104'</span>,<span class="string">'20210104'</span>,<span class="string">'20210104'</span>,<span class="string">'20210102'</span>,<span class="string">'20210102'</span>,<span class="string">'20210102'</span>,</span><br><span class="line">            <span class="string">'20210103'</span>, <span class="string">'20210103'</span>, <span class="string">'20210101'</span>,<span class="string">'20210101'</span>,<span class="string">'20210101'</span>,</span><br><span class="line">            <span class="string">'20210105'</span>,<span class="string">'20210105'</span>,<span class="string">'20210105'</span>,<span class="string">'20210102'</span>,<span class="string">'20210103'</span>,<span class="string">'20210104'</span>,<span class="string">'20210105'</span>, </span><br><span class="line">            <span class="string">'20210106'</span>, <span class="string">'20210106'</span>, <span class="string">'20210106'</span>,<span class="string">'20210106'</span>],</span><br><span class="line">    <span class="string">"daily_ret"</span>:np.random.normal(<span class="number">0</span>,<span class="number">0.05</span>,<span class="number">22</span>)})</span><br><span class="line">df4_stacked = df4.pivot(index=<span class="string">'date'</span>,columns=<span class="string">'stock'</span>,values=<span class="string">'daily_ret'</span>)</span><br><span class="line">df4_stacked</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
stock
</th>
<th>
A
</th>
<th>
B
</th>
<th>
C
</th>
<th>
D
</th>
</tr>
<tr>
<th>
date
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
20210101
</th>
<td>
-0.005161
</td>
<td>
0.020530
</td>
<td>
0.007202
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
20210102
</th>
<td>
0.112045
</td>
<td>
0.093378
</td>
<td>
-0.048864
</td>
<td>
0.022193
</td>
</tr>
<tr>
<th>
20210103
</th>
<td>
0.047504
</td>
<td>
NaN
</td>
<td>
-0.007568
</td>
<td>
0.016684
</td>
</tr>
<tr>
<th>
20210104
</th>
<td>
0.088203
</td>
<td>
0.020008
</td>
<td>
0.048937
</td>
<td>
0.074704
</td>
</tr>
<tr>
<th>
20210105
</th>
<td>
0.072714
</td>
<td>
0.038052
</td>
<td>
0.006084
</td>
<td>
-0.010258
</td>
</tr>
<tr>
<th>
20210106
</th>
<td>
0.015653
</td>
<td>
-0.042705
</td>
<td>
-0.127649
</td>
<td>
0.032681
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s = df4_stacked.stack()</span><br><span class="line">s</span><br></pre></td></tr></tbody></table></figure>
<pre><code>date      stock
20210101  A       -0.005161
          B        0.020530
          C        0.007202
20210102  A        0.112045
          B        0.093378
          C       -0.048864
          D        0.022193
20210103  A        0.047504
          C       -0.007568
          D        0.016684
20210104  A        0.088203
          B        0.020008
          C        0.048937
          D        0.074704
20210105  A        0.072714
          B        0.038052
          C        0.006084
          D       -0.010258
20210106  A        0.015653
          B       -0.042705
          C       -0.127649
          D        0.032681
dtype: float64</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">s[<span class="string">'20210104'</span>,<span class="string">'A'</span>]</span><br><span class="line">s[<span class="string">'20210104'</span>][<span class="string">'A'</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0.0882026172983832</code></pre>
<h1 id="matplotlib">matplotlib</h1>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line">x = np.arange(<span class="number">10</span>)</span><br><span class="line">_ = plt.plot(x**<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_219_0.png" alt="png"> ​</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line">mpl.style.available</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['Solarize_Light2',
 '_classic_test_patch',
 'bmh',
 'classic',
 'dark_background',
 'fast',
 'fivethirtyeight',
 'ggplot',
 'grayscale',
 'seaborn',
 'seaborn-bright',
 'seaborn-colorblind',
 'seaborn-dark',
 'seaborn-dark-palette',
 'seaborn-darkgrid',
 'seaborn-deep',
 'seaborn-muted',
 'seaborn-notebook',
 'seaborn-paper',
 'seaborn-pastel',
 'seaborn-poster',
 'seaborn-talk',
 'seaborn-ticks',
 'seaborn-white',
 'seaborn-whitegrid',
 'tableau-colorblind10']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">mpl.style.use(<span class="string">'ggplot'</span>)</span><br><span class="line">mpl.style.use(<span class="string">'seaborn-white'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">x = np.arange(<span class="number">10</span>)</span><br><span class="line">_ = plt.plot(x**<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_222_0.png" alt="png"> ​</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">t = np.arange(<span class="number">10</span>)</span><br><span class="line">s = np.random.normal(<span class="number">1</span>,<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">_ = plt.bar(t,s,align=<span class="string">'center'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_223_0.png" alt="png"> ​</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">fig,axs = plt.subplots(nrows=<span class="number">3</span>,ncols=<span class="number">3</span>)</span><br><span class="line">x = np.arange(<span class="number">0</span>,<span class="number">100</span>)</span><br><span class="line">axs[<span class="number">0</span>][<span class="number">0</span>].plot(x,x**<span class="number">2</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[&lt;matplotlib.lines.Line2D at 0x155d7666eb0&gt;]</code></pre>
<p>​<br>
<img src="C:/Users/junxu/OneDrive%20-%20Umich/Courses/Stats%20507/CourseNote2_files/CourseNote2_224_1.png" alt="png"> ​</p>
<h1 id="regular-expressions-and-text-encoding">Regular Expressions and
Text Encoding</h1>
<p>Unicode ASCII sebset of UTF-8</p>
<ul>
<li><code>re.match()</code> at start of string</li>
<li><code>re.search()</code> any part of string</li>
<li><code>re.findall()</code> find all matches of parttern in the
string</li>
<li>https://rex101.com</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">re.<span class="keyword">match</span>(<span class="string">'cat'</span>,<span class="string">'cats and dogs'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(0, 3), match='cat'&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">regex = <span class="string">'cat'</span></span><br><span class="line">re.<span class="keyword">match</span>(regex,<span class="string">'fat on mat'</span>) <span class="keyword">is</span> <span class="literal">None</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> re.<span class="keyword">match</span>(regex,<span class="string">'fat on mat'</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'matches'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Not'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Not</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.search(<span class="string">'cat'</span>,<span class="string">'rains cats and dogs'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(6, 9), match='cat'&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> re.search(<span class="string">'cat'</span>,<span class="string">'rains cats and dogs'</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'matches'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>matches</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">'cat'</span>,<span class="string">'rains cats and cat'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['cat', 'cat']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">'\\\\\$'</span>,<span class="string">'$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">'\\\\\$'</span>,<span class="string">'\$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(0, 2), match='\\$'&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">'\$'</span>,<span class="string">'$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(0, 1), match='$'&gt;</code></pre>
<ul>
<li>raw text
<ul>
<li>is new line</li>
<li>r"" == "\n", raw text</li>
</ul></li>
<li>推荐在用字符串的时候都加上r</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">r"\n1.00"</span>,<span class="string">"\n1.00"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>\n1.00 
1.00</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">'$'</span>,<span class="string">'$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">'\$'</span>,<span class="string">'$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(0, 1), match='$'&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.<span class="keyword">match</span>(<span class="string">r'\$'</span>,<span class="string">'$'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;re.Match object; span=(0, 1), match='$'&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[aeiou]"</span>,<span class="string">"cats and dog"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['a', 'a', 'o']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[a-z ]"</span>,<span class="string">"cats and Dog"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['c', 'a', 't', 's', ' ', 'a', 'n', 'd', ' ', 'o', 'g']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[a-z]"</span>,<span class="string">"cats and Dog"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['c', 'a', 't', 's', 'a', 'n', 'd', 'o', 'g']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[A-Z]"</span>,<span class="string">"cats and Dog"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['D']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[a-zA-Z]"</span>,<span class="string">"cats and Dog"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['c', 'a', 't', 's', 'a', 'n', 'd', 'D', 'o', 'g']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[^a-zA-Z]"</span>,<span class="string">"cats and Dog"</span>) <span class="comment"># not in the list</span></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[' ', ' ']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[a\-z]"</span>,<span class="string">"i am a z-ip"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['a', 'a', 'z', '-']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[(+*)^]"</span>,<span class="string">"1+1+2^1=3*(1)"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['+', '+', '^', '*', '(', ')']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[^(+*)^]"</span>,<span class="string">"1+1+2^1=3*(1)"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['1', '1', '2', '1', '=', '3', '1']</code></pre>
<ul>
<li>: space, tab, new line, = [ ]</li>
<li>r"" = r"[a-zA-Z_]"</li>
<li> digits = r"[0-9]"</li>
<li>"^": not in the [], start of a line</li>
<li>new line 开头有个invisible ^, end line have invisible $</li>
<li>"$": end of a line</li>
<li>".": including everything</li>
<li>只想匹配句号的话用："."</li>
<li>"o..r" match "o任意两个字母r"</li>
<li> word boundary: a 以a结尾的单词</li>
<li>如果想neglect上述，只需要大写，例如：, neglect all the words</li>
<li>+: "e+" match any number of e's</li>
<li><em>: "e</em>"</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"oe+"</span>,<span class="string">"oeuvree"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['oe']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[oe]+"</span>,<span class="string">"oeuvree"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['oe', 'ee']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"[whe]*"</span>,<span class="string">"while wheeee weheee"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['wh', '', '', 'e', '', 'wheeee', '', 'weheee', '']</code></pre>
<p>‘*’ : zero or more of the previous item</p>
<p>‘+’ : one or more of the previous item</p>
<p>‘?’ : zero or one of the previous item</p>
<p>‘{4}’ : exactly four of the previous item</p>
<p>‘{3,}’ : three or more of previous item</p>
<p>‘{2,5}’ : between two and five (inclusive) of previous item</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"whe*"</span>,<span class="string">"while wheeee weheee heee weee"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['wh', 'wheeee']</code></pre>
<p>‘|’ (“pipe”) is a special character that allows one to specify “or”
clauses</p>
<p>Example: I want to match the word “cat” or the word “dog”</p>
<p>Solution: ‘(cat|dog)’ 记得加括号！！！</p>
<p>Note: parentheses are not strictly necessary here, but parentheses
tend to make for easier reading and avoid possible ambiguity. It’s a
good habit to just use them always.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">r"a|aa|aaa"</span>,<span class="string">"aaaa"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['a', 'a', 'a', 'a']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">r"a+"</span>,<span class="string">"aaaa"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['aaaa']</code></pre>
<p>'?' modifies operators like '+' and '*' not be greedy,get lazy
matching</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">r"a+?"</span>,<span class="string">"aaaa"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['a', 'a', 'a', 'a']</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">re.findall(<span class="string">"\w+@\w+\.\w+"</span>,<span class="string">"your email is kobe@icloud.com, his email is jacob@umich.edu"</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['kobe@icloud.com', 'jacob@umich.edu']</code></pre>
<p>capture group ():</p>
<ul>
<li>(+@+.+)</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">regex = <span class="string">r'(\w+@\w+\.\w+)'</span></span><br><span class="line">s = <span class="string">"your email is kobe@icloud.com kobe@icloud.com his email is jacob@umich.edu"</span></span><br><span class="line">m=re.findall(regex,s)</span><br><span class="line">m</span><br></pre></td></tr></tbody></table></figure>
<pre><code>['kobe@icloud.com', 'kobe@icloud.com', 'jacob@umich.edu']</code></pre>
<ul>
<li>backreferences
<ul>
<li>in paranthesis() occur once again
<ul>
<li>([a-zA-Z]+).*\1 首尾以相同字段开始和结束，中间任意</li>
</ul></li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">regex = <span class="string">r'(\w+)\1'</span></span><br><span class="line">s = <span class="string">"freefree"</span></span><br><span class="line">m = re.search(regex,s)</span><br><span class="line">m.group(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'free'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">regex = <span class="string">r'\w+'</span></span><br><span class="line">s = <span class="string">"nonrepeat"</span></span><br><span class="line">m = re.search(regex,s)</span><br><span class="line">m.group(<span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'nonrepeat'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h1 id="sql">SQL</h1>
<ul>
<li>每列一个type</li>
<li>key: uniquely identify a record</li>
<li>sqliteonline.com</li>
<li>features:
<ul>
<li>atomicity</li>
<li>consistency</li>
<li>isolation</li>
<li>durability</li>
</ul></li>
<li>https://www.w3schools.com/sql/</li>
<li>select
<ul>
<li>SELECT * FROM countries</li>
<li>SELECT id, name FROM countries</li>
<li>SELECT * FROM countries WHERE [filter]</li>
<li>&lt;&gt; !=</li>
<li>= ==</li>
<li>SELECT * FROM countries WHERE [] BETWEEN 86 AND 90</li>
<li>SELECT * FROM countries WHERE [filter] IS NULL
<ul>
<li>Note: 空格不会match NULL</li>
</ul></li>
</ul></li>
<li>SORT
<ul>
<li>ORDER BY
<ul>
<li>SELECT [columns] FROM [table] ORDER BY [column] [ASC|DESC]</li>
<li>SELECT [columns] FROM countries ORDER BY phonecode ASC, name
DESC</li>
<li>等价于 SELECT [columns] FROM countries ORDER BY phonecode, name
DESC</li>
<li>默认ASC</li>
</ul></li>
</ul></li>
<li>DISTINCT
<ul>
<li>SELECT DISTINCT [columns] FROM [table]</li>
</ul></li>
<li>WHERE
<ul>
<li>支持set
<ul>
<li>SELECT id from t_student WHERE major IN
("Mathematics","statistics")</li>
<li>SELECT id from t_student WHERE major NOT IN
("Mathematics","statistics")</li>
</ul></li>
<li>支持regex-like matching
<ul>
<li>SELCET id from t_student WHERE first_name LIKE "M%"</li>
<li>%: match any number of letters</li>
<li>_: match one number of letters</li>
</ul></li>
</ul></li>
<li>GROUP BY
<ul>
<li>SELECT customer_id, SUM(dollar_amount) FROM t_transactions GROUP BY
customer_id</li>
<li>COUNT, AVG, MIN, MAX: aggregate function</li>
<li>SECLECT phonecode, COUNT() FROM countries GROUP BY phonecode</li>
<li>HAVING: filer results after GROUP BY using the HAVING keyword
<ul>
<li>SELECT customer_id, SUM(dollar_amount) AS total_dolar FROM
t_transactions GROUP BY customer_id HAVING total_dolar &gt;50</li>
</ul></li>
</ul></li>
<li>JOIN: merging tables
<ul>
<li>INNER JOIN
<ul>
<li>SELECT id, name, color FROM t_student INNER JOIN t_personal ON
t_students.id=t_personal.id</li>
</ul></li>
<li>LEFT JOIN</li>
<li>RIGHT JOIN</li>
<li>FULL JOIN</li>
</ul></li>
<li>INSERT INTO
<ul>
<li>INSERT INTO table_name [col1, col2, col3, …] VALUES value1, value2,
value3, …</li>
</ul></li>
<li>UPDATE
<ul>
<li>UPDATE table_name SET col1=value1,col2=value2, WHERE condition</li>
<li>Caution: if WHERE is left empty, you'll delete/modify the whole
tanle!</li>
</ul></li>
<li>DELETE
<ul>
<li>DELETE FROM table_name WHERE condition</li>
</ul></li>
<li>CREATE TABLE
<ul>
<li>CREATE TABLE table_name [col1 datatype, col2 datatype, …]</li>
</ul></li>
<li>DROP TABLE
<ul>
<li>DROP TABLE table_name;</li>
</ul></li>
<li>SELECT * FROM sqlite_master</li>
<li>SELECT * FROM sqlite_master WHERE type="table"</li>
</ul>
<p>课件里的python例子</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line">con = sqlite3.connect(<span class="string">'ps8/flights.sqlite'</span>)</span><br><span class="line">cur = con.cursor()</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">con</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;sqlite3.Connection at 0x2615592b040&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">res = cur.execute(<span class="string">"select * from flights limit 10"</span>) <span class="comment"># head 10 of table</span></span><br><span class="line">res</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;sqlite3.Cursor at 0x2615594d3c0&gt;</code></pre>
<p>(Actually, <code>res</code> is just the original cursor itself):</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">res <span class="keyword">is</span> cur</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> res:</span><br><span class="line">    <span class="built_in">print</span>(row[<span class="number">0</span>])</span><br></pre></td></tr></tbody></table></figure>
<pre><code>2013
2013
2013
2013
2013
2013
2013
2013
2013
2013</code></pre>
<h2 id="fetching-results">Fetching results</h2>
<p>To retrieve results, use the <code>cur.fetchone()</code> or
<code>cur.fetchall()</code> methods:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">res = cur.execute(<span class="string">"select * from flights limit 10"</span>) <span class="comment"># head 10 of table</span></span><br><span class="line"></span><br><span class="line">cur.fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(2013,
 1,
 1,
 517,
 515,
 2.0,
 830,
 819,
 11.0,
 'UA',
 1545,
 'N14228',
 'EWR',
 'IAH',
 227.0,
 1400.0,
 5.0,
 15.0,
 1357034400.0)</code></pre>
<p>This returns a tuple containing one entry for each column in our
<code>SELECT</code> statement.</p>
<p>If you want all the rows, use <code>cur.fetchall()</code>:</p>
<p>It is an iterator</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>(res.fetchall())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>9</code></pre>
<p>Notice that <code>.fetchall()</code> works like an iterator--we
<code>SELECT</code>ed 10 rows, fetched one of them using
<code>.fetchone()</code>, and then fetched the remaining 9 using
<code>.fetchall()</code>. If we run this again we'll get zero rows back
because we already fetched everything:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">len</span>(res.fetchall())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>0</code></pre>
<h2 id="parameterized-queries">Parameterized queries</h2>
<p>Sometimes our queries must depend on user input. Consider the
following query which returns all the flights that happened in a certain
month:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">num_flights_in_month</span>(<span class="params">month</span>):</span><br><span class="line">    query = <span class="string">"""SELECT COUNT() FROM flights WHERE month = %d"""</span> % month</span><br><span class="line">    <span class="keyword">return</span> cur.execute(query).fetchone()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">num_flights_in_month(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>27004</code></pre>
<p>For queries that depend on a parameter, we can use the special
placeholder <code>?</code> to have the database do parameter
substitution for us:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">num_flights_in_month</span>(<span class="params">m</span>):</span><br><span class="line">    query = <span class="string">"""SELECT COUNT() FROM flights WHERE month = ?"""</span></span><br><span class="line">    <span class="keyword">return</span> cur.execute(query, [m]).fetchone()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">num_flights_in_month(<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>27004</code></pre>
<p>Using multiple placeholders is possible:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">num_flights_on_day</span>(<span class="params">m, d</span>):</span><br><span class="line">    query = <span class="string">"""SELECT COUNT() FROM flights WHERE month = ? AND day = ?"""</span></span><br><span class="line">    <span class="keyword">return</span> cur.execute(query, [m, d]).fetchone()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">num_flights_on_day(<span class="number">12</span>, <span class="number">25</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>719</code></pre>
<p>Notice that, even if there is just one parameter, you have to pass in
all the parameters as a <code>list</code>.</p>
<h2 id="why-use-placeholders">Why use placeholders</h2>
<p>Consider the following table:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">scon = sqlite3.connect(<span class="string">":memory:"</span>) </span><br><span class="line">scon.execute(<span class="string">'CREATE TABLE users (id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT, age INT, password TEXT)'</span>)</span><br><span class="line">scon.execute(<span class="string">"""INSERT INTO users(username, age, password) VALUES </span></span><br><span class="line"><span class="string">('Jonathan', 40, 'beeri$g00d'),</span></span><br><span class="line"><span class="string">('Sarah', 41, 'wat3rp0l0'),</span></span><br><span class="line"><span class="string">('Julian', 2, 'il0vecr0ut0n3')</span></span><br><span class="line"><span class="string">"""</span>)</span><br><span class="line">scon.commit()</span><br></pre></td></tr></tbody></table></figure>
<p>Here's our table:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">pd.read_sql_query(<span class="string">"SELECT * from users"</span>, scon)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
id
</th>
<th>
username
</th>
<th>
age
</th>
<th>
password
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1
</td>
<td>
Jonathan
</td>
<td>
40
</td>
<td>
beeri$g00d
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2
</td>
<td>
Sarah
</td>
<td>
41
</td>
<td>
wat3rp0l0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
3
</td>
<td>
Julian
</td>
<td>
2
</td>
<td>
il0vecr0ut0n3
</td>
</tr>
</tbody>
</table>
</div>
<p>Now let's say we have a function which takes a user-supplied
parameter, their username, and returns their user information:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">username</span>):</span><br><span class="line">    q = <span class="string">"SELECT * FROM users WHERE username = '%s'"</span> % username</span><br><span class="line">    <span class="built_in">print</span>(q)</span><br><span class="line">    <span class="keyword">return</span> pd.read_sql_query(q, scon)</span><br><span class="line"></span><br><span class="line">user_info(<span class="string">'Jonathan'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>SELECT * FROM users WHERE username = 'Jonathan'</code></pre>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
id
</th>
<th>
username
</th>
<th>
age
</th>
<th>
password
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1
</td>
<td>
Jonathan
</td>
<td>
40
</td>
<td>
beeri$g00d
</td>
</tr>
</tbody>
</table>
</div>
<p>This works great assuming that what got passed in is actually a
username, but a malicious user could do the following:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">user_info(<span class="string">"""abc' or 'a'='a"""</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>SELECT * FROM users WHERE username = 'abc' or 'a'='a'</code></pre>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
id
</th>
<th>
username
</th>
<th>
age
</th>
<th>
password
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1
</td>
<td>
Jonathan
</td>
<td>
40
</td>
<td>
beeri$g00d
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2
</td>
<td>
Sarah
</td>
<td>
41
</td>
<td>
wat3rp0l0
</td>
</tr>
<tr>
<th>
2
</th>
<td>
3
</td>
<td>
Julian
</td>
<td>
2
</td>
<td>
il0vecr0ut0n3
</td>
</tr>
</tbody>
</table>
</div>
<p>This is known as an <strong>injection attack</strong>. For this
reason, we do not passed user input directly into a query string.
Instead we use placeholders, and rely on the SQL engine itself to
perform the substitution:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">safe_user_info</span>(<span class="params">username</span>):</span><br><span class="line">    q = <span class="string">"SELECT * FROM users WHERE username = ?"</span></span><br><span class="line">    <span class="built_in">print</span>(q)</span><br><span class="line">    <span class="keyword">return</span> pd.read_sql_query(q, scon, params=[username])</span><br><span class="line"></span><br><span class="line">safe_user_info(<span class="string">'Jonathan'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>SELECT * FROM users WHERE username = ?</code></pre>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
id
</th>
<th>
username
</th>
<th>
age
</th>
<th>
password
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
1
</td>
<td>
Jonathan
</td>
<td>
40
</td>
<td>
beeri$g00d
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">safe_user_info(<span class="string">"""abc' or 'a'='a"""</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>SELECT * FROM users WHERE username = ?</code></pre>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
id
</th>
<th>
username
</th>
<th>
age
</th>
<th>
password
</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
<h1 id="ten-questions-about-flights">Ten questions about
<code>flights</code></h1>
<p>Now we will use SQL queries to various questions about the
<code>flights</code> dataset.</p>
<h2 id="which-airport-is-the-busiest">Which airport is the busiest?</h2>
<p>We need to aggregate <code>flights</code> by the <code>origin</code>
column, and they count the number of rows in each group.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"SELECT origin, COUNT() FROM flights GROUP BY origin"</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('EWR', 120835), ('JFK', 111279), ('LGA', 104662)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"SELECT origin, COUNT() FROM flights GROUP BY origin"</span>).description</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(('origin', None, None, None, None, None, None),
 ('COUNT()', None, None, None, None, None, None))</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">pd.read_sql_query(<span class="string">"SELECT origin, COUNT() FROM flights GROUP BY origin"</span>,con)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
origin
</th>
<th>
COUNT()
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
EWR
</td>
<td>
120835
</td>
</tr>
<tr>
<th>
1
</th>
<td>
JFK
</td>
<td>
111279
</td>
</tr>
<tr>
<th>
2
</th>
<td>
LGA
</td>
<td>
104662
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="which-month-was-coldest">Which month was coldest?</h2>
<p>We need to aggregate <code>weather</code> by <code>month</code>, and
the compute some measure of coldness.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"SELECT month, AVG(temp) FROM weather GROUP BY month"</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 35.63566037735852),
 (2, 34.27059701492533),
 (3, 39.880071845532164),
 (4, 51.745641500694774),
 (5, 61.79500000000004),
 (6, 72.18399999999997),
 (7, 80.06622082585272),
 (8, 74.4684657039714),
 (9, 67.3712922649374),
 (10, 60.07113019891505),
 (11, 44.9904343764596),
 (12, 38.44180037313427)]</code></pre>
<h2 id="what-is-the-most-popular-carrier-at-each-of-the-three-nyc-airports">What
is the most popular carrier at each of the three NYC airports?</h2>
<p>This one is a bit trickier. We start by counting the number of
flights for each combination of <code>carrier</code> and
<code>origin</code>:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"SELECT COUNT(), carrier, origin FROM flights GROUP BY carrier, origin"</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1268, '9E', 'EWR'),
 (14651, '9E', 'JFK'),
 (2541, '9E', 'LGA'),
 (3487, 'AA', 'EWR'),
 (13783, 'AA', 'JFK'),
 (15459, 'AA', 'LGA'),
 (714, 'AS', 'EWR'),
 (6557, 'B6', 'EWR'),
 (42076, 'B6', 'JFK'),
 (6002, 'B6', 'LGA'),
 (4342, 'DL', 'EWR'),
 (20701, 'DL', 'JFK'),
 (23067, 'DL', 'LGA'),
 (43939, 'EV', 'EWR'),
 (1408, 'EV', 'JFK'),
 (8826, 'EV', 'LGA'),
 (685, 'F9', 'LGA'),
 (3260, 'FL', 'LGA'),
 (342, 'HA', 'JFK'),
 (2276, 'MQ', 'EWR'),
 (7193, 'MQ', 'JFK'),
 (16928, 'MQ', 'LGA'),
 (6, 'OO', 'EWR'),
 (26, 'OO', 'LGA'),
 (46087, 'UA', 'EWR'),
 (4534, 'UA', 'JFK'),
 (8044, 'UA', 'LGA'),
 (4405, 'US', 'EWR'),
 (2995, 'US', 'JFK'),
 (13136, 'US', 'LGA'),
 (1566, 'VX', 'EWR'),
 (3596, 'VX', 'JFK'),
 (6188, 'WN', 'EWR'),
 (6087, 'WN', 'LGA'),
 (601, 'YV', 'LGA')]</code></pre>
<p>Next, we need to rank the carriers within origin by their counts.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT RANK() OVER (</span></span><br><span class="line"><span class="string">        PARTITION BY origin</span></span><br><span class="line"><span class="string">        ORDER BY n</span></span><br><span class="line"><span class="string">    ) AS r, carrier, origin, n FROM</span></span><br><span class="line"><span class="string">    (SELECT COUNT() as n, carrier, origin FROM flights GROUP BY carrier, origin)</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 'OO', 'EWR', 6),
 (2, 'AS', 'EWR', 714),
 (3, '9E', 'EWR', 1268),
 (4, 'VX', 'EWR', 1566),
 (5, 'MQ', 'EWR', 2276),
 (6, 'AA', 'EWR', 3487),
 (7, 'DL', 'EWR', 4342),
 (8, 'US', 'EWR', 4405),
 (9, 'WN', 'EWR', 6188),
 (10, 'B6', 'EWR', 6557),
 (11, 'EV', 'EWR', 43939),
 (12, 'UA', 'EWR', 46087),
 (1, 'HA', 'JFK', 342),
 (2, 'EV', 'JFK', 1408),
 (3, 'US', 'JFK', 2995),
 (4, 'VX', 'JFK', 3596),
 (5, 'UA', 'JFK', 4534),
 (6, 'MQ', 'JFK', 7193),
 (7, 'AA', 'JFK', 13783),
 (8, '9E', 'JFK', 14651),
 (9, 'DL', 'JFK', 20701),
 (10, 'B6', 'JFK', 42076),
 (1, 'OO', 'LGA', 26),
 (2, 'YV', 'LGA', 601),
 (3, 'F9', 'LGA', 685),
 (4, '9E', 'LGA', 2541),
 (5, 'FL', 'LGA', 3260),
 (6, 'B6', 'LGA', 6002),
 (7, 'WN', 'LGA', 6087),
 (8, 'UA', 'LGA', 8044),
 (9, 'EV', 'LGA', 8826),
 (10, 'US', 'LGA', 13136),
 (11, 'AA', 'LGA', 15459),
 (12, 'MQ', 'LGA', 16928),
 (13, 'DL', 'LGA', 23067)]



&lt;IPython.core.display.Javascript object&gt;</code></pre>
<p>Finally, to find the most popular carriers, we can filter this table
to only the rows where <code>rank=1</code>. To do this I will use a
<em>subquery</em>:</p>
<p><code>SELECT * FROM (&lt;another query&gt;)</code></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT * FROM (SELECT RANK() OVER (</span></span><br><span class="line"><span class="string">        PARTITION BY origin</span></span><br><span class="line"><span class="string">        ORDER BY n DESC</span></span><br><span class="line"><span class="string">    ) AS r, carrier, origin, n FROM</span></span><br><span class="line"><span class="string">    (SELECT COUNT() as n, carrier, origin FROM flights GROUP BY carrier, origin)</span></span><br><span class="line"><span class="string">    ) WHERE r = 1</span></span><br><span class="line"><span class="string">"""</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 'UA', 'EWR', 46087), (1, 'B6', 'JFK', 42076), (1, 'DL', 'LGA', 23067)]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT * FROM (SELECT RANK() OVER (</span></span><br><span class="line"><span class="string">        PARTITION BY origin</span></span><br><span class="line"><span class="string">        ORDER BY n DESC</span></span><br><span class="line"><span class="string">    ) AS r, carrier, origin, n FROM</span></span><br><span class="line"><span class="string">    (SELECT COUNT() as n, carrier, origin FROM flights GROUP BY carrier, origin)</span></span><br><span class="line"><span class="string">    ) AS subq JOIN airlines ON airlines.carrier = subq.carrier</span></span><br><span class="line"><span class="string">    WHERE r = 1 </span></span><br><span class="line"><span class="string">"""</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(1, 'B6', 'JFK', 42076, 'B6', 'JetBlue Airways'),
 (1, 'DL', 'LGA', 23067, 'DL', 'Delta Air Lines Inc.'),
 (1, 'UA', 'EWR', 46087, 'UA', 'United Air Lines Inc.')]</code></pre>
<h2 id="what-are-the-busiest-travel-weeks-of-the-year">What are the
busiest travel weeks of the year?</h2>
<p>We need to figure out the week of each flight, and then aggregate
them. To manipulate dates in sqlite, we have the <a href="https://www.sqlite.org/lang_datefunc.html"><code>strftime()</code>
function</a>:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"""SELECT strftime('%W', 'now')"""</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>('11',)</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"""SELECT strftime('The day of the week is %w, the week of the year is %W', 'now')"""</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>('The day of the week is 0, the week of the year is 11',)</code></pre>
<h2 id="the-unix-epoch">The Unix epoch</h2>
<p>The <code>time_hour</code> column in <code>flights</code> looks
like:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"""SELECT time_hour FROM flights"""</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(1357034400.0,)</code></pre>
<p>This number represents the number of seconds that have elapsed since
midnight GMT on January 1, 1970, a date known as the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>. We can
use <code>strftime()</code> on these dates provided we tell it how they
are formatted.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># datetime() is an alias for strftime('%Y-%m-%d %H:%M:%S', ...)</span></span><br><span class="line">cur.execute(<span class="string">"""SELECT datetime(1357034400, 'unixepoch')"""</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>('2013-01-01 10:00:00',)</code></pre>
<p>Now we can convert each date to a week of the year:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">pd.read_sql_query(<span class="string">"""SELECT year, month, day, strftime('%W', time_hour, 'unixepoch') from flights"""</span>, con)</span><br></pre></td></tr></tbody></table></figure>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }


    .dataframe tbody tr th {
        vertical-align: top;
    }
    
    .dataframe thead th {
        text-align: right;
    }

</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
year
</th>
<th>
month
</th>
<th>
day
</th>
<th>
strftime('%W', time_hour, 'unixepoch')
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
00
</td>
</tr>
<tr>
<th>
1
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
00
</td>
</tr>
<tr>
<th>
2
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
00
</td>
</tr>
<tr>
<th>
3
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
00
</td>
</tr>
<tr>
<th>
4
</th>
<td>
2013
</td>
<td>
1
</td>
<td>
1
</td>
<td>
00
</td>
</tr>
<tr>
<th>
...
</th>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
<td>
...
</td>
</tr>
<tr>
<th>
336771
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
39
</td>
</tr>
<tr>
<th>
336772
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
39
</td>
</tr>
<tr>
<th>
336773
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
39
</td>
</tr>
<tr>
<th>
336774
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
39
</td>
</tr>
<tr>
<th>
336775
</th>
<td>
2013
</td>
<td>
9
</td>
<td>
30
</td>
<td>
39
</td>
</tr>
</tbody>
</table>
<p>
336776 rows × 4 columns
</p>
</div>
<p>The final query looks like:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">con.execute(<span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT COUNT() as n, strftime('%W', time_hour, 'unixepoch') as week FROM flights</span></span><br><span class="line"><span class="string">    GROUP BY week</span></span><br><span class="line"><span class="string">    ORDER BY n DESC</span></span><br><span class="line"><span class="string">"""</span>).fetchall()[:<span class="number">10</span>]</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(6760, '27'),
 (6740, '29'),
 (6737, '28'),
 (6735, '30'),
 (6733, '31'),
 (6702, '25'),
 (6687, '32'),
 (6675, '24'),
 (6639, '23'),
 (6631, '33')]</code></pre>
<h2 id="what-where-the-ten-worst-days-for-average-departure-delay">What
where the ten worst days for average departure delay?</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">con.execute(<span class="string">'''SELECT year, month, day, AVG(dep_delay) AS avg_delay</span></span><br><span class="line"><span class="string">            FROM flights GROUP BY year, month, day </span></span><br><span class="line"><span class="string">            ORDER BY avg_delay DESC</span></span><br><span class="line"><span class="string">            LIMIT 10'''</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(2013, 3, 8, 83.5369211514393),
 (2013, 7, 1, 56.23382519863791),
 (2013, 9, 2, 53.029550827423165),
 (2013, 7, 10, 52.860702151755376),
 (2013, 12, 5, 52.32799013563502),
 (2013, 5, 23, 51.14471968709257),
 (2013, 9, 12, 49.95875),
 (2013, 6, 28, 48.827784156142364),
 (2013, 6, 24, 47.15741789354473),
 (2013, 7, 22, 46.66704675028506)]</code></pre>
<h2 id="what-where-the-ten-best-days-for-departure-delay">What where the
ten best days for departure delay?</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">con.execute(<span class="string">'''SELECT year, month, day, AVG(dep_delay) AS avg_delay</span></span><br><span class="line"><span class="string">            FROM flights GROUP BY year, month, day </span></span><br><span class="line"><span class="string">            ORDER BY avg_delay ASC</span></span><br><span class="line"><span class="string">            LIMIT 10'''</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(2013, 9, 24, -1.3298319327731092),
 (2013, 10, 2, -0.919917864476386),
 (2013, 11, 9, -0.6288515406162465),
 (2013, 9, 6, -0.39792746113989635),
 (2013, 9, 5, -0.3877973112719752),
 (2013, 10, 29, -0.34932221063607927),
 (2013, 9, 7, -0.25036390101892286),
 (2013, 11, 5, -0.18314255983350677),
 (2013, 10, 19, -0.10703812316715543),
 (2013, 10, 1, -0.09895833333333333)]</code></pre>
<h2 id="what-airlines-have-the-most-departure-delay">What airlines have
the most departure delay?</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">con.execute(<span class="string">'''SELECT airlines.carrier, name, AVG(dep_delay) AS avg_delay</span></span><br><span class="line"><span class="string">            FROM flights</span></span><br><span class="line"><span class="string">            JOIN airlines on airlines.carrier=flights.carrier</span></span><br><span class="line"><span class="string">            GROUP BY airlines.name</span></span><br><span class="line"><span class="string">            ORDER BY avg_delay DESC</span></span><br><span class="line"><span class="string">            LIMIT 10'''</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('F9', 'Frontier Airlines Inc.', 20.215542521994134),
 ('EV', 'ExpressJet Airlines Inc.', 19.955389827868213),
 ('YV', 'Mesa Airlines Inc.', 18.996330275229358),
 ('FL', 'AirTran Airways Corporation', 18.72607467838092),
 ('WN', 'Southwest Airlines Co.', 17.71174377224199),
 ('9E', 'Endeavor Air Inc.', 16.725769407441433),
 ('B6', 'JetBlue Airways', 13.022522106740018),
 ('VX', 'Virgin America', 12.869421165464821),
 ('OO', 'SkyWest Airlines Inc.', 12.586206896551724),
 ('UA', 'United Air Lines Inc.', 12.106072888459614)]</code></pre>
<h2 id="what-airplane-flew-the-most-days">What airplane flew the most
days?</h2>
<p>Airplanes are identified by their tail number.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'''SELECT tailnum, COUNT() AS n FROM</span></span><br><span class="line"><span class="string">    (SELECT DISTINCT year, month, day, tailnum FROM flights)</span></span><br><span class="line"><span class="string">    GROUP BY tailnum</span></span><br><span class="line"><span class="string">    ORDER BY n DESC</span></span><br><span class="line"><span class="string">    LIMIT 1</span></span><br><span class="line"><span class="string">'''</span>).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('N328AA', 336)]</code></pre>
<p>Interestingly, you can Google most tail numbers: <a href="https://www.planespotters.net/airframe/boeing-767-200-n328aa-american-airlines/enj523">N328AA</a>.</p>
<h2 id="how-many-flights-were-cancelled">How many flights were
cancelled?</h2>
<p>We'll say that a cancelled flight has <code>dep_time</code>
missing.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'''SELECT COUNT() FROM flights WHERE dep_time IS NULL'''</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0,)</code></pre>
<p>Notice that we don't write <code>= NULL</code>. That does not
work:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">'''SELECT COUNT() FROM flights WHERE dep_time = NULL'''</span>).fetchone()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(0,)</code></pre>
<h2 id="how-many-flights-were-destined-for-airports-with-a-one-word-name">How
many flights were destined for airports with a one word name?</h2>
<p>(Not including the word "airport")</p>
<p>Here is an example of an airport with a one-word name:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(<span class="string">"SELECT * FROM airports WHERE name = 'Packwood'"</span>).description</span><br></pre></td></tr></tbody></table></figure>
<pre><code>(('faa', None, None, None, None, None, None),
 ('name', None, None, None, None, None, None),
 ('lat', None, None, None, None, None, None),
 ('lon', None, None, None, None, None, None),
 ('alt', None, None, None, None, None, None),
 ('tz', None, None, None, None, None, None),
 ('dst', None, None, None, None, None, None),
 ('tzone', None, None, None, None, None, None))



&lt;IPython.core.display.Javascript object&gt;</code></pre>
<blockquote>
<p>CAST(xxx AS INTEGER)</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT name</span></span><br><span class="line"><span class="string">    FROM airports WHERE name NOT LIKE '% %'</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[('Packwood',),
 ('Florence',),
 ('Arcata',),
 ('Kodiak',),
 ('Addison',),
 ('Alexandria',),
 ('Centennial',),
 ('Lakeland',),
 ('Appleton',),
 ('Executive',),
 ('Avalon',),
 ('Kalamazoo',),
 ('Bethel',),
 ('Beaufort',),
 ('Bettles',),
 ('KBWD',),
 ('CedarKey',),
 ('Clemson',),
 ('Charlottesville-Albemarle',),
 ('Chehalis-Centralia',),
 ('Champaign',),
 ('Yeager',),
 ('Tri-Cities',),
 ('Decatur',),
 ('Dillingham',),
 ('Dupage',),
 ('Destin',),
 ('Unalaska',),
 ('Orlando',),
 ('Bessemer',),
 ('Wendover',),
 ('Franklin',),
 ('Tipton',),
 ('Gulkana',),
 ('Gulfport-Biloxi',),
 ('Majors',),
 ('Dillingham',),
 ('Hana',),
 ('Homer',),
 ('Iliamna',),
 ('Immokalee',),
 ('Kapalua',),
 ('Logan-Cache',),
 ('Lihue',),
 ('Lincoln',),
 ('Lanai',),
 ('Castle',),
 ('Mojave',),
 ('Downtown',),
 ('Molokai',),
 ('Manassas',),
 ('MariposaYosemite',),
 ('Lakefront',),
 ('County',),
 ('Kahului',),
 ('Nome',),
 ('Executive',),
 ('Northway',),
 ('Platinum',),
 ('Renton',),
 ('Rochester',),
 ('Prosser',),
 ('Deadhorse',),
 ('Sedona',),
 ('Gillespie',),
 ('Teterboro',),
 ('Telluride',),
 ('Talkeetna',),
 ('Toledo',),
 ('Upolu',),
 ('Apopka',),
 ('Yakutat',),
 ('Clear',)]



&lt;IPython.core.display.Javascript object&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">cur.execute(</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    SELECT COUNT() FROM flights</span></span><br><span class="line"><span class="string">    INNER JOIN (SELECT faa FROM airports WHERE name NOT LIKE '% %') one_word</span></span><br><span class="line"><span class="string">    ON one_word.faa = flights.dest</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">).fetchall()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[(190,)]



&lt;IPython.core.display.Javascript object&gt;</code></pre>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Reading List</title>
    <url>/Reading-List/</url>
    <content><![CDATA[<h1 id="machine-learning">1. Machine Learning</h1>
<h2 id="step-1">Step 1</h2>
<ul class="task-list">
<li><input type="checkbox" disabled="">
Hands-On Machine learning with Scikit-Learn and Tensorflow</li>
<li><input type="checkbox" disabled="">
Python Machine Learning. Sebastian Raschka</li>
<li><input type="checkbox" disabled="">
Introduction to Statistical Learning with R</li>
<li><input type="checkbox" disabled="">
【参考书】机器学习. 周志华</li>
</ul>
<h2 id="step-2">Step 2</h2>
<ul class="task-list">
<li><input type="checkbox" disabled="">
训练平台：Kaggle，天池大数据竞赛</li>
<li><input type="checkbox" disabled="">
Scikit-learn: machine learning in Python</li>
</ul>
<h2 id="step-3">Step 3</h2>
<ul class="task-list">
<li><input type="checkbox" disabled="">
Deeplearning.ai —— Coursera</li>
<li><input type="checkbox" disabled="">
Deep learning - by Ian GoodFellow</li>
</ul>
<h2 id="step-4">Step 4</h2>
<ul class="task-list">
<li><input type="checkbox" disabled="">
Elements of Statistical Learning</li>
<li><input type="checkbox" disabled="">
统计学习基础</li>
<li><input type="checkbox" disabled="">
订阅arxiv</li>
<li><input type="checkbox" disabled="">
关注顶会：ICML/NIPS/KDD</li>
</ul>
<h1 id="financial-engineering">2. Financial Engineering</h1>
<p><a href="https://www.zhihu.com/question/302531501/answer/534780501">金融工程专业需要哪些数学基础？
- 经管之家的回答 - 知乎</a></p>
]]></content>
      <categories>
        <category>Other</category>
      </categories>
      <tags>
        <tag>Learning Tips</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Algorithm and Data Structure</title>
    <url>/Python-Algorithm-and-Data-Structure/</url>
    <content><![CDATA[<h1 id="python-数据结构与算法分析">Python 数据结构与算法分析</h1>
<h2 id="stack">Stack</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>: </span><br><span class="line">    <span class="string">'''Last in First out, insert to last place'''</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.items = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isEmpty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items == []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, item</span>):</span><br><span class="line">        self.items.append(item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">peek</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span>: </span><br><span class="line">    <span class="string">'''Last in First out, insert first place'''</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.items = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isEmpty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items == []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, item</span>):</span><br><span class="line">        self.items.insert(<span class="number">0</span>,item)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">peek</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parChecker</span>(<span class="params">symbolString</span>):</span><br><span class="line">    s = Stack()</span><br><span class="line">    balanced = <span class="literal">True</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> index &lt; <span class="built_in">len</span>(symbolString) <span class="keyword">and</span> balanced:</span><br><span class="line">        symbol = symbolString[index]</span><br><span class="line">        <span class="keyword">if</span> symbol == <span class="string">'('</span>:</span><br><span class="line">            s.push(symbol)</span><br><span class="line">        <span class="keyword">elif</span> s.isEmpty():</span><br><span class="line">            balanced = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s.pop()</span><br><span class="line">        index = index + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> balanced <span class="keyword">and</span> s.isEmpty():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">parChecker</span>(<span class="params">symbolString</span>):</span><br><span class="line">    s = Stack()</span><br><span class="line">    balanced = <span class="literal">True</span></span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> index &lt; <span class="built_in">len</span>(symbolString) <span class="keyword">and</span> balanced:</span><br><span class="line">        symbol = symbolString[index]</span><br><span class="line">        <span class="keyword">if</span> symbol <span class="keyword">in</span> <span class="string">'([{'</span>:</span><br><span class="line">            s.push(symbol)</span><br><span class="line">        <span class="keyword">elif</span> s.isEmpty():</span><br><span class="line">            balanced = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            top = s.pop()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> matches(top, symbol):</span><br><span class="line">                balanced = <span class="literal">False</span></span><br><span class="line">        index = index + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> balanced <span class="keyword">and</span> s.isEmpty():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matches</span>(<span class="params"><span class="built_in">open</span>,close</span>):</span><br><span class="line">    opens = <span class="string">'([{'</span></span><br><span class="line">    closes = <span class="string">')]}'</span></span><br><span class="line">    <span class="keyword">return</span> opens.index(<span class="built_in">open</span>) == closes.index(close)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="queue">Queue</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.items = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isEmpty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items == []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enqueue</span>(<span class="params">self, item</span>):</span><br><span class="line">        self.items.insert(<span class="number">0</span>,item)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dequeue</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hotPotato</span>(<span class="params">namelist, num</span>):</span><br><span class="line">    simqueue = Queue()</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> namelist:</span><br><span class="line">        simqueue.enqueue(name)</span><br><span class="line">    <span class="keyword">while</span> simqueue.size()&gt;<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            simqueue.enqueue(simqueue.dequeue())</span><br><span class="line">        simqueue.dequeue()</span><br><span class="line">    <span class="keyword">return</span> simqueue.dequeue()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(hotPotato([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>],<span class="number">7</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>4</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Printer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,ppm</span>):</span><br><span class="line">        self.pagerate = ppm</span><br><span class="line">        self.currentTask = <span class="literal">None</span></span><br><span class="line">        self.timeRemaining = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">tick</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.currentTask != <span class="literal">None</span>:</span><br><span class="line">            self.timeRemaining = self.timeRemaining - <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.timeRemaining &lt;= <span class="number">0</span>:</span><br><span class="line">                self.currentTask = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">busy</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.currentTask != <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">startNext</span>(<span class="params">self, newtask</span>):</span><br><span class="line">        self.currentTask = newtask</span><br><span class="line">        self.timeRemaining = newtask.getPages() * <span class="number">60</span>/self.pagerate</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, time</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.timestamp = time</span><br><span class="line">        self.pages = random.randrange(<span class="number">1</span>,<span class="number">21</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getStamp</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.timestamp</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getPages</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.pages</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">waitTime</span>(<span class="params">self, currenttime</span>):</span><br><span class="line">        <span class="keyword">return</span> currenttime - self.timestamp</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">newPrintTask</span>():</span><br><span class="line">    num = random.randrange(<span class="number">1</span>,<span class="number">181</span>)</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">180</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simulation</span>(<span class="params">numSeconds, pagesPerMinute</span>):</span><br><span class="line">    labprinter = Printer(pagesPerMinute)</span><br><span class="line">    printQueue = Queue()</span><br><span class="line">    waitingtimes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> currentSecond <span class="keyword">in</span> <span class="built_in">range</span>(numSeconds):</span><br><span class="line">        <span class="keyword">if</span> newPrintTask():</span><br><span class="line">            task = Task(currentSecond)</span><br><span class="line">            printQueue.enqueue(task)</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> labprinter.busy()) <span class="keyword">and</span> (<span class="keyword">not</span> printQueue.isEmpty()):</span><br><span class="line">            nexttask = printQueue.dequeue()</span><br><span class="line">            waitingtimes.append(nexttask.waitTime(currentSecond))</span><br><span class="line">            labprinter.startNext(nexttask)</span><br><span class="line">        labprinter.tick()</span><br><span class="line">    averageWait = <span class="built_in">sum</span>(waitingtimes)/<span class="built_in">len</span>(waitingtimes)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Average wait <span class="subst">{averageWait:<span class="number">8.2</span>f}</span> secs <span class="subst">{printQueue.size():3d}</span> tasks remaining.'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    simulation(<span class="number">3600</span>,<span class="number">5</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>Average wait    49.06 secs   0 tasks remaining.
Average wait   129.56 secs   0 tasks remaining.
Average wait    29.47 secs   0 tasks remaining.
Average wait    76.53 secs   1 tasks remaining.
Average wait    57.75 secs   0 tasks remaining.
Average wait    17.36 secs   1 tasks remaining.
Average wait    99.14 secs   0 tasks remaining.
Average wait   253.56 secs   0 tasks remaining.
Average wait   115.83 secs   0 tasks remaining.
Average wait   265.00 secs   4 tasks remaining.</code></pre>
<h3 id="双端队列">双端队列</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Deque</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.items = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isEmpty</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items == []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addFront</span>(<span class="params">self, item</span>):</span><br><span class="line">        self.items.append(item)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addRear</span>(<span class="params">self, item</span>):</span><br><span class="line">        self.items.insert(<span class="number">0</span>,item)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">removeFront</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">removeRear</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.items.pop(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.items)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="无序表">无序表</h3>
<p>链表实现无序表</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initdata</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.data = initdata</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getData</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.data</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getNext</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setData</span>(<span class="params">self, newdata</span>):</span><br><span class="line">        self.data = newdata</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setNext</span>(<span class="params">self,newnext</span>):</span><br><span class="line">        self.<span class="built_in">next</span> = newnext</span><br></pre></td></tr></tbody></table></figure>
<h2 id="递归">递归</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 调整sys最大递归深度</span></span><br><span class="line"><span class="comment"># import sys</span></span><br><span class="line"><span class="comment"># sys.getrecursionlimit()</span></span><br><span class="line"><span class="comment"># sys.setrecursionlimit()</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="无序表-1">无序表</h3>
<p>用链表实现无序表：基本元素：节点<br>
无序表本身不包含数据，只包含节点的引用<br>
添加新数据最快的位置是head</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, initdata</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.data = initdata</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getData</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.data</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getNext</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setData</span>(<span class="params">self,newdata</span>):</span><br><span class="line">        self.data = newdata</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setNext</span>(<span class="params">self, newnext</span>):</span><br><span class="line">        self.<span class="built_in">next</span> = newnext</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnorderedList</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># head 对第一个节点的引用 </span></span><br><span class="line">        self.head = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, item</span>):</span><br><span class="line">        temp = Node(item)</span><br><span class="line">        temp.setNext(self.head)</span><br><span class="line">        self.head = temp</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">size</span>(<span class="params">self</span>):</span><br><span class="line">        current = self.head</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> current != <span class="literal">None</span>:</span><br><span class="line">            count = count + <span class="number">1</span></span><br><span class="line">            current = current.getNext()</span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self, item</span>):</span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current != <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.getData() == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current = current.getNext()</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self,item</span>):</span><br><span class="line">        current = self.head</span><br><span class="line">        previous = <span class="literal">None</span></span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> found:</span><br><span class="line">            <span class="keyword">if</span> current.getData() == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                previous = current</span><br><span class="line">                current = current.getNext()</span><br><span class="line">        <span class="keyword">if</span> previous == <span class="literal">None</span>:</span><br><span class="line">            self.head = current.getNext()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            previous.setNext(current.getNext())   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="有序表">有序表</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OrderedList</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.head = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self, item</span>):</span><br><span class="line">        current = self.head</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        stop = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">while</span> current != <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> found <span class="keyword">and</span> <span class="keyword">not</span> stop:</span><br><span class="line">            <span class="keyword">if</span> current.getData() == item:</span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> current.getData() &gt; item:</span><br><span class="line">                    stop = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    current = current.getNext()</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, item</span>): </span><br><span class="line">        current = self.head </span><br><span class="line">        previous = <span class="literal">None</span> </span><br><span class="line">        stop = <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">while</span> current != <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> stop: </span><br><span class="line">            <span class="keyword">if</span> current.getData() &gt; item: </span><br><span class="line">                stop = <span class="literal">True</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                previous = current </span><br><span class="line">                current = current.getNext() </span><br><span class="line">        temp = Node(item) </span><br><span class="line">        <span class="keyword">if</span> previous == <span class="literal">None</span>: </span><br><span class="line">            temp.setNext(self.head) </span><br><span class="line">            self.head = temp </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            temp.setNext(current) </span><br><span class="line">            previous.setNext(temp)</span><br><span class="line">    <span class="comment"># 剩下的操作幼自己写： size, remove</span></span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<h3 id="线性结构小结">线性结构小结</h3>
<ul>
<li>stack：后进先出</li>
<li>Queue：先进先出</li>
<li>双端队列：可以同时具备stack和queue的功能</li>
<li>链表List：不需要连续存储空间，head需要特别处理
<ul>
<li>无序表</li>
<li>有序表</li>
</ul></li>
</ul>
<h3 id="递归应用">递归应用</h3>
<p>重复计算太多， 可以记录中间结果</p>
<p>找零</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">recMC</span>(<span class="params">coinValueList, change</span>):</span><br><span class="line">    minCoins = change</span><br><span class="line">    <span class="keyword">if</span> change <span class="keyword">in</span> coinValueList:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> coinValueList <span class="keyword">if</span> c&lt;=change]:</span><br><span class="line">            numCoins = <span class="number">1</span> + recMC(coinValueList, change-i)</span><br><span class="line">            <span class="keyword">if</span> numCoins &lt; minCoins:</span><br><span class="line">                minCoins = numCoins</span><br><span class="line">    <span class="keyword">return</span> minCoins</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">recMC([<span class="number">1</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">25</span>],<span class="number">63</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>6</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">recDC</span>(<span class="params">coinValueList, change, knownResults</span>):</span><br><span class="line">    minCoins = change</span><br><span class="line">    <span class="keyword">if</span> change <span class="keyword">in</span> coinValueList:</span><br><span class="line">        knownResults[change] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> knownResults[change] &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> knownResults[change]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> coinValueList <span class="keyword">if</span> c&lt;=change]:</span><br><span class="line">            numCoins = <span class="number">1</span> + recMC(coinValueList, change-i, knownResults)</span><br><span class="line">            <span class="keyword">if</span> numCoins &lt; minCoins:</span><br><span class="line">                minCoins = numCoins</span><br><span class="line">                knownResults[change] = minCoins</span><br><span class="line">    <span class="keyword">return</span> minCoins</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">recDC([<span class="number">25</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">1</span>], <span class="number">63</span>, [<span class="number">0</span>]*<span class="number">64</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>6</code></pre>
<p>动态规划<br>
从最简单的情况开始，递增寻找最优</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dpMakeChange</span>(<span class="params">coinValueList, change, minCoins</span>):</span><br><span class="line">    <span class="keyword">for</span> cents <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,change+<span class="number">1</span>):</span><br><span class="line">        coinCount = cents</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> coinValueList <span class="keyword">if</span> c&lt;=cents]:</span><br><span class="line">            <span class="keyword">if</span> minCoins[cents-j]+<span class="number">1</span>&lt;coinCount:</span><br><span class="line">                coinCount = minCoins[cents-j]+<span class="number">1</span></span><br><span class="line">        minCoins[cents] = coinCount</span><br><span class="line">    <span class="keyword">return</span> minCoins[change]</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">dpMakeChange([<span class="number">1</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">21</span>,<span class="number">25</span>],<span class="number">63</span>,[<span class="number">0</span>]*<span class="number">64</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<h2 id="查找">查找</h2>
<p>顺序查找</p>
<p>无序表查找</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sequentialSearch</span>(<span class="params">alist, item</span>):</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> pos &lt; <span class="built_in">len</span>(alist) <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">        <span class="keyword">if</span> alist[pos] == item:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            pos = pos + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> found</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>有序表查找</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">orderedSequentialSearch</span>(<span class="params">alist, item</span>):</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line">    stop = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> pos &lt; <span class="built_in">len</span>(alist) <span class="keyword">and</span> <span class="keyword">not</span> found <span class="keyword">and</span> <span class="keyword">not</span> stop:</span><br><span class="line">        <span class="keyword">if</span> alist[pos] == item:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> alist[pos] &gt; item:</span><br><span class="line">                stop = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                pos = pos + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> found</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">testlist = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(orderedSequentialSearch(testlist, <span class="number">3</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(sequentialSearch(testlist,<span class="number">8</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>False</code></pre>
<p>有序表，二分查找：</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">binarySearch</span>(<span class="params">alist, item</span>):</span><br><span class="line">    first = <span class="number">0</span></span><br><span class="line">    last = <span class="built_in">len</span>(alist) - <span class="number">1</span></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> first&lt;=last <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">        midpoint = (first + last)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> alist[midpoint] == item:</span><br><span class="line">            found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> item &lt; alist[midpoint]:</span><br><span class="line">                last = midpoint - <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                first = midpoint + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> found</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(binarySearch(testlist,<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<p>递归实现二分法</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">binarySearch</span>(<span class="params">alist, item</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(alist) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        midpoint = <span class="built_in">len</span>(alist)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> alist[midpoint] == item:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> item&lt;alist[midpoint]:</span><br><span class="line">                <span class="keyword">return</span> binarySearch(alist[:midpoint], item)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> binarySearch(alist[midpoint+<span class="number">1</span>:], item)</span><br><span class="line">                </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">binarySearch(testlist,<span class="number">3</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>True</code></pre>
<p>有序表查找也有排序的开销，有时候数据经常变动的话，不如用无序表和顺序查找更快</p>
<h3 id="排序算法">排序算法</h3>
<p>冒泡排序<br>
两两相邻交换，最大项交换到最后，经过n-1次</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bubbleSort</span>(<span class="params">alist</span>):</span><br><span class="line">    <span class="keyword">for</span> passnum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(alist)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(passnum):</span><br><span class="line">            <span class="keyword">if</span> alist[i]&gt;alist[i+<span class="number">1</span>]:</span><br><span class="line">                alist[i], alist[i+<span class="number">1</span>] = alist[i+<span class="number">1</span>], alist[i]</span><br><span class="line"></span><br><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">bubbleSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shortBubbleSort</span>(<span class="params">alist</span>):</span><br><span class="line">    exchanges = <span class="literal">True</span></span><br><span class="line">    passnum = <span class="built_in">len</span>(alist)-<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> passnum &gt; <span class="number">0</span> <span class="keyword">and</span> exchanges:</span><br><span class="line">        exchanges = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(passnum):</span><br><span class="line">            <span class="keyword">if</span> alist[i] &gt; alist[i+<span class="number">1</span>]:</span><br><span class="line">                exchanges = <span class="literal">True</span></span><br><span class="line">                alist[i],alist[i+<span class="number">1</span>] = alist[i+<span class="number">1</span>], alist[i]</span><br><span class="line">        passnum = passnum - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">alist = [<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">90</span>,<span class="number">50</span>,<span class="number">60</span>,<span class="number">70</span>,<span class="number">80</span>,<span class="number">100</span>,<span class="number">110</span>]</span><br><span class="line">shortBubbleSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<pre><code>[20, 30, 40, 50, 60, 70, 80, 90, 100, 110]</code></pre>
<p>选择排序</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">selectionSort</span>(<span class="params">alist</span>):</span><br><span class="line">    <span class="keyword">for</span> fillslot <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(alist)-<span class="number">1</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">        positionOfMax = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> location <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,fillslot+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> alist[location]&gt;alist[positionOfMax]:</span><br><span class="line">                positionOfMax = location</span><br><span class="line">        alist[fillslot], alist[positionOfMax] = alist[positionOfMax],alist[fillslot]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">selectionSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">insertionSort</span>(<span class="params">alist</span>):</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(alist)):</span><br><span class="line">        currentvalue = alist[index]</span><br><span class="line">        position = index</span><br><span class="line">        <span class="keyword">while</span> position&gt;<span class="number">0</span> <span class="keyword">and</span> alist[position-<span class="number">1</span>]&gt;currentvalue:</span><br><span class="line">            alist[position] = alist[position-<span class="number">1</span>]</span><br><span class="line">            position = position - <span class="number">1</span></span><br><span class="line">        alist[position] = currentvalue</span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">insertionSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<p>谢尔排序</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shellSort</span>(<span class="params">alist</span>):</span><br><span class="line">    sublistcount = <span class="built_in">len</span>(alist)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> sublistcount&gt;<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> startposition <span class="keyword">in</span> <span class="built_in">range</span>(sublistcount):</span><br><span class="line">            gapInsertionSort(alist, startposition, sublistcount)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'After increments of size'</span>,sublistcount,<span class="string">'The list is'</span>,alist)</span><br><span class="line">        sublistcount = sublistcount // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gapInsertionSort</span>(<span class="params">alist,start,gap</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start+gap,<span class="built_in">len</span>(alist),gap):</span><br><span class="line">        currentvalue = alist[i]</span><br><span class="line">        position = i</span><br><span class="line">        <span class="keyword">while</span> position&gt;=gap <span class="keyword">and</span> alist[position-gap]&gt;currentvalue:</span><br><span class="line">            alist[position] = alist[position-gap]</span><br><span class="line">            position = position - gap</span><br><span class="line">        alist[position] = currentvalue</span><br><span class="line">    </span><br><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">shellSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>After increments of size 4 The list is [20, 26, 44, 17, 54, 31, 93, 55, 77]
After increments of size 2 The list is [20, 17, 44, 26, 54, 31, 77, 55, 93]
After increments of size 1 The list is [17, 20, 26, 31, 44, 54, 55, 77, 93]
[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20</span>,<span class="number">4</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[0, 4, 8, 12, 16]</code></pre>
<p>归并排序</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> left</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mergeSort</span>(<span class="params">alist</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(alist)&gt;<span class="number">1</span>:</span><br><span class="line">        mid = <span class="built_in">len</span>(alist)//<span class="number">2</span></span><br><span class="line">        lefthalf = alist[:mid]</span><br><span class="line">        righthalf = alist[mid:]</span><br><span class="line"></span><br><span class="line">        mergeSort(lefthalf)</span><br><span class="line">        mergeSort(righthalf)</span><br><span class="line"></span><br><span class="line">        i= j= k= <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i&lt;<span class="built_in">len</span>(lefthalf) <span class="keyword">and</span> j&lt;<span class="built_in">len</span>(righthalf):</span><br><span class="line">            <span class="keyword">if</span> lefthalf[i]&lt;righthalf[j]:</span><br><span class="line">                alist[k]=lefthalf[i]</span><br><span class="line">                i=i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                alist[k]=righthalf[j]</span><br><span class="line">                j=j+<span class="number">1</span></span><br><span class="line">            k=k+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i&lt;<span class="built_in">len</span>(lefthalf):</span><br><span class="line">            alist[k] = lefthalf[i]</span><br><span class="line">            i=i+<span class="number">1</span></span><br><span class="line">            k=k+<span class="number">1</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> j&lt;<span class="built_in">len</span>(righthalf):</span><br><span class="line">            alist[k]=righthalf[j]</span><br><span class="line">            j=j+<span class="number">1</span></span><br><span class="line">            k=k+<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">mergeSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mergeSort</span>(<span class="params">lst</span>):</span><br><span class="line">    <span class="comment"># 递归结束条件</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(lst)&lt;=<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> lst</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分解问题， 并递归调用</span></span><br><span class="line">    middle = <span class="built_in">len</span>(lst)//<span class="number">2</span></span><br><span class="line">    left = mergeSort(lst[:middle]) <span class="comment"># 左半部排好序</span></span><br><span class="line">    right  = mergeSort(lst[middle:]) <span class="comment"># 右半部排好序</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 合并左右半部，完成排序</span></span><br><span class="line">    merged = []</span><br><span class="line">    <span class="keyword">while</span> left <span class="keyword">and</span> right:</span><br><span class="line">        <span class="keyword">if</span> left[<span class="number">0</span>] &lt;= right[<span class="number">0</span>]:</span><br><span class="line">            merged.append(left.pop(<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            merged.append(right.pop(<span class="number">0</span>))</span><br><span class="line">    merged.extend(right <span class="keyword">if</span> right <span class="keyword">else</span> left)</span><br><span class="line">    <span class="keyword">return</span> merged</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(mergeSort(alist))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<p>快速排序</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quickSort</span>(<span class="params">alist</span>):</span><br><span class="line">    quickSortHelper(alist,<span class="number">0</span>,<span class="built_in">len</span>(alist)-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quickSortHelper</span>(<span class="params">alist,first,last</span>):</span><br><span class="line">    <span class="keyword">if</span> first &lt; last:</span><br><span class="line">        splitpoint = partition(alist,first,last)</span><br><span class="line">        quickSortHelper(alist,first,splitpoint-<span class="number">1</span>)</span><br><span class="line">        quickSortHelper(alist,splitpoint+<span class="number">1</span>,last)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">partition</span>(<span class="params">alist,first,last</span>):</span><br><span class="line">    pivotvalue = alist[first]</span><br><span class="line"></span><br><span class="line">    leftmark = first + <span class="number">1</span></span><br><span class="line">    rightmark = last</span><br><span class="line"></span><br><span class="line">    done = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">        <span class="keyword">while</span> alist[leftmark] &lt;= pivotvalue <span class="keyword">and</span> leftmark &lt;= rightmark:</span><br><span class="line">            leftmark = leftmark +<span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> alist[rightmark] &gt;= pivotvalue <span class="keyword">and</span> rightmark &gt;=leftmark:</span><br><span class="line">            rightmark = rightmark - <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> rightmark &lt; leftmark:</span><br><span class="line">            done = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            alist[leftmark], alist[rightmark] = alist[rightmark], alist[leftmark]</span><br><span class="line">    </span><br><span class="line">    alist[first], alist[rightmark] = alist[rightmark], alist[first]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rightmark</span><br><span class="line"></span><br><span class="line">alist = [<span class="number">54</span>,<span class="number">26</span>,<span class="number">93</span>,<span class="number">17</span>,<span class="number">77</span>,<span class="number">31</span>,<span class="number">44</span>,<span class="number">55</span>,<span class="number">20</span>]</span><br><span class="line">quickSort(alist)</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[17, 20, 26, 31, 44, 54, 55, 77, 93]</code></pre>
<h2 id="散列函数">散列函数</h2>
<p>MD5和SHA系列hash function: hashlib</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">hashlib.md5(<span class="string">"hello world"</span>.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>'5eb63bbbe01eeed093cb22bb8f5acdc3'</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">m = hashlib.md5()</span><br><span class="line">m.update(<span class="string">'hello world'</span>.encode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;md5 _hashlib.HASH object @ 0x000002345866C390&gt;
5eb63bbbe01eeed093cb22bb8f5acdc3</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">m.update(<span class="string">'nihao shijie'</span>.encode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="built_in">print</span>(m.hexdigest())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;md5 _hashlib.HASH object @ 0x000002345866C390&gt;
215aa34b159e42f10d53a1187363b520</code></pre>
<p>冲突解决方案：开放定址（线性探测linear probing）</p>
<h2 id="树">树</h2>
<p>嵌套列表表示树</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">BinaryTree</span>(<span class="params">r</span>): </span><br><span class="line">    <span class="keyword">return</span> [r, [], []]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insertLeft</span>(<span class="params">root, newBranch</span>): </span><br><span class="line">    t = root.pop(<span class="number">1</span>) </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(t) &gt; <span class="number">1</span>: </span><br><span class="line">        root.insert(<span class="number">1</span>, [newBranch, t, []]) </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        root.insert(<span class="number">1</span>, [newBranch, [], []]) </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insertRight</span>(<span class="params">root, newBranch</span>): </span><br><span class="line">    t = root.pop(<span class="number">2</span>) </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(t) &gt; <span class="number">1</span>: </span><br><span class="line">        root.insert(<span class="number">2</span>, [newBranch, [], t]) </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        root.insert(<span class="number">2</span>, [newBranch, [], []]) </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRootVal</span>(<span class="params">root</span>): </span><br><span class="line">    <span class="keyword">return</span> root[<span class="number">0</span>] </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setRootVal</span>(<span class="params">root, newVal</span>): </span><br><span class="line">    root[<span class="number">0</span>] = newVal </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getLeftChild</span>(<span class="params">root</span>): </span><br><span class="line">    <span class="keyword">return</span> root[<span class="number">1</span>] </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRightChild</span>(<span class="params">root</span>): </span><br><span class="line">    <span class="keyword">return</span> root[<span class="number">2</span>] </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">r = BinaryTree(<span class="number">3</span>)</span><br><span class="line">insertLeft(r,<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line">insertLeft(r,<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line">insertRight(r,<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line">l = getLeftChild(r)</span><br><span class="line"><span class="built_in">print</span>(l)</span><br><span class="line">setRootVal(l,<span class="number">9</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line">insertLeft(l,<span class="number">11</span>)</span><br><span class="line"><span class="built_in">print</span>(r)</span><br><span class="line"><span class="built_in">print</span>(getRightChild(getRightChild(r)))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>[3, [4, [], []], []]
[3, [5, [4, [], []], []], []]
[3, [5, [4, [], []], []], [6, [], []]]
[5, [4, [], []], []]
[3, [9, [4, [], []], []], [6, [], []]]
[3, [9, [11, [4, [], []], []], []], [6, [], []]]
[]</code></pre>
<p>节点链接表示树：</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryTree</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, rootObj</span>): </span><br><span class="line">        self.key = rootObj </span><br><span class="line">        self.leftChild = <span class="literal">None</span> </span><br><span class="line">        self.rightChild = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insertLeft</span>(<span class="params">self, newNode</span>): </span><br><span class="line">        <span class="keyword">if</span> self.leftChild == <span class="literal">None</span>: </span><br><span class="line">            self.leftChild = BinaryTree(newNode) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            t = BinaryTree(newNode) </span><br><span class="line">            t.left = self.leftChild </span><br><span class="line">            self.leftChild = t </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insertRight</span>(<span class="params">self, newNode</span>): </span><br><span class="line">        <span class="keyword">if</span> self.rightChild == <span class="literal">None</span>: </span><br><span class="line">            self.rightChild = BinaryTree(newNode) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            t = BinaryTree(newNode) </span><br><span class="line">            t.right = self.rightChild </span><br><span class="line">            self.rightChild = t</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getRightChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.rightChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getLeftChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.leftChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setRootVal</span>(<span class="params">self, obj</span>): </span><br><span class="line">        self.key = obj </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getRootVal</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.key</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">r = BinaryTree(<span class="string">'a'</span>)</span><br><span class="line"><span class="built_in">print</span>(r.getRootVal())</span><br><span class="line">r.insertLeft(<span class="string">'b'</span>)</span><br><span class="line"><span class="built_in">print</span>(r.getLeftChild().getRootVal())</span><br><span class="line">r.insertRight(<span class="string">'c'</span>)</span><br><span class="line">r.getRightChild().setRootVal(<span class="string">'hello'</span>)</span><br><span class="line"><span class="built_in">print</span>(r.getRightChild().getRootVal())</span><br></pre></td></tr></tbody></table></figure>
<pre><code>a
b
hello</code></pre>
<p>可以将表达式表示为树</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">buildParseTree</span>(<span class="params">fpexp</span>): </span><br><span class="line">    <span class="comment"># fplist = fpexp.split()</span></span><br><span class="line">    fplist = <span class="built_in">list</span>(fpexp)</span><br><span class="line">    pStack = Stack() </span><br><span class="line">    eTree = BinaryTree(<span class="string">''</span>) </span><br><span class="line">    pStack.push(eTree) </span><br><span class="line">    currentTree = eTree </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> fplist: </span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">'('</span>: </span><br><span class="line">            currentTree.insertLeft(<span class="string">''</span>) </span><br><span class="line">            pStack.push(currentTree) </span><br><span class="line">            currentTree = currentTree.getLeftChild() </span><br><span class="line">        <span class="keyword">elif</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">'+-*/)'</span>: </span><br><span class="line">            currentTree.setRootVal(<span class="built_in">eval</span>(i)) </span><br><span class="line">            parent = pStack.pop() </span><br><span class="line">            currentTree = parent </span><br><span class="line">        <span class="keyword">elif</span> i <span class="keyword">in</span> <span class="string">'+-*/'</span>: </span><br><span class="line">            currentTree.setRootVal(i) </span><br><span class="line">            currentTree.insertRight(<span class="string">''</span>) </span><br><span class="line">            pStack.push(currentTree) </span><br><span class="line">            currentTree = currentTree.getRightChild() </span><br><span class="line">        <span class="keyword">elif</span> i == <span class="string">')'</span>: </span><br><span class="line">            currentTree = pStack.pop() </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Unknown Operator: "</span> + i) </span><br><span class="line">    <span class="keyword">return</span> eTree </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">buildParseTree(<span class="string">'((3+5)+(5*6))'</span>)</span><br></pre></td></tr></tbody></table></figure>
<pre><code>&lt;__main__.BinaryTree at 0x23456a3b4f0&gt;</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate</span>(<span class="params">parseTree</span>): </span><br><span class="line">    opers = {<span class="string">'+'</span>:operator.add, <span class="string">'-'</span>:operator.sub, <span class="string">'*'</span>:operator.mul, <span class="string">'/'</span>:operator.truediv} </span><br><span class="line">    leftC = parseTree.getLeftChild() </span><br><span class="line">    rightC = parseTree.getRightChild() </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> leftC <span class="keyword">and</span> rightC: </span><br><span class="line">        fn = opers[parseTree.getRootVal()] </span><br><span class="line">        <span class="keyword">return</span> fn(evaluate(leftC), evaluate(rightC)) </span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> parseTree.getRootVal() </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">evaluate(buildParseTree(<span class="string">'((3+5)+(5*6))'</span>))</span><br></pre></td></tr></tbody></table></figure>
<pre><code>38</code></pre>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tree = buildParseTree(<span class="string">'((3+5)+(5*6))'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">tree.getLeftChild().getLeftChild().getRootVal()</span><br></pre></td></tr></tbody></table></figure>
<pre><code>3</code></pre>
<p>树的遍历：<br>
前序遍历<br>
中序遍历<br>
后续遍历</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">preorder</span>(<span class="params">tree</span>): </span><br><span class="line">    <span class="keyword">if</span> tree: </span><br><span class="line">        <span class="built_in">print</span>(tree.getRootVal()) </span><br><span class="line">        preorder(tree.getLeftChild()) </span><br><span class="line">        preorder(tree.getRightChild())</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">postorder</span>(<span class="params">tree</span>): </span><br><span class="line">    <span class="keyword">if</span> tree != <span class="literal">None</span>: </span><br><span class="line">        postorder(tree.getLeftChild()) </span><br><span class="line">        postorder(tree.getRightChild()) </span><br><span class="line">        <span class="built_in">print</span>(tree.getRootVal()) </span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">inorder</span>(<span class="params">tree</span>): </span><br><span class="line">    <span class="keyword">if</span> tree != <span class="literal">None</span>: </span><br><span class="line">        inorder(tree.getLeftChild()) </span><br><span class="line">        <span class="built_in">print</span>(tree.getRootVal()) </span><br><span class="line">        inorder(tree.getRightChild())</span><br></pre></td></tr></tbody></table></figure>
<p>也可以写入binary tree class里</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">preorder</span>(<span class="params">self</span>): </span><br><span class="line">    <span class="built_in">print</span>(self.key) </span><br><span class="line">    <span class="keyword">if</span> self.leftChild: </span><br><span class="line">        self.left.preorder() </span><br><span class="line">    <span class="keyword">if</span> self.rightChild: </span><br><span class="line">        self.right.preorder() </span><br></pre></td></tr></tbody></table></figure>
<h3 id="优先队列vip放在队首">优先队列（vip放在队首）</h3>
<p>按优先级排队：
二叉堆（能够将优先队列的入队和出队复杂度都保持在O（logn））<br>
完全二叉树保证平衡：如果节点的下标为p，那么左子节点下标为2p，右子节点下标为2p-1，父节点下标为p//2</p>
<p>堆次序：<br>
任何一个节点x，其父节点p中的key均小于x中的key，根节点的key最小</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinHeap</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">        self.heapList = [<span class="number">0</span>] </span><br><span class="line">        self.currentSize = <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">percUp</span>(<span class="params">self, i</span>): </span><br><span class="line">        <span class="comment"># 将新数据上浮到合适的位置（大小），以便执行插入操作</span></span><br><span class="line">        <span class="keyword">while</span> i // <span class="number">2</span> &gt; <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">if</span> self.heapList[i] &lt; self.heapList[i // <span class="number">2</span>]: </span><br><span class="line">                self.heapList[i // <span class="number">2</span>], self.heapList[i] = self.heapList[i], self.heapList[i // <span class="number">2</span>]</span><br><span class="line">            i = i // <span class="number">2</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self, k</span>): </span><br><span class="line">        self.heapList.append(k) </span><br><span class="line">        self.currentSize = self.currentSize + <span class="number">1</span> </span><br><span class="line">        self.percUp(self.currentSize)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">percDown</span>(<span class="params">self, i</span>): </span><br><span class="line">        <span class="comment"># 删除最小节点时，先将最后一个节点放到删除节点处，再下沉</span></span><br><span class="line">        <span class="keyword">while</span> (i * <span class="number">2</span>) &lt;= self.currentSize: </span><br><span class="line">            mc = self.minChild(i) </span><br><span class="line">            <span class="keyword">if</span> self.heapList[i] &gt; self.heapList[mc]: </span><br><span class="line">                self.heapList[i], self.heapList[mc] = self.heapList[mc], self.heapList[i]</span><br><span class="line">            i = mc </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">minChild</span>(<span class="params">self, i</span>): </span><br><span class="line">        <span class="keyword">if</span> i * <span class="number">2</span> + <span class="number">1</span> &gt; self.currentSize: </span><br><span class="line">            <span class="keyword">return</span> i * <span class="number">2</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">if</span> self.heapList[i*<span class="number">2</span>] &lt; self.heapList[i*<span class="number">2</span>+<span class="number">1</span>]: </span><br><span class="line">                <span class="keyword">return</span> i * <span class="number">2</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">return</span> i * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delMin</span>(<span class="params">self</span>): </span><br><span class="line">        retval = self.heapList[<span class="number">1</span>] </span><br><span class="line">        self.heapList[<span class="number">1</span>] = self.heapList[self.currentSize] </span><br><span class="line">        self.currentSize = self.currentSize - <span class="number">1</span> </span><br><span class="line">        self.heapList.pop() </span><br><span class="line">        self.percDown(<span class="number">1</span>) </span><br><span class="line">        <span class="keyword">return</span> retval </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">buildHeap</span>(<span class="params">self, alist</span>): </span><br><span class="line">        <span class="comment"># 复杂度为O 1</span></span><br><span class="line">        i = <span class="built_in">len</span>(alist) // <span class="number">2</span></span><br><span class="line">        self.currentSize = <span class="built_in">len</span>(alist) </span><br><span class="line">        self.heapList = [<span class="number">0</span>] + alist[:] </span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span>): </span><br><span class="line">            self.percDown(i) </span><br><span class="line">            i = i - <span class="number">1</span> </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>堆排序复杂度O（nlogn）<br>
最大和最后一个叶子交换顺序后调整需要O(logn)， 总共n个节点。<br>
注：建堆的复杂度为O(n)</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">heapify</span>(<span class="params">arr, n, i</span>): </span><br><span class="line">    largest = i  </span><br><span class="line">    l = <span class="number">2</span> * i + <span class="number">1</span>     <span class="comment"># left = 2*i + 1 </span></span><br><span class="line">    r = <span class="number">2</span> * i + <span class="number">2</span>     <span class="comment"># right = 2*i + 2 </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> l &lt; n <span class="keyword">and</span> arr[i] &lt; arr[l]: </span><br><span class="line">        largest = l </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> r &lt; n <span class="keyword">and</span> arr[largest] &lt; arr[r]: </span><br><span class="line">        largest = r </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> largest != i: </span><br><span class="line">        arr[i],arr[largest] = arr[largest],arr[i]  <span class="comment"># 交换</span></span><br><span class="line">  </span><br><span class="line">        heapify(arr, n, largest) </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">heapSort</span>(<span class="params">arr</span>): </span><br><span class="line">    n = <span class="built_in">len</span>(arr) </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Build a maxheap. </span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n, -<span class="number">1</span>, -<span class="number">1</span>): </span><br><span class="line">        heapify(arr, n, i) </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 一个个交换元素</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>): </span><br><span class="line">        arr[i], arr[<span class="number">0</span>] = arr[<span class="number">0</span>], arr[i]   <span class="comment"># 交换</span></span><br><span class="line">        heapify(arr, i, <span class="number">0</span>) </span><br><span class="line">  </span><br><span class="line">arr = [ <span class="number">12</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>] </span><br><span class="line">heapSort(arr) </span><br><span class="line">n = <span class="built_in">len</span>(arr) </span><br><span class="line"><span class="built_in">print</span> (<span class="string">"排序后"</span>) </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n): </span><br><span class="line">    <span class="built_in">print</span> (<span class="string">"%d"</span> %arr[i]),</span><br></pre></td></tr></tbody></table></figure>
<pre><code>排序后
5
6
7
11
12
13</code></pre>
<h2 id="二叉查找树">二叉查找树</h2>
<p>比父节点小的key都出现在左子树，比父节点大的出现在右子树</p>
<p>ADT
Map（抽象数据类型映射）之前已经有两种实现方法：1.有序表+二分搜索。2.
hash表。下面用二叉查找树实现</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key, val, left=<span class="literal">None</span>, right=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">        parent=<span class="literal">None</span></span>): </span><br><span class="line">        self.key = key </span><br><span class="line">        self.payload = val </span><br><span class="line">        self.leftChild = left </span><br><span class="line">        self.rightChild = right </span><br><span class="line">        self.parent = parent </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasLeftChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.leftChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasRightChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.rightChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isLeftChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.parent <span class="keyword">and</span> self.parent.leftChild == self</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isRightChild</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.parent <span class="keyword">and</span> self.parent.rightChild == self </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isRoot</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self.parent </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">isLeaf</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> (self.rightChild <span class="keyword">or</span> self.leftChild) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasAnyChildren</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.rightChild <span class="keyword">or</span> self.leftChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">hasBothChildren</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.rightChild <span class="keyword">and</span> self.leftChild </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">replaceNodeData</span>(<span class="params">self, key, value, lc, rc</span>): </span><br><span class="line">        self.key = key </span><br><span class="line">        self.payload = value </span><br><span class="line">        self.leftChild = lc </span><br><span class="line">        self.rightChild = rc </span><br><span class="line">        <span class="keyword">if</span> self.hasLeftChild(): </span><br><span class="line">            self.leftChild.parent = self </span><br><span class="line">        <span class="keyword">if</span> self.hasRightChild(): </span><br><span class="line">            self.rightChild.parent = self</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">if</span> self: </span><br><span class="line">            <span class="keyword">if</span> self.hasLeftChild(): </span><br><span class="line">                <span class="keyword">for</span> elem <span class="keyword">in</span> self.leftChild: </span><br><span class="line">                    <span class="keyword">yield</span> elem </span><br><span class="line">            <span class="keyword">yield</span> self.key </span><br><span class="line">            <span class="keyword">if</span> self.hasRightChild(): </span><br><span class="line">                <span class="keyword">for</span> elem <span class="keyword">in</span> self.rightChild: </span><br><span class="line">                    <span class="keyword">yield</span> elem</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findSuccessor</span>(<span class="params">self</span>): </span><br><span class="line">        succ = <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">if</span> self.hasRightChild(): </span><br><span class="line">            succ = self.rightChild.findMin() </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">if</span> self.parent: </span><br><span class="line">                <span class="keyword">if</span> self.isLeftChild(): </span><br><span class="line">                    succ = self.parent </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    self.parent.rightChild = <span class="literal">None</span> </span><br><span class="line">                    succ = self.parent.findSuccessor() </span><br><span class="line">                    self.parent.rightChild = self </span><br><span class="line">        <span class="keyword">return</span> succ</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">findMin</span>(<span class="params">self</span>): </span><br><span class="line">        current = self </span><br><span class="line">        <span class="keyword">while</span> current.hasLeftChild(): </span><br><span class="line">            current = current.leftChild </span><br><span class="line">        <span class="keyword">return</span> current</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spliceOut</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">if</span> self.isLeaf(): </span><br><span class="line">            <span class="keyword">if</span> self.isLeftChild(): </span><br><span class="line">                self.parent.leftChild = <span class="literal">None</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                self.parent.rightChild = <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">elif</span> self.hasAnyChildren(): </span><br><span class="line">            <span class="keyword">if</span> self.hasLeftChild(): </span><br><span class="line">                <span class="keyword">if</span> self.isLeftChild(): </span><br><span class="line">                    self.parent.leftChild = self.leftChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    self.parent.rightChild = self.leftChild </span><br><span class="line">                self.leftChild.parent = self.parent </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">if</span> self.isLeftChild(): </span><br><span class="line">                    self.parent.leftChild = self.rightChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    self.parent.rightChild = self.rightChild </span><br><span class="line">                self.rightChild.parent = self.parent</span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinarySearchTree</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">        self.root = <span class="literal">None</span> </span><br><span class="line">        self.size = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">length</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.size </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.size </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="comment"># for 循环</span></span><br><span class="line">        <span class="keyword">return</span> self.root.__iter__()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, key, val</span>): </span><br><span class="line">        <span class="keyword">if</span> self.root: </span><br><span class="line">            self._put(key, val, self.root) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            self.root = TreeNode(key, val) </span><br><span class="line">            self.size = self.size + <span class="number">1</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_put</span>(<span class="params">self, key, val, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> key &lt; currentNode.key: </span><br><span class="line">            <span class="keyword">if</span> currentNode.hasLeftChild(): </span><br><span class="line">                self._put(key, val, currentNode.leftChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.leftChild = TreeNode(key, val, parent=currentNode) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">if</span> currentNode.hasRightChild(): </span><br><span class="line">                self._put(key, val, currentNode.rightChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.rightChild = TreeNode(key, val, parent=currentNode)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, k, v</span>): </span><br><span class="line">        <span class="comment"># m[k] = v</span></span><br><span class="line">        self.put(k, v)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">if</span> self.root: </span><br><span class="line">            res = self._get(key, self.root) </span><br><span class="line">            <span class="keyword">if</span> res: </span><br><span class="line">                <span class="keyword">return</span> res.payload </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get</span>(<span class="params">self, key, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> currentNode: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">elif</span> currentNode.key == key: </span><br><span class="line">            <span class="keyword">return</span> currentNode </span><br><span class="line">        <span class="keyword">elif</span> key &lt; currentNode.key: </span><br><span class="line">            <span class="keyword">return</span> self._get(key, currentNode.leftChild)</span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> self._get(key, currentNode.rightChild) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">return</span> self.get(key)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="comment"># k in m</span></span><br><span class="line">        <span class="keyword">if</span> self._get(key, self.root): </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">if</span> self.size &gt; <span class="number">1</span>: </span><br><span class="line">            nodeToRemove = self._get(key, self.root) </span><br><span class="line">            <span class="keyword">if</span> nodeToRemove: </span><br><span class="line">                self.remove(nodeToRemove) </span><br><span class="line">                self.size = self.size - <span class="number">1</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">raise</span> KeyError(<span class="string">'Error, key not in tree'</span>) </span><br><span class="line">        <span class="keyword">elif</span> self.size == <span class="number">1</span> <span class="keyword">and</span> self.root.key == key: </span><br><span class="line">            self.root = <span class="literal">None</span> </span><br><span class="line">            self.size = self.size - <span class="number">1</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">'Error, key not in tree'</span>) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, key</span>): </span><br><span class="line">        self.delete(key)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> currentNode.isLeaf(): <span class="comment"># 叶子节点</span></span><br><span class="line">            <span class="keyword">if</span> currentNode == currentNode.parent.leftChild: </span><br><span class="line">                currentNode.parent.leftChild = <span class="literal">None</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.parent.rightChild = <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">elif</span> currentNode.hasBothChildren(): <span class="comment"># 内部 </span></span><br><span class="line">            succ = currentNode.findSuccessor() </span><br><span class="line">            succ.spliceOut() </span><br><span class="line">            currentNode.key = succ.key </span><br><span class="line">            currentNode.payload = succ.payload </span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 只有一个子节点</span></span><br><span class="line">            <span class="keyword">if</span> currentNode.hasLeftChild(): </span><br><span class="line">                <span class="keyword">if</span> currentNode.isLeftChild(): </span><br><span class="line">                    currentNode.leftChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.leftChild = currentNode.leftChild </span><br><span class="line">                <span class="keyword">elif</span> currentNode.isRightChild(): </span><br><span class="line">                    currentNode.leftChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.rightChild = currentNode.leftChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    currentNode.replaceNodeData(currentNode.leftChild.key, </span><br><span class="line">                                            currentNode.leftChild.payload, </span><br><span class="line">                                            currentNode.leftChild.leftChild, </span><br><span class="line">                                            currentNode.leftChild.rightChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">if</span> currentNode.isLeftChild(): </span><br><span class="line">                    currentNode.rightChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.leftChild = currentNode.rightChild </span><br><span class="line">                <span class="keyword">elif</span> currentNode.isRightChild(): </span><br><span class="line">                    currentNode.rightChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.rightChild = currentNode.rightChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    currentNode.replaceNodeData(currentNode.rightChild.key, </span><br><span class="line">                                            currentNode.rightChild.payload, </span><br><span class="line">                                            currentNode.rightChild.leftChild, </span><br><span class="line">                                            currentNode.rightChild.rightChild) </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>如果root是中位数，那就是比较平衡的，插入顺序影响很大。</p>
<h3 id="平衡二叉查找树-avl树">平衡二叉查找树： AVL树</h3>
<p>key插入的时候一直保持平衡，避免上述情况<br>
搜索时间复杂度为O（logn）<br>
左节点+1，右节点-1<br>
AVL树旋转的过程是核心</p>
<p>具体解析可以参见：《python数据结构与算法分析》第六章-平衡二叉搜索树</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinarySearchTree</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">        self.root = <span class="literal">None</span> </span><br><span class="line">        self.size = <span class="number">0</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">length</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.size </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.size </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="comment"># for 循环</span></span><br><span class="line">        <span class="keyword">return</span> self.root.__iter__()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, key, val</span>): </span><br><span class="line">        <span class="keyword">if</span> self.root: </span><br><span class="line">            self._put(key, val, self.root) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            self.root = TreeNode(key, val) </span><br><span class="line">            self.size = self.size + <span class="number">1</span> </span><br><span class="line">    <span class="comment"># def _put(self, key, val, currentNode): </span></span><br><span class="line">    <span class="comment">#     if key &lt; currentNode.key: </span></span><br><span class="line">    <span class="comment">#         if currentNode.hasLeftChild(): </span></span><br><span class="line">    <span class="comment">#             self._put(key, val, currentNode.leftChild) </span></span><br><span class="line">    <span class="comment">#         else: </span></span><br><span class="line">    <span class="comment">#             currentNode.leftChild = TreeNode(key, val, parent=currentNode) </span></span><br><span class="line">    <span class="comment">#     else: </span></span><br><span class="line">    <span class="comment">#         if currentNode.hasRightChild(): </span></span><br><span class="line">    <span class="comment">#             self._put(key, val, currentNode.rightChild) </span></span><br><span class="line">    <span class="comment">#         else: </span></span><br><span class="line">    <span class="comment">#             currentNode.rightChild = TreeNode(key, val, parent=currentNode)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, k, v</span>): </span><br><span class="line">        <span class="comment"># m[k] = v</span></span><br><span class="line">        self.put(k, v)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">if</span> self.root: </span><br><span class="line">            res = self._get(key, self.root) </span><br><span class="line">            <span class="keyword">if</span> res: </span><br><span class="line">                <span class="keyword">return</span> res.payload </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get</span>(<span class="params">self, key, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> currentNode: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">elif</span> currentNode.key == key: </span><br><span class="line">            <span class="keyword">return</span> currentNode </span><br><span class="line">        <span class="keyword">elif</span> key &lt; currentNode.key: </span><br><span class="line">            <span class="keyword">return</span> self._get(key, currentNode.leftChild)</span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> self._get(key, currentNode.rightChild) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">return</span> self.get(key)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="comment"># k in m</span></span><br><span class="line">        <span class="keyword">if</span> self._get(key, self.root): </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, key</span>): </span><br><span class="line">        <span class="keyword">if</span> self.size &gt; <span class="number">1</span>: </span><br><span class="line">            nodeToRemove = self._get(key, self.root) </span><br><span class="line">            <span class="keyword">if</span> nodeToRemove: </span><br><span class="line">                self.remove(nodeToRemove) </span><br><span class="line">                self.size = self.size - <span class="number">1</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">raise</span> KeyError(<span class="string">'Error, key not in tree'</span>) </span><br><span class="line">        <span class="keyword">elif</span> self.size == <span class="number">1</span> <span class="keyword">and</span> self.root.key == key: </span><br><span class="line">            self.root = <span class="literal">None</span> </span><br><span class="line">            self.size = self.size - <span class="number">1</span> </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">raise</span> KeyError(<span class="string">'Error, key not in tree'</span>) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, key</span>): </span><br><span class="line">        self.delete(key)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove</span>(<span class="params">self, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> currentNode.isLeaf(): <span class="comment"># 叶子节点</span></span><br><span class="line">            <span class="keyword">if</span> currentNode == currentNode.parent.leftChild: </span><br><span class="line">                currentNode.parent.leftChild = <span class="literal">None</span> </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.parent.rightChild = <span class="literal">None</span> </span><br><span class="line">        <span class="keyword">elif</span> currentNode.hasBothChildren(): <span class="comment"># 内部 </span></span><br><span class="line">            succ = currentNode.findSuccessor() </span><br><span class="line">            succ.spliceOut() </span><br><span class="line">            currentNode.key = succ.key </span><br><span class="line">            currentNode.payload = succ.payload </span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 只有一个子节点</span></span><br><span class="line">            <span class="keyword">if</span> currentNode.hasLeftChild(): </span><br><span class="line">                <span class="keyword">if</span> currentNode.isLeftChild(): </span><br><span class="line">                    currentNode.leftChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.leftChild = currentNode.leftChild </span><br><span class="line">                <span class="keyword">elif</span> currentNode.isRightChild(): </span><br><span class="line">                    currentNode.leftChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.rightChild = currentNode.leftChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    currentNode.replaceNodeData(currentNode.leftChild.key, </span><br><span class="line">                                            currentNode.leftChild.payload, </span><br><span class="line">                                            currentNode.leftChild.leftChild, </span><br><span class="line">                                            currentNode.leftChild.rightChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                <span class="keyword">if</span> currentNode.isLeftChild(): </span><br><span class="line">                    currentNode.rightChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.leftChild = currentNode.rightChild </span><br><span class="line">                <span class="keyword">elif</span> currentNode.isRightChild(): </span><br><span class="line">                    currentNode.rightChild.parent = currentNode.parent </span><br><span class="line">                    currentNode.parent.rightChild = currentNode.rightChild </span><br><span class="line">                <span class="keyword">else</span>: </span><br><span class="line">                    currentNode.replaceNodeData(currentNode.rightChild.key, </span><br><span class="line">                                            currentNode.rightChild.payload, </span><br><span class="line">                                            currentNode.rightChild.leftChild, </span><br><span class="line">                                            currentNode.rightChild.rightChild)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_put</span>(<span class="params">self, key, val, currentNode</span>): </span><br><span class="line">        <span class="keyword">if</span> key &lt; currentNode.key: </span><br><span class="line">            <span class="keyword">if</span> currentNode.hasLeftChild(): </span><br><span class="line">                self._put(key, val, currentNode.leftChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.leftChild = TreeNode(key, val, parent=currentNode) </span><br><span class="line">                self.updateBalance(currentNode.leftChild) </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">if</span> currentNode.hasRightChild(): </span><br><span class="line">                self._put(key, val, currentNode.rightChild) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                currentNode.rightChild = TreeNode(key, val, parent=currentNode) </span><br><span class="line">                self.updateBalance(currentNode.rightChild) </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">updateBalance</span>(<span class="params">self, node</span>): </span><br><span class="line">        <span class="keyword">if</span> node.balanceFactor &gt; <span class="number">1</span> <span class="keyword">or</span> node.balanceFactor &lt; -<span class="number">1</span>: </span><br><span class="line">            self.rebalance(node) </span><br><span class="line">            <span class="keyword">return</span> </span><br><span class="line">        <span class="keyword">if</span> node.parent != <span class="literal">None</span>: </span><br><span class="line">            <span class="keyword">if</span> node.isLeftChild(): </span><br><span class="line">                node.parent.balanceFactor += <span class="number">1</span> </span><br><span class="line">            <span class="keyword">elif</span> node.isRightChild(): </span><br><span class="line">                node.parent.balanceFactor -= <span class="number">1</span> </span><br><span class="line">            <span class="keyword">if</span> node.parent.balanceFactor != <span class="number">0</span>: </span><br><span class="line">                self.updateBalance(node.parent)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rotateLeft</span>(<span class="params">self, rotRoot</span>): </span><br><span class="line">        newRoot = rotRoot.rightChild </span><br><span class="line">        rotRoot.rightChild = newRoot.leftChild </span><br><span class="line">        <span class="keyword">if</span> newRoot.leftChild != <span class="literal">None</span>: </span><br><span class="line">            newRoot.leftChild.parent = rotRoot </span><br><span class="line">        newRoot.parent = rotRoot.parent </span><br><span class="line">        <span class="keyword">if</span> rotRoot.isRoot(): </span><br><span class="line">            self.root = newRoot </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">if</span> rotRoot.isLeftChild(): </span><br><span class="line">                rotRoot.parent.leftChild = newRoot </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                rotRoot.parent.rightChild = newRoot </span><br><span class="line">        newRoot.leftChild = rotRoot </span><br><span class="line">        rotRoot.parent = newRoot </span><br><span class="line">        rotRoot.balanceFactor = rotRoot.balanceFactor + <span class="number">1</span> - <span class="built_in">min</span>(newRoot.balanceFactor, <span class="number">0</span>) </span><br><span class="line">        newRoot.balanceFactor = newRoot.balanceFactor + <span class="number">1</span> + <span class="built_in">max</span>(rotRoot.balanceFactor, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rebalance</span>(<span class="params">self, node</span>): </span><br><span class="line">        <span class="keyword">if</span> node.balanceFactor &lt; <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">if</span> node.rightChild.balanceFactor &gt; <span class="number">0</span>: </span><br><span class="line">                self.rotateRight(node.rightChild) </span><br><span class="line">                self.rotateLeft(node) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                self.rotateLeft(node) </span><br><span class="line">        <span class="keyword">elif</span> node.balanceFactor &gt; <span class="number">0</span>: </span><br><span class="line">            <span class="keyword">if</span> node.leftChild.balanceFactor &lt; <span class="number">0</span>: </span><br><span class="line">                self.rotateLeft(node.leftChild) </span><br><span class="line">                self.rotateRight(node) </span><br><span class="line">            <span class="keyword">else</span>: </span><br><span class="line">                self.rotateRight(node)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="图">图</h2>
<p>顶点vertex，边edge<br>
权重：给边赋权<br>
G = (V, E) 有向图，无向图<br>
有向无圈图：directed acyclic graph:DAG</p>
<p>ADT Graph两种实现方式：</p>
<ul>
<li>邻接矩阵adjacency matrix
<ul>
<li>无权边标注为1或0，有权边标注为相应权重</li>
</ul></li>
<li>邻接表adjacency list
<ul>
<li>类似字典</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vertex</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>): </span><br><span class="line">        self.<span class="built_in">id</span> = key </span><br><span class="line">        self.connectedTo = {} </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addNeighbor</span>(<span class="params">self, nbr, weight=<span class="number">0</span></span>): </span><br><span class="line">        self.connectedTo[nbr] = weight </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(self.<span class="built_in">id</span>) + <span class="string">' connectedTo: '</span> + <span class="built_in">str</span>([x.<span class="built_in">id</span> <span class="keyword">for</span> x <span class="keyword">in</span> self.connectedTo])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getConnections</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.connectedTo.keys() </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getId</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">id</span> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getWeight</span>(<span class="params">self, nbr</span>): </span><br><span class="line">        <span class="keyword">return</span> self.connectedTo[nbr]</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span>: </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">        self.vertList = {} </span><br><span class="line">        self.numVertices = <span class="number">0</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addVertex</span>(<span class="params">self, key</span>): </span><br><span class="line">        self.numVertices = self.numVertices + <span class="number">1</span> </span><br><span class="line">        newVertex = Vertex(key) </span><br><span class="line">        self.vertList[key] = newVertex </span><br><span class="line">        <span class="keyword">return</span> newVertex </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getVertex</span>(<span class="params">self, n</span>): </span><br><span class="line">        <span class="keyword">if</span> n <span class="keyword">in</span> self.vertList: </span><br><span class="line">            <span class="keyword">return</span> self.vertList[n] </span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__contains__</span>(<span class="params">self, n</span>): </span><br><span class="line">        <span class="keyword">return</span> n <span class="keyword">in</span> self.vertList </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addEdge</span>(<span class="params">self, f, t, cost=<span class="number">0</span></span>): </span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">not</span> <span class="keyword">in</span> self.vertList: </span><br><span class="line">            nv = self.addVertex(f) </span><br><span class="line">        <span class="keyword">if</span> t <span class="keyword">not</span> <span class="keyword">in</span> self.vertList: </span><br><span class="line">            nv = self.addVertex(t) </span><br><span class="line">        self.vertList[f].addNeighbor(self.vertList[t], cost) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getVertices</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> self.vertList.keys() </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">iter</span>(self.vertList.values())</span><br></pre></td></tr></tbody></table></figure>
<h3 id="广度优先搜索ove">广度优先搜索:O(V+E)</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pythonds.graphs <span class="keyword">import</span> Graph, Vertex </span><br><span class="line"><span class="keyword">from</span> pythonds.basic <span class="keyword">import</span> Queue </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bfs</span>(<span class="params">g, start</span>): </span><br><span class="line">    start.setDistance(<span class="number">0</span>) </span><br><span class="line">    start.setPred(<span class="literal">None</span>) </span><br><span class="line">    vertQueue = Queue() </span><br><span class="line">    vertQueue.enqueue(start) </span><br><span class="line">    <span class="keyword">while</span> (vertQueue.size() &gt; <span class="number">0</span>): </span><br><span class="line">        currentVert = vertQueue.dequeue() </span><br><span class="line">        <span class="keyword">for</span> nbr <span class="keyword">in</span> currentVert.getConnections(): </span><br><span class="line">            <span class="keyword">if</span> (nbr.getColor() == <span class="string">'white'</span>): </span><br><span class="line">                nbr.setColor(<span class="string">'gray'</span>) </span><br><span class="line">                nbr.setDistance(currentVert.getDistance() + <span class="number">1</span>) </span><br><span class="line">                nbr.setPred(currentVert) </span><br><span class="line">                vertQueue.enqueue(nbr) </span><br><span class="line">        currentVert.setColor(<span class="string">'black'</span>)</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 回溯BFS</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">traverse</span>(<span class="params">y</span>): </span><br><span class="line">    x = y </span><br><span class="line">    <span class="keyword">while</span> (x.getPred()): </span><br><span class="line">        <span class="built_in">print</span>(x.getId()) </span><br><span class="line">        x = x.getPred() </span><br><span class="line">        <span class="built_in">print</span>(x.getId()) </span><br><span class="line"></span><br><span class="line"><span class="comment"># traverse(g.getVertex('sage'))</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="深度优先搜索ove">深度优先搜索：O（V+E）</h3>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pythonds.graphs <span class="keyword">import</span> Graph </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DFSGraph</span>(<span class="title class_ inherited__">Graph</span>): </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="built_in">super</span>(). __init__() </span><br><span class="line">        self.time = <span class="number">0</span> </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfs</span>(<span class="params">self</span>): </span><br><span class="line">        <span class="keyword">for</span> aVertex <span class="keyword">in</span> self: </span><br><span class="line">            aVertex.setColor(<span class="string">'white'</span>) </span><br><span class="line">            aVertex.setPred(-<span class="number">1</span>) </span><br><span class="line">        <span class="keyword">for</span> aVertex <span class="keyword">in</span> self: </span><br><span class="line">            <span class="keyword">if</span> aVertex.getColor() == <span class="string">'white'</span>: </span><br><span class="line">                self.dfsvisit(aVertex) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dfsvisit</span>(<span class="params">self, startVertex</span>): </span><br><span class="line">        startVertex.setColor(<span class="string">'gray'</span>) </span><br><span class="line">        self.time += <span class="number">1</span> </span><br><span class="line">        startVertex.setDiscovery(self.time) </span><br><span class="line">        <span class="keyword">for</span> nextVertex <span class="keyword">in</span> startVertex.getConnections(): </span><br><span class="line">            <span class="keyword">if</span> nextVertex.getColor() == <span class="string">'white'</span>: </span><br><span class="line">                nextVertex.setPred(startVertex) </span><br><span class="line">                self.dfsvisit(nextVertex) </span><br><span class="line">        startVertex.setColor(<span class="string">'black'</span>) </span><br><span class="line">        self.time += <span class="number">1</span> </span><br><span class="line">        startVertex.setFinish(self.time)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="图的应用拓扑排序">图的应用：拓扑排序</h3>
<p>拓扑排序根据有向无环图生成一个包含所有顶点的线性序列，使得如果图 G
中有一条边为(v, w)，那么顶点 v 排在顶点 w
之前。在很多应用中，有向无环图被用于表明事件优先级。</p>
<h3 id="图的应用强连通分支">图的应用：强连通分支</h3>
<p>C中的任意两个顶点之间都有路径来回，这样的最大的子集就是强连通分支<br>
强连通分支的矩阵和转置矩阵相同</p>
<ul>
<li>kosaraju算法:
先用dfs得到每个顶点结束时间，然后按照结束时间最大的作为顶点，在转置图中用dfs，这样得到的所有顶点链接树就是强连通分支</li>
<li>Tarjan算法</li>
<li>Gabow算法（性能最高）</li>
</ul>
<h3 id="图的应用最短路径">图的应用：最短路径</h3>
<ul>
<li>Dijkstra算法：（只能处理大于0权重的图）O((V+E)logV)
<ul>
<li>利用优先队列：所有顶点建堆，然后出队优先点，更新邻接点的权值，并在优先队列中重排，直到优先队列中没有点</li>
<li>距离向量路由算法</li>
</ul></li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pythonds.graphs <span class="keyword">import</span> PriorityQueue, Graph, Vertex </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dijkstra</span>(<span class="params">aGraph, start</span>): </span><br><span class="line">    pq = PriorityQueue() </span><br><span class="line">    start.setDistance(<span class="number">0</span>) </span><br><span class="line">    pq.buildHeap([(v.getDistance(), v) <span class="keyword">for</span> v <span class="keyword">in</span> aGraph]) </span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> pq.isEmpty(): </span><br><span class="line">        currentVert = pq.delMin() </span><br><span class="line">        <span class="keyword">for</span> nextVert <span class="keyword">in</span> currentVert.getConnections(): </span><br><span class="line">            newDist = currentVert.getDistance() + currentVert.getWeight(nextVert) </span><br><span class="line">        <span class="keyword">if</span> newDist &lt; nextVert.getDistance(): </span><br><span class="line">            nextVert.setDistance(newDist) </span><br><span class="line">            nextVert.setPred(currentVert) </span><br><span class="line">            pq.decreaseKey(nextVert, newDist) <span class="comment"># O(ElogV)</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="图的应用最小生成树minimum-weight-spanning-tree">图的应用：最小生成树(minimum
weight spanning tree)</h3>
<ul>
<li>拥有图中所有顶点和最小数量的边（权重和最小）以保持联通的子图（无圈）</li>
<li>prim算法（和dijkstra算法相似，只不过要采取贪心策略，加入所有的顶点）</li>
</ul>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Python Generator and Iterator LC 173</title>
    <url>/Python-Generator-and-Iterator-LC-173/</url>
    <content><![CDATA[<h1 id="基本知识">基本知识</h1>
<h2 id="iterable-and-iterator">Iterable and Iterator</h2>
<p>The definition of <a href="https://docs.python.org/3/glossary.html#term-iterator">Iterator</a>:
An object representing a stream of data.</p>
<ul>
<li><code>__next__()</code> is necessary, because it repeated calls to
the iterator's <code>__next__()</code>.</li>
<li><code>__iter__()</code> is necessary, which returns iterator object
itself, because iterator itself needs to be an Iterable.
可以直接<code>return self</code></li>
</ul>
<p>The definition of <a href="https://docs.python.org/3/glossary.html#term-iterable">Iterable</a>:
An object capable of returning its members one at a time.</p>
<ul>
<li><code>__iter__()</code> or <code>__getitem__()</code> is necessary
to implement Sequence semantics.</li>
<li>can be used in for loop.</li>
</ul>
<p>简单理解：Iterable要有能力产生一个Iterator，Iterator的next要有能力返回下一个iterable里的值。for
loop是从Iterable里面拿到一个Iterator，然后对iterator一直请求next，直到StopIteration。</p>
<h2 id="generator">Generator</h2>
<p>The definition of <a href="https://docs.python.org/3/glossary.html#term-generator">Generator</a>:
A function returns a generator Iterator.</p>
<ul>
<li><p>Every time use <code>next()</code> to generator, it will yield
the next and label the current frame.</p></li>
<li><p>It can 'send': <code>g.send()</code>, which allows you to involve
the generator.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">while</span> num &gt; <span class="number">0</span>:</span><br><span class="line">        tmp = <span class="keyword">yield</span> num</span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            num = tmp</span><br><span class="line">        num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">g = gen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">first = <span class="built_in">next</span>(g) <span class="comment"># first = g.send(None)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"first:<span class="subst">{first}</span>"</span>)</span><br><span class="line"><span class="comment"># &gt;&gt; 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"send: <span class="subst">{g.send(<span class="number">10</span>)}</span>"</span>)</span><br><span class="line"><span class="comment"># &gt;&gt; 9</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> g:</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="comment"># &gt;&gt; 8, 7, 6, 5, 4, 3, 2, 1</span></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h1 id="lc-173-binary-search-tree-iterator">LC-173: Binary Search Tree
Iterator</h1>
<p>generator solution:</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, root</span>):</span><br><span class="line">    self.last = root</span><br><span class="line">    <span class="keyword">while</span> self.last <span class="keyword">and</span> self.last.right:</span><br><span class="line">        self.last = self.last.right</span><br><span class="line">    self.current = <span class="literal">None</span></span><br><span class="line">    self.g = self.iterate(root)</span><br><span class="line"></span><br><span class="line"><span class="comment"># @return a boolean, whether we have a next smallest number</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hasNext</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self.current <span class="keyword">is</span> <span class="keyword">not</span> self.last</span><br><span class="line"></span><br><span class="line"><span class="comment"># @return an integer, the next smallest number</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">next</span>(self.g)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">iterate</span>(<span class="params">self, node</span>):</span><br><span class="line">    <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> self.iterate(node.left):</span><br><span class="line">        <span class="keyword">yield</span> x</span><br><span class="line">    self.current = node</span><br><span class="line">    <span class="keyword">yield</span> node.val</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> self.iterate(node.right):</span><br><span class="line">        <span class="keyword">yield</span> x</span><br></pre></td></tr></tbody></table></figure>
<h2 id="疑问-为何这里要用nextself.g而不是直接self.g">疑问：
为何这里要用<code>next(self.g)</code>，而不是直接self.g？</h2>
<p>个人理解：
这里的next非def中的next，而是generator里的<code>__next__()</code>，当把def中的next改为其他名称时，运行结果相同。另外self.g是一个generator，因为iterate用到了yield，直接return
self.g是generator，而不是具体数字。</p>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>This is my first blog!</title>
    <url>/This-is-my-first-bolg/</url>
    <content><![CDATA[<p>This is the first time for me to use Hexo to build my blog.</p>
<p>My major is <strong>Engineering Physics</strong> and
<strong>Financial Engineering</strong>.</p>
<p>Hope to share my experiences with you!</p>
<p><strong>Thank you</strong> for following my blog!</p>
]]></content>
      <tags>
        <tag>Essay</tag>
      </tags>
  </entry>
  <entry>
    <title>Tree Traverse</title>
    <url>/Tree-Traverse/</url>
    <content><![CDATA[<h1 id="迭代法">迭代法</h1>
<p>Leetcode相关题目：94，144，145</p>
<h2 id="前序遍历">前序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = []</span><br><span class="line">        st= []</span><br><span class="line">        <span class="keyword">if</span> root:</span><br><span class="line">            st.append(root)</span><br><span class="line">        <span class="keyword">while</span> st:</span><br><span class="line">            node = st.pop()</span><br><span class="line">            <span class="keyword">if</span> node != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> node.right: <span class="comment">#右</span></span><br><span class="line">                    st.append(node.right)</span><br><span class="line">                <span class="keyword">if</span> node.left: <span class="comment">#左</span></span><br><span class="line">                    st.append(node.left)</span><br><span class="line">                st.append(node) <span class="comment">#中</span></span><br><span class="line">                st.append(<span class="literal">None</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                node = st.pop()</span><br><span class="line">                result.append(node.val)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure>
<h2 id="中序遍历">中序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = []</span><br><span class="line">        st = []</span><br><span class="line">        <span class="keyword">if</span> root:</span><br><span class="line">            st.append(root)</span><br><span class="line">        <span class="keyword">while</span> st:</span><br><span class="line">            node = st.pop()</span><br><span class="line">            <span class="keyword">if</span> node != <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> node.right: <span class="comment">#添加右节点（空节点不入栈）</span></span><br><span class="line">                    st.append(node.right)</span><br><span class="line">                </span><br><span class="line">                st.append(node) <span class="comment">#添加中节点</span></span><br><span class="line">                st.append(<span class="literal">None</span>) <span class="comment">#中节点访问过，但是还没有处理，加入空节点做为标记。</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> node.left: <span class="comment">#添加左节点（空节点不入栈）</span></span><br><span class="line">                    st.append(node.left)</span><br><span class="line">            <span class="keyword">else</span>: <span class="comment">#只有遇到空节点的时候，才将下一个节点放进结果集</span></span><br><span class="line">                node = st.pop() <span class="comment">#重新取出栈中元素</span></span><br><span class="line">                result.append(node.val) <span class="comment">#加入到结果集</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure>
<h2 id="后序遍历">后序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">postorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = []</span><br><span class="line">        st = []</span><br><span class="line">        <span class="keyword">if</span> root:</span><br><span class="line">            st.append(root)</span><br><span class="line">        <span class="keyword">while</span> st:</span><br><span class="line">            node = st.pop()</span><br><span class="line">            <span class="keyword">if</span> node != <span class="literal">None</span>:</span><br><span class="line">                st.append(node) <span class="comment">#中</span></span><br><span class="line">                st.append(<span class="literal">None</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> node.right: <span class="comment">#右</span></span><br><span class="line">                    st.append(node.right)</span><br><span class="line">                <span class="keyword">if</span> node.left: <span class="comment">#左</span></span><br><span class="line">                    st.append(node.left)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                node = st.pop()</span><br><span class="line">                result.append(node.val)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure>
<h1 id="递归法">递归法</h1>
<h2 id="前序遍历-1">前序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        <span class="comment"># 保存结果</span></span><br><span class="line">        result = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">traversal</span>(<span class="params">root: TreeNode</span>):</span><br><span class="line">            <span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            result.append(root.val) <span class="comment"># 前序</span></span><br><span class="line">            traversal(root.left)    <span class="comment"># 左</span></span><br><span class="line">            traversal(root.right)   <span class="comment"># 右</span></span><br><span class="line"></span><br><span class="line">        traversal(root)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure>
<h2 id="中序遍历-1">中序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">traversal</span>(<span class="params">root: TreeNode</span>):</span><br><span class="line">            <span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            traversal(root.left)    <span class="comment"># 左</span></span><br><span class="line">            result.append(root.val) <span class="comment"># 中序</span></span><br><span class="line">            traversal(root.right)   <span class="comment"># 右</span></span><br><span class="line"></span><br><span class="line">        traversal(root)</span><br><span class="line">        <span class="keyword">return</span> result</span><br></pre></td></tr></tbody></table></figure>
<h2 id="后序遍历-1">后序遍历</h2>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">postorderTraversal</span>(<span class="params">self, root: TreeNode</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">        result = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">traversal</span>(<span class="params">root: TreeNode</span>):</span><br><span class="line">            <span class="keyword">if</span> root == <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            traversal(root.left)    <span class="comment"># 左</span></span><br><span class="line">            traversal(root.right)   <span class="comment"># 右</span></span><br><span class="line">            result.append(root.val) <span class="comment"># 后序</span></span><br><span class="line"></span><br><span class="line">        traversal(root)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <categories>
        <category>Programming</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very
first post. Check <a href="https://hexo.io/docs/">documentation</a> for
more info. If you get any problems when using Hexo, you can find the
answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or
you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>
<h2 id="quick-start">Quick Start</h2>
<h3 id="create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="run-server">Run server</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></tbody></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
</search>
